// name: TestNitrogen.mos [instantiate/check/simulate]
// status: correct
// teardown_command: rm -rf *TestMedia.TestModels* output.log
// provided by Francesco Casella
//

loadModel(Modelica,{"3.2.3"}); getErrorString();
loadFile("TestMedia.mo"); getErrorString();

instantiateModel(TestMedia.TestModels.TestNitrogen); getErrorString();
checkModel(TestMedia.TestModels.TestNitrogen); getErrorString();
simulate(TestMedia.TestModels.TestNitrogen); getErrorString();

// Result:
// true
// ""
// true
// ""
// "function Modelica.Media.IdealGases.Common.DataRecord \"Automatically generated record constructor for Modelica.Media.IdealGases.Common.DataRecord\"
//   input String name;
//   input Real MM;
//   input Real Hf;
//   input Real H0;
//   input Real Tlimit;
//   input Real[7] alow;
//   input Real[2] blow;
//   input Real[7] ahigh;
//   input Real[2] bhigh;
//   input Real R;
//   output DataRecord res;
// end Modelica.Media.IdealGases.Common.DataRecord;
//
// function Modelica.Media.IdealGases.Common.Functions.h_T \"Compute specific enthalpy from temperature and gas data; reference is decided by the
//     refChoice input, or by the referenceChoice package constant by default\"
//   input Modelica.Media.IdealGases.Common.DataRecord data \"Ideal gas data\";
//   input Real T(quantity = \"ThermodynamicTemperature\", unit = \"K\", displayUnit = \"degC\", min = 0.0, start = 288.15, nominal = 300.0) \"Temperature\";
//   input Boolean exclEnthForm = true \"If true, enthalpy of formation Hf is not included in specific enthalpy h\";
//   input enumeration(ZeroAt0K, ZeroAt25C, UserDefined) refChoice = Modelica.Media.Interfaces.Choices.ReferenceEnthalpy.ZeroAt0K \"Choice of reference enthalpy\";
//   input Real h_off(quantity = \"SpecificEnergy\", unit = \"J/kg\") = 0.0 \"User defined offset for reference enthalpy, if referenceChoice = UserDefined\";
//   output Real h(quantity = \"SpecificEnergy\", unit = \"J/kg\") \"Specific enthalpy at temperature T\";
// algorithm
//   h := smooth(0, (if T < data.Tlimit then data.R * (T * (data.blow[1] + data.alow[2] * log(T) + T * (data.alow[3] + T * (0.5 * data.alow[4] + T * (0.3333333333333333 * data.alow[5] + T * (0.25 * data.alow[6] + 0.2 * data.alow[7] * T))))) - data.alow[1]) / T else data.R * (T * (data.bhigh[1] + data.ahigh[2] * log(T) + T * (data.ahigh[3] + T * (0.5 * data.ahigh[4] + T * (0.3333333333333333 * data.ahigh[5] + T * (0.25 * data.ahigh[6] + 0.2 * data.ahigh[7] * T))))) - data.ahigh[1]) / T) + (if exclEnthForm then -data.Hf else 0.0) + (if refChoice == Modelica.Media.Interfaces.Choices.ReferenceEnthalpy.ZeroAt0K then data.H0 else 0.0) + (if refChoice == Modelica.Media.Interfaces.Choices.ReferenceEnthalpy.UserDefined then h_off else 0.0));
// end Modelica.Media.IdealGases.Common.Functions.h_T;
//
// function TestMedia.TestModels.TestNitrogen.Medium.ThermodynamicState \"Automatically generated record constructor for TestMedia.TestModels.TestNitrogen.Medium.ThermodynamicState\"
//   input Real p;
//   input Real T;
//   output ThermodynamicState res;
// end TestMedia.TestModels.TestNitrogen.Medium.ThermodynamicState;
//
// function TestMedia.TestModels.TestNitrogen.Medium.density \"Return density of ideal gas\"
//   input TestMedia.TestModels.TestNitrogen.Medium.ThermodynamicState state \"Thermodynamic state record\";
//   output Real d(quantity = \"Density\", unit = \"kg/m3\", displayUnit = \"g/cm3\", min = 0.0, max = 1e5, start = 10.0, nominal = 10.0) \"Density\";
// algorithm
//   d := state.p / (296.8033869505308 * state.T);
// end TestMedia.TestModels.TestNitrogen.Medium.density;
//
// function TestMedia.TestModels.TestNitrogen.Medium.setState_pTX \"Return thermodynamic state as function of p, T and composition X\"
//   input Real p(quantity = \"Pressure\", unit = \"Pa\", displayUnit = \"bar\", min = 0.0, max = 1e8, start = 1e6, nominal = 1e6) \"Pressure\";
//   input Real T(quantity = \"ThermodynamicTemperature\", unit = \"K\", displayUnit = \"degC\", min = 200.0, max = 6000.0, start = 500.0, nominal = 500.0) \"Temperature\";
//   input Real[:] X(quantity = fill(\"MassFraction\", size(X, 1)), unit = fill(\"kg/kg\", size(X, 1)), min = fill(0.0, size(X, 1)), max = fill(1.0, size(X, 1)), nominal = fill(0.1, size(X, 1))) = {1.0} \"Mass fractions\";
//   output TestMedia.TestModels.TestNitrogen.Medium.ThermodynamicState state;
// algorithm
//   state := TestMedia.TestModels.TestNitrogen.Medium.ThermodynamicState(p, T);
// end TestMedia.TestModels.TestNitrogen.Medium.setState_pTX;
//
// function TestMedia.TestModels.TestNitrogen.Medium.specificEnthalpy \"Return specific enthalpy\"
//   input TestMedia.TestModels.TestNitrogen.Medium.ThermodynamicState state \"Thermodynamic state record\";
//   output Real h(quantity = \"SpecificEnergy\", unit = \"J/kg\", min = -1e10, max = 1e10, start = 309498.4543111511, nominal = 1e5) \"Specific enthalpy\";
// algorithm
//   h := Modelica.Media.IdealGases.Common.Functions.h_T(Modelica.Media.IdealGases.Common.DataRecord(\"N2\", 0.0280134, 0.0, 309498.4543111511, 1000.0, {22103.71497, -381.846182, 6.08273836, -0.00853091441, 1.384646189e-5, -9.62579362e-9, 2.519705809e-12}, {710.846086, -10.76003744}, {587712.406, -2239.249073, 6.06694922, -6.1396855e-4, 1.491806679e-7, -1.923105485e-11, 1.061954386e-15}, {12832.10415, -15.86640027}, 296.8033869505308), state.T, true, Modelica.Media.Interfaces.Choices.ReferenceEnthalpy.ZeroAt0K, 0.0);
// end TestMedia.TestModels.TestNitrogen.Medium.specificEnthalpy;
//
// class TestMedia.TestModels.TestNitrogen
//   Real state.p(quantity = \"Pressure\", unit = \"Pa\", displayUnit = \"bar\", min = 0.0, max = 1e8, start = 1e6, nominal = 1e6) \"Absolute pressure of medium\";
//   Real state.T(quantity = \"ThermodynamicTemperature\", unit = \"K\", displayUnit = \"degC\", min = 200.0, max = 6000.0, start = 500.0, nominal = 500.0) \"Temperature of medium\";
//   Real p(quantity = \"Pressure\", unit = \"Pa\", displayUnit = \"bar\", min = 0.0, max = 1e8, start = 1e6, nominal = 1e6);
//   Real h(quantity = \"SpecificEnergy\", unit = \"J/kg\", min = -1e10, max = 1e10, start = 309498.4543111511, nominal = 1e5);
//   Real d(quantity = \"Density\", unit = \"kg/m3\", displayUnit = \"g/cm3\", min = 0.0, max = 1e5, start = 10.0, nominal = 10.0);
//   Real T(quantity = \"ThermodynamicTemperature\", unit = \"K\", displayUnit = \"degC\", min = 200.0, max = 6000.0, start = 500.0, nominal = 500.0);
// equation
//   T = 300.0 + 300.0 * time;
//   p = 1e5;
//   state = TestMedia.TestModels.TestNitrogen.Medium.setState_pTX(p, T, {1.0});
//   d = TestMedia.TestModels.TestNitrogen.Medium.density(state);
//   h = TestMedia.TestModels.TestNitrogen.Medium.specificEnthalpy(state);
// end TestMedia.TestModels.TestNitrogen;
// "
// ""
// "Check of TestMedia.TestModels.TestNitrogen completed successfully.
// Class TestMedia.TestModels.TestNitrogen has 6 equation(s) and 6 variable(s).
// 2 of these are trivial equation(s)."
// ""
// record SimulationResult
//     resultFile = "TestMedia.TestModels.TestNitrogen_res.mat",
//     simulationOptions = "startTime = 0.0, stopTime = 1.0, numberOfIntervals = 500, tolerance = 1e-6, method = 'dassl', fileNamePrefix = 'TestMedia.TestModels.TestNitrogen', options = '', outputFormat = 'mat', variableFilter = '.*', cflags = '', simflags = ''",
//     messages = "LOG_SUCCESS       | info    | The initialization finished successfully without homotopy method.
// LOG_SUCCESS       | info    | The simulation finished successfully.
// "
// end SimulationResult;
// ""
// endResult
