
loadFile("ESDIRK_test01.mo");
getErrorString();

system("rm -rf temp/ && mkdir temp/");
cd("temp");

rkMethods := {"expl_euler",
             "impl_euler",
             "sdirk3",
             "esdirk2",
             "esdirk2_test",
             "esdirk3",
             "esdirk3_test",
             "merson",
             "dopri45"};

nlsMethods := {"newton", "kinsol"};

setCommandLineOptions("--generateSymbolicJacobian"); getErrorString();

buildModel(ESDIRK_test01);
getErrorString();

for rkMethod in rkMethods loop
  for nlsMethod in nlsMethods loop
    print("Running RK " + rkMethod + " with NLS " + nlsMethod + "\n");
    logFile := "ESDIRK_test01_"+ rkMethod + "_" + nlsMethod+ ".log";
    system("./ESDIRK_test01 -override=stopTime=20 -s=genericRK -rkOpt=" + rkMethod + " -rkNLS=" + nlsMethod, logFile);

    //res := compareSimulationResults("ESDIRK_test01_res.mat", "ESDIRK_test_01_ref.mat", {"der(y)[1]", "der(y)[2]"});
    //print(res + getErrorString());

    print(readFile(logFile) + "\n--------------------------------------------------------\n");
  end for;
end for;
