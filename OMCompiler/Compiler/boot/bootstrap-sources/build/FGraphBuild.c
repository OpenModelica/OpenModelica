#ifdef OMC_BASE_FILE
#define OMC_FILE OMC_BASE_FILE
#else
#define OMC_FILE "/home/mahge/dev/OpenModelica/OMCompiler/Compiler/boot/build/tmp/FGraphBuild.c"
#endif
#include "omc_simulation_settings.h"
#include "FGraphBuild.h"
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT0,1,4) {&SCode_Visibility_PROTECTED__desc,}};
#define _OMC_LIT0 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT0)
#define _OMC_LIT1_data "$match"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT1,6,_OMC_LIT1_data);
#define _OMC_LIT1 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT1)
#define _OMC_LIT2_data "$for"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT2,4,_OMC_LIT2_data);
#define _OMC_LIT2 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT2)
#define _OMC_LIT3_data "$ty"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT3,3,_OMC_LIT3_data);
#define _OMC_LIT3 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT3)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT4,2,24) {&FCore_Data_ND__desc,MMC_REFSTRUCTLIT(mmc_none)}};
#define _OMC_LIT4 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT4)
#define _OMC_LIT5_data "FGraphBuild.mkTypeNode: Error making type node: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT5,48,_OMC_LIT5_data);
#define _OMC_LIT5 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT5)
#define _OMC_LIT6_data " in parent: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT6,12,_OMC_LIT6_data);
#define _OMC_LIT6 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT6)
#define _OMC_LIT7_data "\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT7,1,_OMC_LIT7_data);
#define _OMC_LIT7 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT7)
#define _OMC_LIT8_data "$subs"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT8,5,_OMC_LIT8_data);
#define _OMC_LIT8 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT8)
#define _OMC_LIT9_data "$cnd"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT9,4,_OMC_LIT9_data);
#define _OMC_LIT9 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT9)
#define _OMC_LIT10_data "$it"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT10,3,_OMC_LIT10_data);
#define _OMC_LIT10 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT10)
#define _OMC_LIT11_data "$ref"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT11,4,_OMC_LIT11_data);
#define _OMC_LIT11 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT11)
#define _OMC_LIT12_data "$tydims"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT12,7,_OMC_LIT12_data);
#define _OMC_LIT12 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT12)
#define _OMC_LIT13_data "$dims"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT13,5,_OMC_LIT13_data);
#define _OMC_LIT13 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT13)
#define _OMC_LIT14_data "$mod"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT14,4,_OMC_LIT14_data);
#define _OMC_LIT14 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT14)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT15,1,20) {&Absyn_Exp_END__desc,}};
#define _OMC_LIT15 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT15)
#define _OMC_LIT16_data "$imp"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT16,4,_OMC_LIT16_data);
#define _OMC_LIT16 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT16)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT17,4,3) {&FCore_ImportTable_IMPORT__TABLE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_REFSTRUCTLIT(mmc_nil),MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT17 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT17)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT18,2,5) {&FCore_Data_IM__desc,_OMC_LIT17}};
#define _OMC_LIT18 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT18)
#define _OMC_LIT19_data "$definedUnits"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT19,13,_OMC_LIT19_data);
#define _OMC_LIT19 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT19)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT20,1,5) {&DAE_Mod_NOMOD__desc,}};
#define _OMC_LIT20 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT20)
#define _OMC_LIT21_data "$eq"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT21,3,_OMC_LIT21_data);
#define _OMC_LIT21 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT21)
#define _OMC_LIT22_data "$ieq"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT22,4,_OMC_LIT22_data);
#define _OMC_LIT22 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT22)
#define _OMC_LIT23_data "$al"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT23,3,_OMC_LIT23_data);
#define _OMC_LIT23 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT23)
#define _OMC_LIT24_data "$ial"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT24,4,_OMC_LIT24_data);
#define _OMC_LIT24 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT24)
#define _OMC_LIT25_data "$opt"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT25,4,_OMC_LIT25_data);
#define _OMC_LIT25 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT25)
#define _OMC_LIT26_data "$ed"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT26,3,_OMC_LIT26_data);
#define _OMC_LIT26 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT26)
#define _OMC_LIT27_data "$bnd"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT27,4,_OMC_LIT27_data);
#define _OMC_LIT27 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT27)
#define _OMC_LIT28_data "FGraphBuild.mkModNode failed with: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT28,35,_OMC_LIT28_data);
#define _OMC_LIT28 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT28)
#define _OMC_LIT29_data " mod: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT29,6,_OMC_LIT29_data);
#define _OMC_LIT29 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT29)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT30,10,3) {&SCodeDump_SCodeDumpOptions_OPTIONS__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1)),MMC_IMMEDIATE(MMC_TAGFIXNUM(1)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),MMC_IMMEDIATE(MMC_TAGFIXNUM(0))}};
#define _OMC_LIT30 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT30)
#define _OMC_LIT31_data "$cc"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT31,3,_OMC_LIT31_data);
#define _OMC_LIT31 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT31)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT32,1,3) {&DAE_Prefix_NOPRE__desc,}};
#define _OMC_LIT32 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT32)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT33,1,3) {&FCore_Status_VAR__UNTYPED__desc,}};
#define _OMC_LIT33 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT33)
#include "util/modelica.h"
#include "FGraphBuild_includes.h"
#if !defined(PROTECTED_FUNCTION_STATIC)
#define PROTECTED_FUNCTION_STATIC
#endif
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseStatementTraverser(threadData_t *threadData, modelica_metatype _inTuple);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseStatementTraverser,2,0) {(void*) boxptr_FGraphBuild_analyseStatementTraverser,0}};
#define boxvar_FGraphBuild_analyseStatementTraverser MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseStatementTraverser)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseStatement(threadData_t *threadData, modelica_metatype _inStatement, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseStatement,2,0) {(void*) boxptr_FGraphBuild_analyseStatement,0}};
#define boxvar_FGraphBuild_analyseStatement MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseStatement)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseAlgorithm(threadData_t *threadData, modelica_metatype _inAlgorithm, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseAlgorithm,2,0) {(void*) boxptr_FGraphBuild_analyseAlgorithm,0}};
#define boxvar_FGraphBuild_analyseAlgorithm MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseAlgorithm)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_traverseExp(threadData_t *threadData, modelica_metatype _inExp, modelica_metatype _inTuple, modelica_metatype *out_outTuple);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_traverseExp,2,0) {(void*) boxptr_FGraphBuild_traverseExp,0}};
#define boxvar_FGraphBuild_traverseExp MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_traverseExp)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseEEquationTraverser(threadData_t *threadData, modelica_metatype _inTuple);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseEEquationTraverser,2,0) {(void*) boxptr_FGraphBuild_analyseEEquationTraverser,0}};
#define boxvar_FGraphBuild_analyseEEquationTraverser MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseEEquationTraverser)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseEquation(threadData_t *threadData, modelica_metatype _inEquation, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseEquation,2,0) {(void*) boxptr_FGraphBuild_analyseEquation,0}};
#define boxvar_FGraphBuild_analyseEquation MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseEquation)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseExpTraverserExit(threadData_t *threadData, modelica_metatype _inExp, modelica_metatype _inTuple, modelica_metatype *out_outTuple);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseExpTraverserExit,2,0) {(void*) boxptr_FGraphBuild_analyseExpTraverserExit,0}};
#define boxvar_FGraphBuild_analyseExpTraverserExit MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseExpTraverserExit)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseCref(threadData_t *threadData, modelica_metatype _inCref, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseCref,2,0) {(void*) boxptr_FGraphBuild_analyseCref,0}};
#define boxvar_FGraphBuild_analyseCref MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseCref)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseExp2(threadData_t *threadData, modelica_metatype _inExp, modelica_metatype _inRef, modelica_metatype _inKind, modelica_metatype _inGraph);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseExp2,2,0) {(void*) boxptr_FGraphBuild_analyseExp2,0}};
#define boxvar_FGraphBuild_analyseExp2 MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseExp2)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseExpTraverserEnter(threadData_t *threadData, modelica_metatype _inExp, modelica_metatype _inTuple, modelica_metatype *out_outTuple);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseExpTraverserEnter,2,0) {(void*) boxptr_FGraphBuild_analyseExpTraverserEnter,0}};
#define boxvar_FGraphBuild_analyseExpTraverserEnter MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseExpTraverserEnter)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseOptExp(threadData_t *threadData, modelica_metatype _inExp, modelica_metatype _inRef, modelica_metatype _inKind, modelica_metatype _inGraph);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseOptExp,2,0) {(void*) boxptr_FGraphBuild_analyseOptExp,0}};
#define boxvar_FGraphBuild_analyseOptExp MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseOptExp)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseExp(threadData_t *threadData, modelica_metatype _inExp, modelica_metatype _inRef, modelica_metatype _inKind, modelica_metatype _inGraph);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseExp,2,0) {(void*) boxptr_FGraphBuild_analyseExp,0}};
#define boxvar_FGraphBuild_analyseExp MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_analyseExp)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_mkClassChildren(threadData_t *threadData, modelica_string _name, modelica_metatype _inClassDef, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_mkClassChildren,2,0) {(void*) boxptr_FGraphBuild_mkClassChildren,0}};
#define boxvar_FGraphBuild_mkClassChildren MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_mkClassChildren)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_mkClassGraph(threadData_t *threadData, modelica_metatype _inClass, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph);
static const MMC_DEFSTRUCTLIT(boxvar_lit_FGraphBuild_mkClassGraph,2,0) {(void*) boxptr_FGraphBuild_mkClassGraph,0}};
#define boxvar_FGraphBuild_mkClassGraph MMC_REFSTRUCTLIT(boxvar_lit_FGraphBuild_mkClassGraph)
DLLExport
modelica_metatype omc_FGraphBuild_mkAssertNode(threadData_t *threadData, modelica_string _inName, modelica_string _inMessage, modelica_metatype _inParentRef, modelica_metatype _inGraph, modelica_metatype *out_outRef)
{
modelica_metatype _outGraph = NULL;
modelica_metatype _outRef = NULL;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp4_1;
tmp4_1 = _inGraph;
{
modelica_metatype _n = NULL;
modelica_metatype _rn = NULL;
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
for (; tmp4 < 1; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
_g = tmp4_1;
tmpMeta[2] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[3] = mmc_mk_box2(26, &FCore_Data_ASSERT__desc, _inMessage);
_g = omc_FGraph_node(threadData, _g, _inName, tmpMeta[2], tmpMeta[3] ,&_n);
_rn = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _inName, _rn, 0);
tmpMeta[0+0] = _g;
tmpMeta[0+1] = _rn;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
goto_2:;
MMC_THROW_INTERNAL();
goto tmp3_done;
tmp3_done:;
}
}
_outGraph = tmpMeta[0+0];
_outRef = tmpMeta[0+1];
_return: OMC_LABEL_UNUSED
if (out_outRef) { *out_outRef = _outRef; }
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkRefNode(threadData_t *threadData, modelica_string _inName, modelica_metatype _inTargetScope, modelica_metatype _inParentRef, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;
tmp3_1 = _inGraph;
{
modelica_metatype _n = NULL;
modelica_metatype _rn = NULL;
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 1; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
_g = tmp3_1;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box2(23, &FCore_Data_REF__desc, _inTargetScope);
_g = omc_FGraph_node(threadData, _g, _inName, tmpMeta[1], tmpMeta[2] ,&_n);
_rn = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _inName, _rn, 0);
tmpMeta[0] = _g;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_addMatchScope__helper(threadData_t *threadData, modelica_metatype _inElements, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inElements;
tmp3_2 = _inGraph;
{
modelica_metatype _element = NULL;
modelica_metatype _rest = NULL;
modelica_metatype _g = NULL;
modelica_metatype _el = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],0,1) == 0) goto tmp2_end;
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
_element = tmpMeta[3];
_rest = tmpMeta[2];
_g = tmp3_2;
_el = omc_AbsynToSCode_translateElement(threadData, _element, _OMC_LIT0);
_g = omc_List_fold2(threadData, _el, boxvar_FGraphBuild_mkElementNode, _inParentRef, _inKind, _g);
_inElements = _rest;
_inGraph = _g;
goto _tailrecursive;
goto tmp2_done;
}
case 2: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
_rest = tmpMeta[2];
_g = tmp3_2;
_inElements = _rest;
_inGraph = _g;
goto _tailrecursive;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_addMatchScope(threadData_t *threadData, modelica_metatype _inMatchExp, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
modelica_metatype _local_decls = NULL;
modelica_metatype _g = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
tmpMeta[0] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[1] = mmc_mk_box2(17, &FCore_Data_MS__desc, _inMatchExp);
_g = omc_FGraph_node(threadData, _inGraph, _OMC_LIT1, tmpMeta[0], tmpMeta[1] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _OMC_LIT1, _nr, 0);
tmpMeta[0] = _inMatchExp;
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[0],21,5) == 0) MMC_THROW_INTERNAL();
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 4));
_local_decls = tmpMeta[1];
_outGraph = omc_FGraphBuild_addMatchScope__helper(threadData, _local_decls, _nr, _inKind, _g);
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_addIterators__helper(threadData_t *threadData, modelica_metatype _inIterators, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inIterators;
tmp3_2 = _inGraph;
{
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
modelica_string _name = NULL;
modelica_metatype _rest = NULL;
modelica_metatype _i = NULL;
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
_i = tmpMeta[1];
_name = tmpMeta[3];
_rest = tmpMeta[2];
_g = tmp3_2;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box2(16, &FCore_Data_FI__desc, _i);
_g = omc_FGraph_node(threadData, _g, _name, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _name, _nr, 0);
_inIterators = _rest;
_inGraph = _g;
goto _tailrecursive;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_addIterators(threadData_t *threadData, modelica_metatype _inIterators, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _inGraph;
{
modelica_metatype _g = NULL;
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
_g = tmp3_1;
_nr = omc_FNode_child(threadData, _inParentRef, _OMC_LIT2);
omc_FNode_addIteratorsToRef(threadData, _nr, _inIterators);
tmpMeta[0] = omc_FGraphBuild_addIterators__helper(threadData, _inIterators, _nr, _inKind, _g);
goto tmp2_done;
}
case 1: {
_g = tmp3_1;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box2(15, &FCore_Data_FS__desc, _inIterators);
_g = omc_FGraph_node(threadData, _g, _OMC_LIT2, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _OMC_LIT2, _nr, 0);
tmpMeta[0] = omc_FGraphBuild_addIterators__helper(threadData, _inIterators, _nr, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 2) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseStatementTraverser(threadData_t *threadData, modelica_metatype _inTuple)
{
modelica_metatype _outTuple = NULL;
modelica_metatype tmpMeta[7] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;
tmp3_1 = _inTuple;
{
modelica_metatype _ref = NULL;
modelica_metatype _stmt = NULL;
modelica_string _iter_name = NULL;
modelica_metatype _g = NULL;
modelica_metatype _k = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],2,5) == 0) goto tmp2_end;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 1));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 2));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 3));
_stmt = tmpMeta[1];
_iter_name = tmpMeta[2];
_ref = tmpMeta[4];
_k = tmpMeta[5];
_g = tmpMeta[6];
tmpMeta[2] = mmc_mk_box4(3, &Absyn_ForIterator_ITERATOR__desc, _iter_name, mmc_mk_none(), mmc_mk_none());
tmpMeta[1] = mmc_mk_cons(tmpMeta[2], MMC_REFSTRUCTLIT(mmc_nil));
_g = omc_FGraphBuild_addIterators(threadData, tmpMeta[1], _ref, _k, _g);
tmpMeta[3] = mmc_mk_box3(0, _ref, _k, _g);
omc_SCodeUtil_traverseStatementExps(threadData, _stmt, boxvar_FGraphBuild_traverseExp, tmpMeta[3], &tmpMeta[1]);
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
_g = tmpMeta[2];
tmpMeta[1] = mmc_mk_box3(0, _ref, _k, _g);
tmpMeta[2] = mmc_mk_box2(0, _stmt, tmpMeta[1]);
tmpMeta[0] = tmpMeta[2];
goto tmp2_done;
}
case 1: {
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],3,5) == 0) goto tmp2_end;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 1));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 2));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 3));
_stmt = tmpMeta[1];
_iter_name = tmpMeta[2];
_ref = tmpMeta[4];
_k = tmpMeta[5];
_g = tmpMeta[6];
tmpMeta[2] = mmc_mk_box4(3, &Absyn_ForIterator_ITERATOR__desc, _iter_name, mmc_mk_none(), mmc_mk_none());
tmpMeta[1] = mmc_mk_cons(tmpMeta[2], MMC_REFSTRUCTLIT(mmc_nil));
_g = omc_FGraphBuild_addIterators(threadData, tmpMeta[1], _ref, _k, _g);
tmpMeta[3] = mmc_mk_box3(0, _ref, _k, _g);
omc_SCodeUtil_traverseStatementExps(threadData, _stmt, boxvar_FGraphBuild_traverseExp, tmpMeta[3], &tmpMeta[1]);
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
_g = tmpMeta[2];
tmpMeta[1] = mmc_mk_box3(0, _ref, _k, _g);
tmpMeta[2] = mmc_mk_box2(0, _stmt, tmpMeta[1]);
tmpMeta[0] = tmpMeta[2];
goto tmp2_done;
}
case 2: {
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 1));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 2));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 3));
_stmt = tmpMeta[1];
_ref = tmpMeta[3];
_k = tmpMeta[4];
_g = tmpMeta[5];
omc_SCodeUtil_getStatementInfo(threadData, _stmt);
tmpMeta[3] = mmc_mk_box3(0, _ref, _k, _g);
omc_SCodeUtil_traverseStatementExps(threadData, _stmt, boxvar_FGraphBuild_traverseExp, tmpMeta[3], &tmpMeta[1]);
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
_g = tmpMeta[2];
tmpMeta[1] = mmc_mk_box3(0, _ref, _k, _g);
tmpMeta[2] = mmc_mk_box2(0, _stmt, tmpMeta[1]);
tmpMeta[0] = tmpMeta[2];
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outTuple = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outTuple;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseStatement(threadData_t *threadData, modelica_metatype _inStatement, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[5] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
tmpMeta[3] = mmc_mk_box3(0, _inParentRef, _inKind, _inGraph);
tmpMeta[4] = mmc_mk_box2(0, boxvar_FGraphBuild_analyseStatementTraverser, tmpMeta[3]);
omc_SCodeUtil_traverseStatements(threadData, _inStatement, tmpMeta[4], &tmpMeta[0]);
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
_outGraph = tmpMeta[2];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseAlgorithm(threadData_t *threadData, modelica_metatype _inAlgorithm, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype _stmts = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
tmpMeta[0] = _inAlgorithm;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 2));
_stmts = tmpMeta[1];
_outGraph = omc_List_fold2(threadData, _stmts, boxvar_FGraphBuild_analyseStatement, _inParentRef, _inKind, _inGraph);
_return: OMC_LABEL_UNUSED
return _outGraph;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_traverseExp(threadData_t *threadData, modelica_metatype _inExp, modelica_metatype _inTuple, modelica_metatype *out_outTuple)
{
modelica_metatype _outExp = NULL;
modelica_metatype _outTuple = NULL;
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
_outExp = omc_AbsynUtil_traverseExpBidir(threadData, _inExp, boxvar_FGraphBuild_analyseExpTraverserEnter, boxvar_FGraphBuild_analyseExpTraverserExit, _inTuple ,&_outTuple);
_return: OMC_LABEL_UNUSED
if (out_outTuple) { *out_outTuple = _outTuple; }
return _outExp;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseEEquationTraverser(threadData_t *threadData, modelica_metatype _inTuple)
{
modelica_metatype _outTuple = NULL;
modelica_metatype tmpMeta[8] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;
tmp3_1 = _inTuple;
{
modelica_metatype _equ = NULL;
modelica_metatype _equf = NULL;
modelica_metatype _equr = NULL;
modelica_string _iter_name = NULL;
modelica_metatype _ref = NULL;
modelica_metatype _cref1 = NULL;
modelica_metatype _g = NULL;
modelica_metatype _k = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],4,5) == 0) goto tmp2_end;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 1));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 2));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 3));
_equf = tmpMeta[1];
_iter_name = tmpMeta[2];
_ref = tmpMeta[4];
_k = tmpMeta[5];
_g = tmpMeta[6];
tmpMeta[2] = mmc_mk_box4(3, &Absyn_ForIterator_ITERATOR__desc, _iter_name, mmc_mk_none(), mmc_mk_none());
tmpMeta[1] = mmc_mk_cons(tmpMeta[2], MMC_REFSTRUCTLIT(mmc_nil));
_g = omc_FGraphBuild_addIterators(threadData, tmpMeta[1], _ref, _k, _g);
tmpMeta[3] = mmc_mk_box3(0, _ref, _k, _g);
tmpMeta[4] = omc_SCodeUtil_traverseEEquationExps(threadData, _equf, boxvar_FGraphBuild_traverseExp, tmpMeta[3], &tmpMeta[1]);
_equ = tmpMeta[4];
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
_g = tmpMeta[2];
tmpMeta[1] = mmc_mk_box3(0, _ref, _k, _g);
tmpMeta[2] = mmc_mk_box2(0, _equ, tmpMeta[1]);
tmpMeta[0] = tmpMeta[2];
goto tmp2_done;
}
case 1: {
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],8,4) == 0) goto tmp2_end;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[2],2,1) == 0) goto tmp2_end;
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 1));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 2));
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 3));
_equr = tmpMeta[1];
_cref1 = tmpMeta[3];
_ref = tmpMeta[5];
_k = tmpMeta[6];
_g = tmpMeta[7];
_g = omc_FGraphBuild_analyseCref(threadData, _cref1, _ref, _k, _g);
tmpMeta[3] = mmc_mk_box3(0, _ref, _k, _g);
tmpMeta[4] = omc_SCodeUtil_traverseEEquationExps(threadData, _equr, boxvar_FGraphBuild_traverseExp, tmpMeta[3], &tmpMeta[1]);
_equ = tmpMeta[4];
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
_g = tmpMeta[2];
tmpMeta[1] = mmc_mk_box3(0, _ref, _k, _g);
tmpMeta[2] = mmc_mk_box2(0, _equ, tmpMeta[1]);
tmpMeta[0] = tmpMeta[2];
goto tmp2_done;
}
case 2: {
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 1));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 2));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 3));
_equ = tmpMeta[1];
_ref = tmpMeta[3];
_k = tmpMeta[4];
_g = tmpMeta[5];
omc_SCodeUtil_getEEquationInfo(threadData, _equ);
tmpMeta[3] = mmc_mk_box3(0, _ref, _k, _g);
tmpMeta[4] = omc_SCodeUtil_traverseEEquationExps(threadData, _equ, boxvar_FGraphBuild_traverseExp, tmpMeta[3], &tmpMeta[1]);
_equ = tmpMeta[4];
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
_g = tmpMeta[2];
tmpMeta[1] = mmc_mk_box3(0, _ref, _k, _g);
tmpMeta[2] = mmc_mk_box2(0, _equ, tmpMeta[1]);
tmpMeta[0] = tmpMeta[2];
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outTuple = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outTuple;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseEquation(threadData_t *threadData, modelica_metatype _inEquation, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype _equ = NULL;
modelica_metatype tmpMeta[5] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
tmpMeta[0] = _inEquation;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 2));
_equ = tmpMeta[1];
tmpMeta[3] = mmc_mk_box3(0, _inParentRef, _inKind, _inGraph);
tmpMeta[4] = mmc_mk_box2(0, boxvar_FGraphBuild_analyseEEquationTraverser, tmpMeta[3]);
omc_SCodeUtil_traverseEEquations(threadData, _equ, tmpMeta[4], &tmpMeta[0]);
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
_outGraph = tmpMeta[2];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseExpTraverserExit(threadData_t *threadData, modelica_metatype _inExp, modelica_metatype _inTuple, modelica_metatype *out_outTuple)
{
modelica_metatype _outExp = NULL;
modelica_metatype _outTuple = NULL;
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
_outExp = _inExp;
_outTuple = _inTuple;
_return: OMC_LABEL_UNUSED
if (out_outTuple) { *out_outTuple = _outTuple; }
return _outExp;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseCref(threadData_t *threadData, modelica_metatype _inCref, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[1] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;volatile modelica_metatype tmp3_2;
tmp3_1 = _inCref;
tmp3_2 = _inGraph;
{
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,3,0) == 0) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_mkCrefNode(threadData, _inCref, _inParentRef, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 2) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseExp2(threadData_t *threadData, modelica_metatype _inExp, modelica_metatype _inRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inExp;
tmp3_2 = _inGraph;
{
modelica_metatype _cref = NULL;
modelica_metatype _iters = NULL;
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 6; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,2,1) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
_cref = tmpMeta[1];
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_analyseCref(threadData, _cref, _inRef, _inKind, _g);
goto tmp2_done;
}
case 1: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,11,3) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],1,3) == 0) goto tmp2_end;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
_iters = tmpMeta[2];
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_addIterators(threadData, _iters, _inRef, _inKind, _g);
goto tmp2_done;
}
case 2: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,11,3) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
_cref = tmpMeta[1];
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_analyseCref(threadData, _cref, _inRef, _inKind, _g);
goto tmp2_done;
}
case 3: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,12,2) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
_cref = tmpMeta[1];
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_analyseCref(threadData, _cref, _inRef, _inKind, _g);
goto tmp2_done;
}
case 4: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,21,5) == 0) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_addMatchScope(threadData, _inExp, _inRef, _inKind, _g);
goto tmp2_done;
}
case 5: {
tmpMeta[0] = _inGraph;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseExpTraverserEnter(threadData_t *threadData, modelica_metatype _inExp, modelica_metatype _inTuple, modelica_metatype *out_outTuple)
{
modelica_metatype _exp = NULL;
modelica_metatype _outTuple = NULL;
modelica_metatype _ref = NULL;
modelica_metatype _k = NULL;
modelica_metatype _g = NULL;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
tmpMeta[0] = _inTuple;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 1));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 3));
_ref = tmpMeta[1];
_k = tmpMeta[2];
_g = tmpMeta[3];
_g = omc_FGraphBuild_analyseExp2(threadData, _inExp, _ref, _k, _g);
_exp = _inExp;
tmpMeta[0] = mmc_mk_box3(0, _ref, _k, _g);
_outTuple = tmpMeta[0];
_return: OMC_LABEL_UNUSED
if (out_outTuple) { *out_outTuple = _outTuple; }
return _exp;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseOptExp(threadData_t *threadData, modelica_metatype _inExp, modelica_metatype _inRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inExp;
tmp3_2 = _inGraph;
{
modelica_metatype _exp = NULL;
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!optionNone(tmp3_1)) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
if (optionNone(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
_exp = tmpMeta[1];
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_analyseExp(threadData, _exp, _inRef, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_analyseExp(threadData_t *threadData, modelica_metatype _inExp, modelica_metatype _inRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
tmpMeta[2] = mmc_mk_box3(0, _inRef, _inKind, _inGraph);
omc_AbsynUtil_traverseExpBidir(threadData, _inExp, boxvar_FGraphBuild_analyseExpTraverserEnter, boxvar_FGraphBuild_analyseExpTraverserExit, tmpMeta[2], &tmpMeta[0]);
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 3));
_outGraph = tmpMeta[1];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkCrefsFromExps(threadData_t *threadData, modelica_metatype _inExps, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inExps;
tmp3_2 = _inGraph;
{
modelica_metatype _e = NULL;
modelica_metatype _rest = NULL;
modelica_metatype _crefs = NULL;
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
_e = tmpMeta[1];
_rest = tmpMeta[2];
_g = tmp3_2;
_crefs = omc_AbsynUtil_getCrefFromExp(threadData, _e, 1, 1);
_g = omc_FGraphBuild_mkCrefsNodes(threadData, _crefs, _inParentRef, _inKind, _g);
_inExps = _rest;
_inGraph = _g;
goto _tailrecursive;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkExternalNode(threadData_t *threadData, modelica_string _inName, modelica_metatype _inExternalDeclOpt, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inExternalDeclOpt;
tmp3_2 = _inGraph;
{
modelica_metatype _g = NULL;
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
modelica_metatype _ed = NULL;
modelica_metatype _ocr = NULL;
modelica_metatype _oae = NULL;
modelica_metatype _exps = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!optionNone(tmp3_1)) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
if (optionNone(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 5));
_ed = tmpMeta[1];
_ocr = tmpMeta[2];
_exps = tmpMeta[3];
_g = tmp3_2;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box2(14, &FCore_Data_ED__desc, _ed);
_g = omc_FGraph_node(threadData, _g, _inName, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _inName, _nr, 0);
_oae = omc_Util_applyOption(threadData, _ocr, boxvar_AbsynUtil_crefExp);
tmpMeta[0] = omc_FGraphBuild_mkCrefsFromExps(threadData, omc_List_consOption(threadData, _oae, _exps), _nr, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkOptNode(threadData_t *threadData, modelica_string _inName, modelica_metatype _inConstraintLst, modelica_metatype _inClsAttrs, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;modelica_metatype tmp3_3;
tmp3_1 = _inConstraintLst;
tmp3_2 = _inClsAttrs;
tmp3_3 = _inGraph;
{
modelica_metatype _g = NULL;
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
if (!listEmpty(tmp3_2)) goto tmp2_end;
_g = tmp3_3;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
_g = tmp3_3;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box3(13, &FCore_Data_OT__desc, _inConstraintLst, _inClsAttrs);
_g = omc_FGraph_node(threadData, _g, _inName, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _inName, _nr, 0);
tmpMeta[0] = _g;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkAlNode(threadData_t *threadData, modelica_string _inName, modelica_metatype _inAlgs, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inAlgs;
tmp3_2 = _inGraph;
{
modelica_metatype _g = NULL;
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
_g = tmp3_2;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box3(11, &FCore_Data_AL__desc, _inName, _inAlgs);
_g = omc_FGraph_node(threadData, _g, _inName, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _inName, _nr, 0);
tmpMeta[0] = omc_List_fold2(threadData, _inAlgs, boxvar_FGraphBuild_analyseAlgorithm, _nr, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkEqNode(threadData_t *threadData, modelica_string _inName, modelica_metatype _inEqs, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inEqs;
tmp3_2 = _inGraph;
{
modelica_metatype _g = NULL;
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
_g = tmp3_2;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box3(12, &FCore_Data_EQ__desc, _inName, _inEqs);
_g = omc_FGraph_node(threadData, _g, _inName, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _inName, _nr, 0);
tmpMeta[0] = omc_List_fold2(threadData, _inEqs, boxvar_FGraphBuild_analyseEquation, _nr, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkTypeNode(threadData_t *threadData, modelica_metatype _inTypes, modelica_metatype _inParentRef, modelica_string _inName, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[5] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _inGraph;
{
modelica_metatype _nr = NULL;
modelica_metatype _pr = NULL;
modelica_metatype _n = NULL;
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 4; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
_pr = omc_FNode_child(threadData, _inParentRef, _OMC_LIT3);
_nr = omc_FNode_child(threadData, _pr, _inName);
omc_FNode_addTypesToRef(threadData, _nr, _inTypes);
tmpMeta[0] = _inGraph;
goto tmp2_done;
}
case 1: {
modelica_boolean tmp5;
_g = tmp3_1;
tmp5 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
omc_FNode_child(threadData, _inParentRef, _OMC_LIT3);
tmp5 = 1;
goto goto_6;
goto_6:;
MMC_CATCH_INTERNAL(mmc_jumper)
if (tmp5) {goto goto_1;}
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
_g = omc_FGraph_node(threadData, _g, _OMC_LIT3, tmpMeta[1], _OMC_LIT4 ,&_n);
_pr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _OMC_LIT3, _pr, 0);
tmpMeta[1] = mmc_mk_cons(_pr, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box2(10, &FCore_Data_FT__desc, _inTypes);
_g = omc_FGraph_node(threadData, _g, _inName, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _pr, _inName, _nr, 0);
tmpMeta[0] = _g;
goto tmp2_done;
}
case 2: {
modelica_boolean tmp7;
_g = tmp3_1;
_pr = omc_FNode_child(threadData, _inParentRef, _OMC_LIT3);
tmp7 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
omc_FNode_child(threadData, _pr, _inName);
tmp7 = 1;
goto goto_8;
goto_8:;
MMC_CATCH_INTERNAL(mmc_jumper)
if (tmp7) {goto goto_1;}
tmpMeta[1] = mmc_mk_cons(_pr, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box2(10, &FCore_Data_FT__desc, _inTypes);
_g = omc_FGraph_node(threadData, _g, _inName, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _pr, _inName, _nr, 0);
tmpMeta[0] = _g;
goto tmp2_done;
}
case 3: {
_pr = omc_FGraph_top(threadData, _inGraph);
tmpMeta[1] = stringAppend(_OMC_LIT5,_inName);
tmpMeta[2] = stringAppend(tmpMeta[1],_OMC_LIT6);
tmpMeta[3] = stringAppend(tmpMeta[2],omc_FNode_name(threadData, omc_FNode_fromRef(threadData, _pr)));
tmpMeta[4] = stringAppend(tmpMeta[3],_OMC_LIT7);
fputs(MMC_STRINGDATA(tmpMeta[4]),stdout);
tmpMeta[0] = _inGraph;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 4) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkCrefNode(threadData_t *threadData, modelica_metatype _inCref, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;
tmp3_1 = _inGraph;
{
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
modelica_metatype _g = NULL;
modelica_string _name = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 1; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
_g = tmp3_1;
_name = omc_AbsynUtil_printComponentRefStr(threadData, _inCref);
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box2(20, &FCore_Data_CR__desc, _inCref);
_g = omc_FGraph_node(threadData, _g, _name, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _name, _nr, 0);
tmpMeta[0] = omc_FGraphBuild_mkDimsNode(threadData, _OMC_LIT8, omc_List_mkOption(threadData, omc_AbsynUtil_getSubsFromCref(threadData, _inCref, 1, 1)), _nr, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkCrefsNodes(threadData_t *threadData, modelica_metatype _inCrefs, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inCrefs;
tmp3_2 = _inGraph;
{
modelica_metatype _rest = NULL;
modelica_metatype _g = NULL;
modelica_metatype _cr = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
_cr = tmpMeta[1];
_rest = tmpMeta[2];
_g = tmp3_2;
_g = omc_FGraphBuild_mkCrefNode(threadData, _cr, _inParentRef, _inKind, _g);
_inCrefs = _rest;
_inGraph = _g;
goto _tailrecursive;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkExpressionNode(threadData_t *threadData, modelica_string _inName, modelica_metatype _inExp, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inExp;
tmp3_2 = _inGraph;
{
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
modelica_metatype _e = NULL;
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 1; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
_e = tmp3_1;
_g = tmp3_2;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box3(19, &FCore_Data_EXP__desc, _inName, _e);
_g = omc_FGraph_node(threadData, _g, _inName, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _inName, _nr, 0);
tmpMeta[0] = omc_FGraphBuild_analyseExp(threadData, _e, _nr, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkConditionNode(threadData_t *threadData, modelica_metatype _inCondition, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inCondition;
tmp3_2 = _inGraph;
{
modelica_metatype _e = NULL;
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!optionNone(tmp3_1)) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
if (optionNone(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
_e = tmpMeta[1];
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_mkExpressionNode(threadData, _OMC_LIT9, _e, _inParentRef, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkInstNode(threadData_t *threadData, modelica_metatype _inVar, modelica_metatype _inParentRef, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype _nr = NULL;
modelica_metatype _n = NULL;
modelica_metatype _g = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
tmpMeta[0] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[1] = mmc_mk_box2(4, &FCore_Data_IT__desc, _inVar);
_g = omc_FGraph_node(threadData, _inGraph, _OMC_LIT10, tmpMeta[0], tmpMeta[1] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _OMC_LIT10, _nr, 0);
_outGraph = _g;
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkCompNode(threadData_t *threadData, modelica_metatype _inComp, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_string _name = NULL;
modelica_metatype _g = NULL;
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
modelica_metatype _m = NULL;
modelica_metatype _cnd = NULL;
modelica_metatype _ad = NULL;
modelica_metatype _ts = NULL;
modelica_metatype _tad = NULL;
modelica_metatype _nd = NULL;
modelica_metatype _i = NULL;
modelica_metatype tmpMeta[7] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
tmpMeta[0] = _inComp;
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[0],3,8) == 0) MMC_THROW_INTERNAL();
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 4));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 5));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 6));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 8));
_name = tmpMeta[1];
_ad = tmpMeta[3];
_ts = tmpMeta[4];
_m = tmpMeta[5];
_cnd = tmpMeta[6];
_nd = omc_FNode_element2Data(threadData, _inComp, _inKind ,&_i);
tmpMeta[0] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
_g = omc_FGraph_node(threadData, _inGraph, _name, tmpMeta[0], _nd ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _name, _nr, 0);
_g = omc_FGraphBuild_mkInstNode(threadData, _i, _nr, _g);
tmpMeta[0] = MMC_REFSTRUCTLIT(mmc_nil);
_g = omc_FGraphBuild_mkRefNode(threadData, _OMC_LIT11, tmpMeta[0], _nr, _g);
_tad = omc_AbsynUtil_typeSpecDimensions(threadData, _ts);
_g = omc_FGraphBuild_mkDimsNode(threadData, _OMC_LIT12, mmc_mk_some(_tad), _nr, _inKind, _g);
_g = omc_FGraphBuild_mkDimsNode(threadData, _OMC_LIT13, mmc_mk_some(_ad), _nr, _inKind, _g);
_g = omc_FGraphBuild_mkConditionNode(threadData, _cnd, _nr, _inKind, _g);
_g = omc_FGraphBuild_mkConstrainClass(threadData, _inComp, _nr, _inKind, _g);
tmpMeta[0] = mmc_mk_box2(3, &FCore_ModScope_MS__COMPONENT__desc, _name);
_g = omc_FGraphBuild_mkModNode(threadData, _OMC_LIT14, _m, tmpMeta[0], _nr, _inKind, _g);
_outGraph = _g;
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkDimsNode__helper(threadData_t *threadData, modelica_integer _inStartWith, modelica_metatype _inArrayDims, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_integer tmp3_1;modelica_metatype tmp3_2;modelica_metatype tmp3_3;
tmp3_1 = _inStartWith;
tmp3_2 = _inArrayDims;
tmp3_3 = _inGraph;
{
modelica_string _name = NULL;
modelica_metatype _rest = NULL;
modelica_integer _i;
modelica_metatype _e = NULL;
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_2)) goto tmp2_end;
_g = tmp3_3;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
if (listEmpty(tmp3_2)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_2);
tmpMeta[2] = MMC_CDR(tmp3_2);
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],0,0) == 0) goto tmp2_end;
_rest = tmpMeta[2];
_i = tmp3_1;
_g = tmp3_3;
_name = intString(_i);
_g = omc_FGraphBuild_mkExpressionNode(threadData, _name, _OMC_LIT15, _inParentRef, _inKind, _g);
_inStartWith = ((modelica_integer) 1) + _i;
_inArrayDims = _rest;
_inGraph = _g;
goto _tailrecursive;
goto tmp2_done;
}
case 2: {
if (listEmpty(tmp3_2)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_2);
tmpMeta[2] = MMC_CDR(tmp3_2);
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],1,1) == 0) goto tmp2_end;
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
_e = tmpMeta[3];
_rest = tmpMeta[2];
_i = tmp3_1;
_g = tmp3_3;
_name = intString(_i);
_g = omc_FGraphBuild_mkExpressionNode(threadData, _name, _e, _inParentRef, _inKind, _g);
_inStartWith = ((modelica_integer) 1) + _i;
_inArrayDims = _rest;
_inGraph = _g;
goto _tailrecursive;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
modelica_metatype boxptr_FGraphBuild_mkDimsNode__helper(threadData_t *threadData, modelica_metatype _inStartWith, modelica_metatype _inArrayDims, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_integer tmp1;
modelica_metatype _outGraph = NULL;
tmp1 = mmc_unbox_integer(_inStartWith);
_outGraph = omc_FGraphBuild_mkDimsNode__helper(threadData, tmp1, _inArrayDims, _inParentRef, _inKind, _inGraph);
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkDimsNode(threadData_t *threadData, modelica_string _inName, modelica_metatype _inArrayDims, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inArrayDims;
tmp3_2 = _inGraph;
{
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
modelica_metatype _a = NULL;
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!optionNone(tmp3_1)) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
if (optionNone(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
if (!listEmpty(tmpMeta[1])) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 2: {
if (optionNone(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
if (listEmpty(tmpMeta[1])) goto tmp2_end;
tmpMeta[2] = MMC_CAR(tmpMeta[1]);
tmpMeta[3] = MMC_CDR(tmpMeta[1]);
_a = tmpMeta[1];
_g = tmp3_2;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box3(21, &FCore_Data_DIMS__desc, _inName, _a);
_g = omc_FGraph_node(threadData, _g, _inName, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _inName, _nr, 0);
tmpMeta[0] = omc_FGraphBuild_mkDimsNode__helper(threadData, ((modelica_integer) 0), _a, _nr, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkImportNode(threadData_t *threadData, modelica_metatype _inElement, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _inGraph;
{
modelica_metatype _g = NULL;
modelica_metatype _n = NULL;
modelica_metatype _r = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
_g = tmp3_1;
_r = omc_FNode_child(threadData, _inParentRef, _OMC_LIT16);
omc_FNode_addImportToRef(threadData, _r, _inElement);
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
_g = tmp3_1;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
_g = omc_FGraph_node(threadData, _g, _OMC_LIT16, tmpMeta[1], _OMC_LIT18 ,&_n);
_r = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _OMC_LIT16, _r, 0);
omc_FNode_addImportToRef(threadData, _r, _inElement);
tmpMeta[0] = _g;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 2) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkUnitsNode(threadData_t *threadData, modelica_metatype _inElement, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _inGraph;
{
modelica_metatype _g = NULL;
modelica_metatype _n = NULL;
modelica_metatype _r = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
_g = tmp3_1;
_r = omc_FNode_child(threadData, _inParentRef, _OMC_LIT19);
omc_FNode_addDefinedUnitToRef(threadData, _r, _inElement);
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
_g = tmp3_1;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_cons(_inElement, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[3] = mmc_mk_box2(9, &FCore_Data_DU__desc, tmpMeta[2]);
_g = omc_FGraph_node(threadData, _g, _OMC_LIT19, tmpMeta[1], tmpMeta[3] ,&_n);
_r = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _OMC_LIT19, _r, 0);
tmpMeta[0] = _g;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 2) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkElementNode(threadData_t *threadData, modelica_metatype _inElement, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inElement;
tmp3_2 = _inGraph;
{
modelica_metatype _g = NULL;
modelica_string _name = NULL;
modelica_metatype _p = NULL;
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
modelica_metatype _m = NULL;
int tmp3;
{
switch (MMC_SWITCH_CAST(valueConstructor(tmp3_1))) {
case 6: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,3,8) == 0) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_mkCompNode(threadData, _inElement, _inParentRef, _inKind, _g);
goto tmp2_done;
}
case 5: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,2,8) == 0) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_mkClassNode(threadData, _inElement, _inParentRef, _inKind, _g);
goto tmp2_done;
}
case 4: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,1,5) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 4));
_p = tmpMeta[1];
_m = tmpMeta[2];
_g = tmp3_2;
_name = omc_FNode_mkExtendsName(threadData, _p);
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box3(8, &FCore_Data_EX__desc, _inElement, _OMC_LIT20);
_g = omc_FGraph_node(threadData, _g, _name, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _name, _nr, 0);
tmpMeta[1] = mmc_mk_box2(4, &FCore_ModScope_MS__EXTENDS__desc, _p);
tmpMeta[0] = omc_FGraphBuild_mkModNode(threadData, _OMC_LIT14, _m, tmpMeta[1], _nr, _inKind, _g);
goto tmp2_done;
}
case 3: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,3) == 0) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_mkImportNode(threadData, _inElement, _inParentRef, _inKind, _g);
goto tmp2_done;
}
case 7: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,4,5) == 0) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_mkUnitsNode(threadData, _inElement, _inParentRef, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_mkClassChildren(threadData_t *threadData, modelica_string _name, modelica_metatype _inClassDef, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[9] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;volatile modelica_metatype tmp3_2;
tmp3_1 = _inClassDef;
tmp3_2 = _inGraph;
{
modelica_metatype _el = NULL;
modelica_metatype _g = NULL;
modelica_metatype _cdef = NULL;
modelica_metatype _nr = NULL;
modelica_metatype _ts = NULL;
modelica_metatype _p = NULL;
modelica_metatype _m = NULL;
modelica_metatype _ad = NULL;
modelica_metatype _eqs = NULL;
modelica_metatype _ieqs = NULL;
modelica_metatype _als = NULL;
modelica_metatype _ials = NULL;
modelica_metatype _constraintLst = NULL;
modelica_metatype _clsattrs = NULL;
modelica_metatype _externalDecl = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 6; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,8) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 4));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 5));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 6));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 7));
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 8));
tmpMeta[8] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 9));
_el = tmpMeta[1];
_eqs = tmpMeta[2];
_ieqs = tmpMeta[3];
_als = tmpMeta[4];
_ials = tmpMeta[5];
_constraintLst = tmpMeta[6];
_clsattrs = tmpMeta[7];
_externalDecl = tmpMeta[8];
_g = tmp3_2;
tmp3 += 4;
_g = omc_List_fold2(threadData, _el, boxvar_FGraphBuild_mkElementNode, _inParentRef, _inKind, _g);
_g = omc_FGraphBuild_mkEqNode(threadData, _OMC_LIT21, _eqs, _inParentRef, _inKind, _g);
_g = omc_FGraphBuild_mkEqNode(threadData, _OMC_LIT22, _ieqs, _inParentRef, _inKind, _g);
_g = omc_FGraphBuild_mkAlNode(threadData, _OMC_LIT23, _als, _inParentRef, _inKind, _g);
_g = omc_FGraphBuild_mkAlNode(threadData, _OMC_LIT24, _ials, _inParentRef, _inKind, _g);
_g = omc_FGraphBuild_mkOptNode(threadData, _OMC_LIT25, _constraintLst, _clsattrs, _inParentRef, _inKind, _g);
tmpMeta[0] = omc_FGraphBuild_mkExternalNode(threadData, _OMC_LIT26, _externalDecl, _inParentRef, _inKind, _g);
goto tmp2_done;
}
case 1: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,1,2) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
_m = tmpMeta[1];
_cdef = tmpMeta[2];
_g = tmp3_2;
tmp3 += 3;
_g = omc_FGraphBuild_mkClassChildren(threadData, _name, _cdef, _inParentRef, _inKind, _g);
tmpMeta[1] = mmc_mk_box2(6, &FCore_ModScope_MS__CLASS__EXTENDS__desc, _name);
tmpMeta[0] = omc_FGraphBuild_mkModNode(threadData, _OMC_LIT14, _m, tmpMeta[1], _inParentRef, _inKind, _g);
goto tmp2_done;
}
case 2: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,2,3) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
_ts = tmpMeta[1];
_m = tmpMeta[2];
_g = tmp3_2;
tmp3 += 2;
_p = omc_AbsynUtil_typeSpecPath(threadData, _ts);
_nr = _inParentRef;
tmpMeta[1] = mmc_mk_box2(5, &FCore_ModScope_MS__DERIVED__desc, _p);
_g = omc_FGraphBuild_mkModNode(threadData, _OMC_LIT14, _m, tmpMeta[1], _nr, _inKind, _g);
_ad = omc_AbsynUtil_typeSpecDimensions(threadData, _ts);
tmpMeta[0] = omc_FGraphBuild_mkDimsNode(threadData, _OMC_LIT12, mmc_mk_some(_ad), _nr, _inKind, _g);
goto tmp2_done;
}
case 3: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,4,1) == 0) goto tmp2_end;
_g = tmp3_2;
tmp3 += 1;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 4: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,5,2) == 0) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 5: {
tmpMeta[0] = _inGraph;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 6) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkBindingNode(threadData_t *threadData, modelica_metatype _inBinding, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inBinding;
tmp3_2 = _inGraph;
{
modelica_metatype _e = NULL;
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!optionNone(tmp3_1)) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
if (optionNone(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
_e = tmpMeta[1];
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_mkExpressionNode(threadData, _OMC_LIT27, _e, _inParentRef, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkSubMods(threadData_t *threadData, modelica_metatype _inSubMod, modelica_metatype _inModScope, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[5] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inSubMod;
tmp3_2 = _inGraph;
{
modelica_metatype _rest = NULL;
modelica_string _id = NULL;
modelica_metatype _m = NULL;
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
_id = tmpMeta[3];
_m = tmpMeta[4];
_rest = tmpMeta[2];
_g = tmp3_2;
_g = omc_FGraphBuild_mkModNode(threadData, _id, _m, _inModScope, _inParentRef, _inKind, _g);
_inSubMod = _rest;
_inGraph = _g;
goto _tailrecursive;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkModNode(threadData_t *threadData, modelica_string _inName, modelica_metatype _inMod, modelica_metatype _inModScope, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[5] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_string tmp3_1;volatile modelica_metatype tmp3_2;volatile modelica_metatype tmp3_3;
tmp3_1 = _inName;
tmp3_2 = _inMod;
tmp3_3 = _inGraph;
{
modelica_string _name = NULL;
modelica_metatype _g = NULL;
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
modelica_metatype _e = NULL;
modelica_metatype _sm = NULL;
modelica_metatype _b = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 6; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_2,2,0) == 0) goto tmp2_end;
_g = tmp3_3;
tmp3 += 4;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 1: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_2,0,5) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 4));
if (!listEmpty(tmpMeta[1])) goto tmp2_end;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 5));
if (!optionNone(tmpMeta[2])) goto tmp2_end;
_g = tmp3_3;
tmp3 += 1;
tmpMeta[0] = _g;
goto tmp2_done;
}
case 2: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_2,0,5) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 4));
if (!listEmpty(tmpMeta[1])) goto tmp2_end;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 5));
if (optionNone(tmpMeta[2])) goto tmp2_end;
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 1));
_b = tmpMeta[2];
_name = tmp3_1;
_g = tmp3_3;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box2(18, &FCore_Data_MO__desc, _inMod);
_g = omc_FGraph_node(threadData, _g, _name, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _name, _nr, 0);
tmpMeta[0] = omc_FGraphBuild_mkBindingNode(threadData, _b, _nr, _inKind, _g);
goto tmp2_done;
}
case 3: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_2,0,5) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 4));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 5));
_sm = tmpMeta[1];
_b = tmpMeta[2];
_name = tmp3_1;
_g = tmp3_3;
tmp3 += 1;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box2(18, &FCore_Data_MO__desc, _inMod);
_g = omc_FGraph_node(threadData, _g, _name, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _name, _nr, 0);
_sm = omc_FMod_compactSubMods(threadData, _sm, _inModScope);
_g = omc_FGraphBuild_mkSubMods(threadData, _sm, _inModScope, _nr, _inKind, _g);
tmpMeta[0] = omc_FGraphBuild_mkBindingNode(threadData, _b, _nr, _inKind, _g);
goto tmp2_done;
}
case 4: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_2,1,3) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 4));
_e = tmpMeta[1];
_name = tmp3_1;
_g = tmp3_3;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box2(18, &FCore_Data_MO__desc, _inMod);
_g = omc_FGraph_node(threadData, _g, _name, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _name, _nr, 0);
tmpMeta[0] = omc_FGraphBuild_mkElementNode(threadData, _e, _nr, _inKind, _g);
goto tmp2_done;
}
case 5: {
_name = tmp3_1;
_g = tmp3_3;
tmpMeta[1] = stringAppend(_OMC_LIT28,_name);
tmpMeta[2] = stringAppend(tmpMeta[1],_OMC_LIT29);
tmpMeta[3] = stringAppend(tmpMeta[2],omc_SCodeDump_printModStr(threadData, _inMod, _OMC_LIT30));
tmpMeta[4] = stringAppend(tmpMeta[3],_OMC_LIT7);
fputs(MMC_STRINGDATA(tmpMeta[4]),stdout);
tmpMeta[0] = _g;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 6) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkConstrainClass(threadData_t *threadData, modelica_metatype _inElement, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[7] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;volatile modelica_metatype tmp3_2;
tmp3_1 = _inElement;
tmp3_2 = _inGraph;
{
modelica_metatype _g = NULL;
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
modelica_metatype _cc = NULL;
modelica_metatype _m = NULL;
modelica_metatype _p = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,2,8) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 6));
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[2],0,1) == 0) goto tmp2_end;
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 2));
if (optionNone(tmpMeta[3])) goto tmp2_end;
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 1));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 2));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 3));
_cc = tmpMeta[4];
_p = tmpMeta[5];
_m = tmpMeta[6];
_g = tmp3_2;
tmp3 += 1;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box2(22, &FCore_Data_CC__desc, _cc);
_g = omc_FGraph_node(threadData, _g, _OMC_LIT31, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _OMC_LIT31, _nr, 0);
tmpMeta[1] = mmc_mk_box2(7, &FCore_ModScope_MS__CONSTRAINEDBY__desc, _p);
tmpMeta[0] = omc_FGraphBuild_mkModNode(threadData, _OMC_LIT14, _m, tmpMeta[1], _nr, _inKind, _g);
goto tmp2_done;
}
case 1: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,3,8) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 6));
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[2],0,1) == 0) goto tmp2_end;
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 2));
if (optionNone(tmpMeta[3])) goto tmp2_end;
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 1));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 2));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 3));
_cc = tmpMeta[4];
_p = tmpMeta[5];
_m = tmpMeta[6];
_g = tmp3_2;
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box2(22, &FCore_Data_CC__desc, _cc);
_g = omc_FGraph_node(threadData, _g, _OMC_LIT31, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _OMC_LIT31, _nr, 0);
tmpMeta[1] = mmc_mk_box2(7, &FCore_ModScope_MS__CONSTRAINEDBY__desc, _p);
tmpMeta[0] = omc_FGraphBuild_mkModNode(threadData, _OMC_LIT14, _m, tmpMeta[1], _nr, _inKind, _g);
goto tmp2_done;
}
case 2: {
tmpMeta[0] = _inGraph;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 3) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkClassNode(threadData_t *threadData, modelica_metatype _inClass, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;
tmp3_1 = _inGraph;
{
modelica_metatype _cdef = NULL;
modelica_metatype _cls = NULL;
modelica_string _name = NULL;
modelica_metatype _g = NULL;
modelica_metatype _n = NULL;
modelica_metatype _nr = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 1; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
_g = tmp3_1;
_cls = omc_SCodeInstUtil_expandEnumerationClass(threadData, _inClass);
tmpMeta[1] = _cls;
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],2,8) == 0) goto goto_1;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 7));
_name = tmpMeta[2];
_cdef = tmpMeta[3];
tmpMeta[1] = mmc_mk_cons(_inParentRef, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[2] = mmc_mk_box6(6, &FCore_Data_CL__desc, _cls, _OMC_LIT32, _OMC_LIT20, _inKind, _OMC_LIT33);
_g = omc_FGraph_node(threadData, _g, _name, tmpMeta[1], tmpMeta[2] ,&_n);
_nr = omc_FNode_toRef(threadData, _n);
omc_FNode_addChildRef(threadData, _inParentRef, _name, _nr, 0);
_g = omc_FGraphBuild_mkConstrainClass(threadData, _cls, _nr, _inKind, _g);
tmpMeta[0] = omc_FGraphBuild_mkClassChildren(threadData, _name, _cdef, _nr, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_FGraphBuild_mkClassGraph(threadData_t *threadData, modelica_metatype _inClass, modelica_metatype _inParentRef, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[1] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inClass;
tmp3_2 = _inGraph;
{
modelica_metatype _g = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 1; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,2,8) == 0) goto tmp2_end;
_g = tmp3_2;
tmpMeta[0] = omc_FGraphBuild_mkClassNode(threadData, _inClass, _inParentRef, _inKind, _g);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outGraph = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outGraph;
}
DLLExport
modelica_metatype omc_FGraphBuild_mkProgramGraph(threadData_t *threadData, modelica_metatype _inProgram, modelica_metatype _inKind, modelica_metatype _inGraph)
{
modelica_metatype _outGraph = NULL;
modelica_metatype _topRef = NULL;
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
_topRef = omc_FGraph_top(threadData, _inGraph);
_outGraph = omc_List_fold2(threadData, _inProgram, boxvar_FGraphBuild_mkClassGraph, _topRef, _inKind, _inGraph);
_return: OMC_LABEL_UNUSED
return _outGraph;
}
