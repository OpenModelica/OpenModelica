#ifdef OMC_BASE_FILE
#define OMC_FILE OMC_BASE_FILE
#else
#define OMC_FILE "/home/mahge/dev/OpenModelica/OMCompiler/Compiler/boot/build/tmp/InnerOuter.c"
#endif
#include "omc_simulation_settings.h"
#include "InnerOuter.h"
#define _OMC_LIT0_data "-InstHierarchyHashTable.valueArrayClearnth failed\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT0,50,_OMC_LIT0_data);
#define _OMC_LIT0 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT0)
#define _OMC_LIT1_data "-InstHierarchyHashTable.valueArraySetnth failed\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT1,48,_OMC_LIT1_data);
#define _OMC_LIT1 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT1)
#define _OMC_LIT2_data "-InstHierarchyHashTable.valueArrayAdd failed\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT2,45,_OMC_LIT2_data);
#define _OMC_LIT2 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT2)
#define _OMC_LIT3_data "-InstHierarchyHashTable.delete failed\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT3,38,_OMC_LIT3_data);
#define _OMC_LIT3 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT3)
#define _OMC_LIT4_data "content:"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT4,8,_OMC_LIT4_data);
#define _OMC_LIT4 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT4)
#define _OMC_LIT5_data "- InnerOuter.addNoUpdCheck failed\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT5,34,_OMC_LIT5_data);
#define _OMC_LIT5 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT5)
#define _OMC_LIT6_data "- InnerOuter.add failed\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT6,24,_OMC_LIT6_data);
#define _OMC_LIT6 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT6)
#define _OMC_LIT7_data "{"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT7,1,_OMC_LIT7_data);
#define _OMC_LIT7 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT7)
#define _OMC_LIT8_data " opaque InstInner for now, implement printing. "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT8,47,_OMC_LIT8_data);
#define _OMC_LIT8 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT8)
#define _OMC_LIT9_data "}\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT9,2,_OMC_LIT9_data);
#define _OMC_LIT9 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT9)
#define _OMC_LIT10_data "InstHierarchyHashTable:\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT10,24,_OMC_LIT10_data);
#define _OMC_LIT10 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT10)
#define _OMC_LIT11_data "\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT11,1,_OMC_LIT11_data);
#define _OMC_LIT11 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT11)
#define _OMC_LIT12_data "There are no 'inner' components defined in the model in any of the parent scopes of 'outer' component's scope: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT12,111,_OMC_LIT12_data);
#define _OMC_LIT12 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT12)
#define _OMC_LIT13_data "."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT13,1,_OMC_LIT13_data);
#define _OMC_LIT13 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT13)
#define _OMC_LIT14_data "\n    "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT14,5,_OMC_LIT14_data);
#define _OMC_LIT14 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT14)
#define _OMC_LIT15_data ""
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT15,0,_OMC_LIT15_data);
#define _OMC_LIT15 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT15)
#define _OMC_LIT16_data " Referenced by 'outer' components: {"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT16,36,_OMC_LIT16_data);
#define _OMC_LIT16 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT16)
#define _OMC_LIT17_data ", "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT17,2,_OMC_LIT17_data);
#define _OMC_LIT17 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT17)
#define _OMC_LIT18_data "}"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT18,1,_OMC_LIT18_data);
#define _OMC_LIT18 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT18)
#define _OMC_LIT19_data " "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT19,1,_OMC_LIT19_data);
#define _OMC_LIT19 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT19)
#define _OMC_LIT20_data "; defined in scope: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT20,20,_OMC_LIT20_data);
#define _OMC_LIT20 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT20)
#define _OMC_LIT21_data "failtrace"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT21,9,_OMC_LIT21_data);
#define _OMC_LIT21 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT21)
#define _OMC_LIT22_data "Sets whether to print a failtrace or not."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT22,41,_OMC_LIT22_data);
#define _OMC_LIT22 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT22)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT23,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT22}};
#define _OMC_LIT23 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT23)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT24,5,3) {&Flags_DebugFlag_DEBUG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(1)),_OMC_LIT21,MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),_OMC_LIT23}};
#define _OMC_LIT24 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT24)
#define _OMC_LIT25_data "InnerOuter.addOuterPrefix failed to add: outer cref: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT25,53,_OMC_LIT25_data);
#define _OMC_LIT25 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT25)
#define _OMC_LIT26_data " refers to inner cref: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT26,23,_OMC_LIT26_data);
#define _OMC_LIT26 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT26)
#define _OMC_LIT27_data " to IH"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT27,6,_OMC_LIT27_data);
#define _OMC_LIT27 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT27)
#define _OMC_LIT28_data "instance"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT28,8,_OMC_LIT28_data);
#define _OMC_LIT28 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT28)
#define _OMC_LIT29_data "Prints extra failtrace from InstanceHierarchy."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT29,46,_OMC_LIT29_data);
#define _OMC_LIT29 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT29)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT30,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT29}};
#define _OMC_LIT30 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT30)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT31,5,3) {&Flags_DebugFlag_DEBUG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(16)),_OMC_LIT28,MMC_IMMEDIATE(MMC_TAGFIXNUM(0)),_OMC_LIT30}};
#define _OMC_LIT31 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT31)
#define _OMC_LIT32_data "InnerOuter.updateSMHierarchy failure for: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT32,42,_OMC_LIT32_data);
#define _OMC_LIT32 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT32)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT33,1,11) {&DAE_Type_T__UNKNOWN__desc,}};
#define _OMC_LIT33 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT33)
#define _OMC_LIT34_data "InnerOuter.lookupInnerVar failed on component: "
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT34,47,_OMC_LIT34_data);
#define _OMC_LIT34 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT34)
#define _OMC_LIT35_data "/"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT35,1,_OMC_LIT35_data);
#define _OMC_LIT35 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT35)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT36,1,6) {&Absyn_InnerOuter_NOT__INNER__OUTER__desc,}};
#define _OMC_LIT36 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT36)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT37,2,4) {&Absyn_Path_IDENT__desc,_OMC_LIT15}};
#define _OMC_LIT37 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT37)
#define _OMC_LIT38_data "$it"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT38,3,_OMC_LIT38_data);
#define _OMC_LIT38 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT38)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT39,1,4) {&Absyn_InnerOuter_OUTER__desc,}};
#define _OMC_LIT39 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT39)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT40,1,5) {&ErrorTypes_MessageType_TRANSLATION__desc,}};
#define _OMC_LIT40 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT40)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT41,1,5) {&ErrorTypes_Severity_WARNING__desc,}};
#define _OMC_LIT41 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT41)
#define _OMC_LIT42_data "Ignoring the modification on outer element: %s."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT42,47,_OMC_LIT42_data);
#define _OMC_LIT42 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT42)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT43,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT42}};
#define _OMC_LIT43 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT43)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT44,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(512)),_OMC_LIT40,_OMC_LIT41,_OMC_LIT43}};
#define _OMC_LIT44 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT44)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT45,1,3) {&DAE_Prefix_NOPRE__desc,}};
#define _OMC_LIT45 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT45)
#define _OMC_LIT46_data "checkModel"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT46,10,_OMC_LIT46_data);
#define _OMC_LIT46 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT46)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT47,1,3) {&Flags_FlagVisibility_INTERNAL__desc,}};
#define _OMC_LIT47 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT47)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT48,2,4) {&Flags_FlagData_BOOL__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(0))}};
#define _OMC_LIT48 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT48)
#define _OMC_LIT49_data "Set when checkModel is used to turn on specific features for checking."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT49,70,_OMC_LIT49_data);
#define _OMC_LIT49 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT49)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT50,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT49}};
#define _OMC_LIT50 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT50)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT51,8,3) {&Flags_ConfigFlag_CONFIG__FLAG__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(31)),_OMC_LIT46,MMC_REFSTRUCTLIT(mmc_none),_OMC_LIT47,_OMC_LIT48,MMC_REFSTRUCTLIT(mmc_none),_OMC_LIT50}};
#define _OMC_LIT51 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT51)
#define _OMC_LIT52_data "No corresponding 'inner' declaration found for component %s declared as '%s'.\n  The existing 'inner' components are:\n    %s\n  Check if you have not misspelled the 'outer' component name.\n  Please declare an 'inner' component with the same name in the top scope.\n  Continuing flattening by only considering the 'outer' component declaration."
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT52,340,_OMC_LIT52_data);
#define _OMC_LIT52 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT52)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT53,2,3) {&Gettext_TranslatableContent_gettext__desc,_OMC_LIT52}};
#define _OMC_LIT53 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT53)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT54,5,3) {&ErrorTypes_Message_MESSAGE__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(108)),_OMC_LIT40,_OMC_LIT41,_OMC_LIT53}};
#define _OMC_LIT54 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT54)
#define _OMC_LIT55_data "lookupVarInnerOuterAttr"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT55,23,_OMC_LIT55_data);
#define _OMC_LIT55 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT55)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT56,1,3) {&Absyn_InnerOuter_INNER__desc,}};
#define _OMC_LIT56 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT56)
static const MMC_DEFSTRUCTLIT(_OMC_LIT_STRUCT57,7,3) {&ConnectionGraph_ConnectionGraph_GRAPH__desc,MMC_IMMEDIATE(MMC_TAGFIXNUM(1)),MMC_REFSTRUCTLIT(mmc_nil),MMC_REFSTRUCTLIT(mmc_nil),MMC_REFSTRUCTLIT(mmc_nil),MMC_REFSTRUCTLIT(mmc_nil),MMC_REFSTRUCTLIT(mmc_nil)}};
#define _OMC_LIT57 MMC_REFSTRUCTLIT(_OMC_LIT_STRUCT57)
#define _OMC_LIT58_data "failure in: addOuterConnectIfEmptyNOENV\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT58,40,_OMC_LIT58_data);
#define _OMC_LIT58 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT58)
#define _OMC_LIT59_data "- InnerOuter.handleInnerOuterEquations failed!\n"
static const MMC_DEFSTRINGLIT(_OMC_LIT_STRUCT59,47,_OMC_LIT59_data);
#define _OMC_LIT59 MMC_REFSTRINGLIT(_OMC_LIT_STRUCT59)
#include "util/modelica.h"
#include "InnerOuter_includes.h"
#if !defined(PROTECTED_FUNCTION_STATIC)
#define PROTECTED_FUNCTION_STATIC
#endif
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_searchForInnerPrefix(threadData_t *threadData, modelica_metatype _fullCref, modelica_metatype _inOuterCref, modelica_metatype _outerPrefixes, modelica_metatype *out_innerCrefPrefix);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_searchForInnerPrefix,2,0) {(void*) boxptr_InnerOuter_searchForInnerPrefix,0}};
#define boxvar_InnerOuter_searchForInnerPrefix MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_searchForInnerPrefix)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_changeOuterReferenceToInnerReference(threadData_t *threadData, modelica_metatype _inFullCref, modelica_metatype _inOuterCrefPrefix, modelica_metatype _inInnerCrefPrefix);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_changeOuterReferenceToInnerReference,2,0) {(void*) boxptr_InnerOuter_changeOuterReferenceToInnerReference,0}};
#define boxvar_InnerOuter_changeOuterReferenceToInnerReference MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_changeOuterReferenceToInnerReference)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_switchInnerToOuterInChildrenValue(threadData_t *threadData, modelica_metatype _inNode, modelica_metatype _inCr);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_switchInnerToOuterInChildrenValue,2,0) {(void*) boxptr_InnerOuter_switchInnerToOuterInChildrenValue,0}};
#define boxvar_InnerOuter_switchInnerToOuterInChildrenValue MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_switchInnerToOuterInChildrenValue)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_switchInnerToOuterInChild(threadData_t *threadData, modelica_string _name, modelica_metatype _cr, modelica_metatype _inRef);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_switchInnerToOuterInChild,2,0) {(void*) boxptr_InnerOuter_switchInnerToOuterInChild,0}};
#define boxvar_InnerOuter_switchInnerToOuterInChild MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_switchInnerToOuterInChild)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_switchInnerToOuterInNode(threadData_t *threadData, modelica_metatype _inNode, modelica_metatype _inCr);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_switchInnerToOuterInNode,2,0) {(void*) boxptr_InnerOuter_switchInnerToOuterInNode,0}};
#define boxvar_InnerOuter_switchInnerToOuterInNode MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_switchInnerToOuterInNode)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_lookupInnerInIH(threadData_t *threadData, modelica_metatype _inTIH, modelica_metatype _inPrefix, modelica_string _inComponentIdent);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_lookupInnerInIH,2,0) {(void*) boxptr_InnerOuter_lookupInnerInIH,0}};
#define boxvar_InnerOuter_lookupInnerInIH MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_lookupInnerInIH)
PROTECTED_FUNCTION_STATIC void omc_InnerOuter_checkMissingInnerDecl2(threadData_t *threadData, modelica_metatype _outerVar, modelica_metatype _innerVars);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_checkMissingInnerDecl2,2,0) {(void*) boxptr_InnerOuter_checkMissingInnerDecl2,0}};
#define boxvar_InnerOuter_checkMissingInnerDecl2 MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_checkMissingInnerDecl2)
PROTECTED_FUNCTION_STATIC void omc_InnerOuter_checkMissingInnerDecl1(threadData_t *threadData, modelica_metatype _innerVarsDae, modelica_metatype _outerVarsDae);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_checkMissingInnerDecl1,2,0) {(void*) boxptr_InnerOuter_checkMissingInnerDecl1,0}};
#define boxvar_InnerOuter_checkMissingInnerDecl1 MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_checkMissingInnerDecl1)
PROTECTED_FUNCTION_STATIC modelica_boolean omc_InnerOuter_lookupVarInnerOuterAttr(threadData_t *threadData, modelica_metatype _cache, modelica_metatype _env, modelica_metatype _inIH, modelica_metatype _cr1, modelica_metatype _cr2, modelica_boolean *out_isOuter);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_InnerOuter_lookupVarInnerOuterAttr(threadData_t *threadData, modelica_metatype _cache, modelica_metatype _env, modelica_metatype _inIH, modelica_metatype _cr1, modelica_metatype _cr2, modelica_metatype *out_isOuter);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_lookupVarInnerOuterAttr,2,0) {(void*) boxptr_InnerOuter_lookupVarInnerOuterAttr,0}};
#define boxvar_InnerOuter_lookupVarInnerOuterAttr MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_lookupVarInnerOuterAttr)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_removeOuter(threadData_t *threadData, modelica_metatype _io);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_removeOuter,2,0) {(void*) boxptr_InnerOuter_removeOuter,0}};
#define boxvar_InnerOuter_removeOuter MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_removeOuter)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_addOuterConnectIfEmptyNoEnv(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _inPre, modelica_metatype _inSets, modelica_boolean _added, modelica_metatype _cr1, modelica_metatype _iio1, modelica_metatype _f1, modelica_metatype _cr2, modelica_metatype _iio2, modelica_metatype _f2, modelica_metatype _info);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_InnerOuter_addOuterConnectIfEmptyNoEnv(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _inPre, modelica_metatype _inSets, modelica_metatype _added, modelica_metatype _cr1, modelica_metatype _iio1, modelica_metatype _f1, modelica_metatype _cr2, modelica_metatype _iio2, modelica_metatype _f2, modelica_metatype _info);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_addOuterConnectIfEmptyNoEnv,2,0) {(void*) boxptr_InnerOuter_addOuterConnectIfEmptyNoEnv,0}};
#define boxvar_InnerOuter_addOuterConnectIfEmptyNoEnv MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_addOuterConnectIfEmptyNoEnv)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_addOuterConnectIfEmpty(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _pre, modelica_metatype _inSets, modelica_boolean _added, modelica_metatype _cr1, modelica_metatype _iio1, modelica_metatype _f1, modelica_metatype _cr2, modelica_metatype _iio2, modelica_metatype _f2, modelica_metatype _info, modelica_metatype _inCGraph, modelica_metatype *out_outCGraph);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_InnerOuter_addOuterConnectIfEmpty(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _pre, modelica_metatype _inSets, modelica_metatype _added, modelica_metatype _cr1, modelica_metatype _iio1, modelica_metatype _f1, modelica_metatype _cr2, modelica_metatype _iio2, modelica_metatype _f2, modelica_metatype _info, modelica_metatype _inCGraph, modelica_metatype *out_outCGraph);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_addOuterConnectIfEmpty,2,0) {(void*) boxptr_InnerOuter_addOuterConnectIfEmpty,0}};
#define boxvar_InnerOuter_addOuterConnectIfEmpty MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_addOuterConnectIfEmpty)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_convertInnerOuterInnerToOuter(threadData_t *threadData, modelica_metatype _io);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_convertInnerOuterInnerToOuter,2,0) {(void*) boxptr_InnerOuter_convertInnerOuterInnerToOuter,0}};
#define boxvar_InnerOuter_convertInnerOuterInnerToOuter MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_convertInnerOuterInnerToOuter)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_retrieveOuterConnections2(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _inPrefix, modelica_metatype _inOuterConnects, modelica_metatype _inSets, modelica_boolean _inTopCall, modelica_metatype _inCGraph, modelica_metatype *out_outSets, modelica_metatype *out_outInnerOuterConnects, modelica_metatype *out_outCGraph);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_InnerOuter_retrieveOuterConnections2(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _inPrefix, modelica_metatype _inOuterConnects, modelica_metatype _inSets, modelica_metatype _inTopCall, modelica_metatype _inCGraph, modelica_metatype *out_outSets, modelica_metatype *out_outInnerOuterConnects, modelica_metatype *out_outCGraph);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_retrieveOuterConnections2,2,0) {(void*) boxptr_InnerOuter_retrieveOuterConnections2,0}};
#define boxvar_InnerOuter_retrieveOuterConnections2 MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_retrieveOuterConnections2)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_removeInnerPrefixFromCref(threadData_t *threadData, modelica_metatype _inPrefix, modelica_metatype _inCref);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_removeInnerPrefixFromCref,2,0) {(void*) boxptr_InnerOuter_removeInnerPrefixFromCref,0}};
#define boxvar_InnerOuter_removeInnerPrefixFromCref MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_removeInnerPrefixFromCref)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_extractCommonPart(threadData_t *threadData, modelica_metatype _prefixedCref, modelica_metatype _innerCref);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_extractCommonPart,2,0) {(void*) boxptr_InnerOuter_extractCommonPart,0}};
#define boxvar_InnerOuter_extractCommonPart MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_extractCommonPart)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_stripCommonCrefPart(threadData_t *threadData, modelica_metatype _outerCr, modelica_metatype _innerCr, modelica_metatype *out_outInnerCr);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_stripCommonCrefPart,2,0) {(void*) boxptr_InnerOuter_stripCommonCrefPart,0}};
#define boxvar_InnerOuter_stripCommonCrefPart MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_stripCommonCrefPart)
PROTECTED_FUNCTION_STATIC modelica_boolean omc_InnerOuter_isInnerOuterMatch(threadData_t *threadData, modelica_metatype _outerCr, modelica_metatype _innerCr);
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_InnerOuter_isInnerOuterMatch(threadData_t *threadData, modelica_metatype _outerCr, modelica_metatype _innerCr);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_isInnerOuterMatch,2,0) {(void*) boxptr_InnerOuter_isInnerOuterMatch,0}};
#define boxvar_InnerOuter_isInnerOuterMatch MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_isInnerOuterMatch)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_buildInnerOuterReplVar(threadData_t *threadData, modelica_metatype _innerVar, modelica_metatype _outerVars, modelica_metatype _inRepl);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_buildInnerOuterReplVar,2,0) {(void*) boxptr_InnerOuter_buildInnerOuterReplVar,0}};
#define boxvar_InnerOuter_buildInnerOuterReplVar MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_buildInnerOuterReplVar)
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_buildInnerOuterRepl(threadData_t *threadData, modelica_metatype _innerVars, modelica_metatype _outerVars, modelica_metatype _inRepl);
static const MMC_DEFSTRUCTLIT(boxvar_lit_InnerOuter_buildInnerOuterRepl,2,0) {(void*) boxptr_InnerOuter_buildInnerOuterRepl,0}};
#define boxvar_InnerOuter_buildInnerOuterRepl MMC_REFSTRUCTLIT(boxvar_lit_InnerOuter_buildInnerOuterRepl)
DLLExport
modelica_metatype omc_InnerOuter_valueArrayNth(threadData_t *threadData, modelica_metatype _valueArray, modelica_integer _pos, modelica_metatype *out_value)
{
modelica_metatype _key = NULL;
modelica_metatype _value = NULL;
modelica_metatype tmpMeta[6] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp4_1;
tmp4_1 = _valueArray;
{
modelica_metatype _k = NULL;
modelica_metatype _v = NULL;
modelica_integer _n;
modelica_metatype _arr = NULL;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
for (; tmp4 < 1; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
modelica_integer tmp6;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
tmp6 = mmc_unbox_integer(tmpMeta[2]);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
_n = tmp6;
_arr = tmpMeta[3];
if((!(_pos < _n)))
{
goto goto_2;
}
tmpMeta[2] = arrayGet(_arr,((modelica_integer) 1) + _pos);
if (optionNone(tmpMeta[2])) goto goto_2;
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 1));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 1));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 2));
_k = tmpMeta[4];
_v = tmpMeta[5];
tmpMeta[0+0] = _k;
tmpMeta[0+1] = _v;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
goto_2:;
MMC_THROW_INTERNAL();
goto tmp3_done;
tmp3_done:;
}
}
_key = tmpMeta[0+0];
_value = tmpMeta[0+1];
_return: OMC_LABEL_UNUSED
if (out_value) { *out_value = _value; }
return _key;
}
modelica_metatype boxptr_InnerOuter_valueArrayNth(threadData_t *threadData, modelica_metatype _valueArray, modelica_metatype _pos, modelica_metatype *out_value)
{
modelica_integer tmp1;
modelica_metatype _key = NULL;
tmp1 = mmc_unbox_integer(_pos);
_key = omc_InnerOuter_valueArrayNth(threadData, _valueArray, tmp1, out_value);
return _key;
}
DLLExport
modelica_metatype omc_InnerOuter_valueArrayClearnth(threadData_t *threadData, modelica_metatype _valueArray, modelica_integer _pos)
{
modelica_metatype _outValueArray = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _valueArray;
{
modelica_metatype _arr = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
_arr = tmpMeta[1];
if((!(_pos < arrayLength(_arr))))
{
goto goto_1;
}
arrayUpdate(_arr, ((modelica_integer) 1) + _pos, mmc_mk_none());
tmpMeta[0] = _valueArray;
goto tmp2_done;
}
case 1: {
fputs(MMC_STRINGDATA(_OMC_LIT0),stdout);
goto goto_1;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 2) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outValueArray = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outValueArray;
}
modelica_metatype boxptr_InnerOuter_valueArrayClearnth(threadData_t *threadData, modelica_metatype _valueArray, modelica_metatype _pos)
{
modelica_integer tmp1;
modelica_metatype _outValueArray = NULL;
tmp1 = mmc_unbox_integer(_pos);
_outValueArray = omc_InnerOuter_valueArrayClearnth(threadData, _valueArray, tmp1);
return _outValueArray;
}
DLLExport
modelica_metatype omc_InnerOuter_valueArraySetnth(threadData_t *threadData, modelica_metatype _valueArray, modelica_integer _pos, modelica_metatype _entry)
{
modelica_metatype _outValueArray = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _valueArray;
{
modelica_metatype _arr = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
_arr = tmpMeta[1];
if((!(_pos < arrayLength(_arr))))
{
goto goto_1;
}
arrayUpdate(_arr, ((modelica_integer) 1) + _pos, mmc_mk_some(_entry));
tmpMeta[0] = _valueArray;
goto tmp2_done;
}
case 1: {
fputs(MMC_STRINGDATA(_OMC_LIT1),stdout);
goto goto_1;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 2) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outValueArray = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outValueArray;
}
modelica_metatype boxptr_InnerOuter_valueArraySetnth(threadData_t *threadData, modelica_metatype _valueArray, modelica_metatype _pos, modelica_metatype _entry)
{
modelica_integer tmp1;
modelica_metatype _outValueArray = NULL;
tmp1 = mmc_unbox_integer(_pos);
_outValueArray = omc_InnerOuter_valueArraySetnth(threadData, _valueArray, tmp1, _entry);
return _outValueArray;
}
DLLExport
modelica_metatype omc_InnerOuter_valueArrayAdd(threadData_t *threadData, modelica_metatype _valueArray, modelica_metatype _entry)
{
modelica_metatype _outValueArray = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _valueArray;
{
modelica_integer _n_1;
modelica_integer _n;
modelica_integer _size;
modelica_integer _expandsize;
modelica_integer _expandsize_1;
modelica_metatype _arr_1 = NULL;
modelica_metatype _arr = NULL;
modelica_metatype _arr_2 = NULL;
modelica_real _rsize;
modelica_real _rexpandsize;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
modelica_integer tmp5;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmp5 = mmc_unbox_integer(tmpMeta[1]);
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
_n = tmp5;
_arr = tmpMeta[2];
if((!(_n < arrayLength(_arr))))
{
goto goto_1;
}
_n_1 = ((modelica_integer) 1) + _n;
_arr_1 = arrayUpdate(_arr, ((modelica_integer) 1) + _n, mmc_mk_some(_entry));
tmpMeta[1] = mmc_mk_box3(3, &InnerOuter_ValueArray_VALUE__ARRAY__desc, mmc_mk_integer(_n_1), _arr_1);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 1: {
modelica_integer tmp6;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmp6 = mmc_unbox_integer(tmpMeta[1]);
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
_n = tmp6;
_arr = tmpMeta[2];
_size = arrayLength(_arr);
if((_n < _size))
{
goto goto_1;
}
_rsize = ((modelica_real)_size);
_rexpandsize = (0.4) * (_rsize);
_expandsize = ((modelica_integer)floor(_rexpandsize));
_expandsize_1 = modelica_integer_max((modelica_integer)(_expandsize),(modelica_integer)(((modelica_integer) 1)));
_arr_1 = omc_Array_expand(threadData, _expandsize_1, _arr, mmc_mk_none());
_n_1 = ((modelica_integer) 1) + _n;
_arr_2 = arrayUpdate(_arr_1, ((modelica_integer) 1) + _n, mmc_mk_some(_entry));
tmpMeta[1] = mmc_mk_box3(3, &InnerOuter_ValueArray_VALUE__ARRAY__desc, mmc_mk_integer(_n_1), _arr_2);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 2: {
fputs(MMC_STRINGDATA(_OMC_LIT2),stdout);
goto goto_1;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 3) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outValueArray = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outValueArray;
}
DLLExport
modelica_integer omc_InnerOuter_valueArrayLength(threadData_t *threadData, modelica_metatype _valueArray)
{
modelica_integer _size;
modelica_integer tmp1 = 0;
modelica_metatype tmpMeta[1] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp4_1;
tmp4_1 = _valueArray;
{
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
for (; tmp4 < 1; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
modelica_integer tmp6;
tmpMeta[0] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
tmp6 = mmc_unbox_integer(tmpMeta[0]);
_size = tmp6;
tmp1 = _size;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
goto_2:;
MMC_THROW_INTERNAL();
goto tmp3_done;
tmp3_done:;
}
}
_size = tmp1;
_return: OMC_LABEL_UNUSED
return _size;
}
modelica_metatype boxptr_InnerOuter_valueArrayLength(threadData_t *threadData, modelica_metatype _valueArray)
{
modelica_integer _size;
modelica_metatype out_size;
_size = omc_InnerOuter_valueArrayLength(threadData, _valueArray);
out_size = mmc_mk_icon(_size);
return out_size;
}
DLLExport
modelica_metatype omc_InnerOuter_valueArrayList2(threadData_t *threadData, modelica_metatype _inVarOptionArray1, modelica_integer _inInteger2, modelica_integer _inInteger3)
{
modelica_metatype _outVarLst = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;volatile modelica_integer tmp3_2;volatile modelica_integer tmp3_3;
tmp3_1 = _inVarOptionArray1;
tmp3_2 = _inInteger2;
tmp3_3 = _inInteger3;
{
modelica_metatype _v = NULL;
modelica_metatype _arr = NULL;
modelica_integer _pos;
modelica_integer _lastpos;
modelica_integer _pos_1;
modelica_metatype _res = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
_arr = tmp3_1;
_pos = tmp3_2;
_lastpos = tmp3_3;
if((!(_pos == _lastpos)))
{
goto goto_1;
}
tmpMeta[1] = arrayGet(_arr,((modelica_integer) 1) + _pos);
if (optionNone(tmpMeta[1])) goto goto_1;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 1));
_v = tmpMeta[2];
tmpMeta[1] = mmc_mk_cons(_v, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 1: {
_arr = tmp3_1;
_pos = tmp3_2;
_lastpos = tmp3_3;
_pos_1 = ((modelica_integer) 1) + _pos;
tmpMeta[1] = arrayGet(_arr,((modelica_integer) 1) + _pos);
if (optionNone(tmpMeta[1])) goto goto_1;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 1));
_v = tmpMeta[2];
_res = omc_InnerOuter_valueArrayList2(threadData, _arr, _pos_1, _lastpos);
tmpMeta[1] = mmc_mk_cons(_v, _res);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 2: {
_arr = tmp3_1;
_pos = tmp3_2;
_lastpos = tmp3_3;
_pos_1 = ((modelica_integer) 1) + _pos;
tmpMeta[1] = arrayGet(_arr,((modelica_integer) 1) + _pos);
if (!optionNone(tmpMeta[1])) goto goto_1;
tmpMeta[0] = omc_InnerOuter_valueArrayList2(threadData, _arr, _pos_1, _lastpos);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 3) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outVarLst = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outVarLst;
}
modelica_metatype boxptr_InnerOuter_valueArrayList2(threadData_t *threadData, modelica_metatype _inVarOptionArray1, modelica_metatype _inInteger2, modelica_metatype _inInteger3)
{
modelica_integer tmp1;
modelica_integer tmp2;
modelica_metatype _outVarLst = NULL;
tmp1 = mmc_unbox_integer(_inInteger2);
tmp2 = mmc_unbox_integer(_inInteger3);
_outVarLst = omc_InnerOuter_valueArrayList2(threadData, _inVarOptionArray1, tmp1, tmp2);
return _outVarLst;
}
DLLExport
modelica_metatype omc_InnerOuter_valueArrayList(threadData_t *threadData, modelica_metatype _valueArray)
{
modelica_metatype _tplLst = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _valueArray;
{
modelica_metatype _arr = NULL;
modelica_metatype _elt = NULL;
modelica_integer _lastpos;
modelica_integer _n;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
modelica_integer tmp5;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmp5 = mmc_unbox_integer(tmpMeta[1]);
if (0 != tmp5) goto tmp2_end;
tmp3 += 1;
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 1: {
modelica_integer tmp6;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmp6 = mmc_unbox_integer(tmpMeta[1]);
if (1 != tmp6) goto tmp2_end;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
_arr = tmpMeta[2];
tmpMeta[1] = arrayGet(_arr,((modelica_integer) 1));
if (optionNone(tmpMeta[1])) goto goto_1;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 1));
_elt = tmpMeta[2];
tmpMeta[1] = mmc_mk_cons(_elt, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 2: {
modelica_integer tmp7;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmp7 = mmc_unbox_integer(tmpMeta[1]);
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
_n = tmp7;
_arr = tmpMeta[2];
_lastpos = ((modelica_integer) -1) + _n;
tmpMeta[0] = omc_InnerOuter_valueArrayList2(threadData, _arr, ((modelica_integer) 0), _lastpos);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 3) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_tplLst = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _tplLst;
}
DLLExport
modelica_metatype omc_InnerOuter_hashTableList(threadData_t *threadData, modelica_metatype _hashTable)
{
modelica_metatype _tplLst = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;
tmp3_1 = _hashTable;
{
modelica_metatype _varr = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 1; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
_varr = tmpMeta[1];
tmpMeta[0] = omc_InnerOuter_valueArrayList(threadData, _varr);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_tplLst = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _tplLst;
}
DLLExport
modelica_metatype omc_InnerOuter_hashTableKeyList(threadData_t *threadData, modelica_metatype _hashTable)
{
modelica_metatype _valLst = NULL;
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
_valLst = omc_List_map(threadData, omc_InnerOuter_hashTableList(threadData, _hashTable), boxvar_Util_tuple21);
_return: OMC_LABEL_UNUSED
return _valLst;
}
DLLExport
modelica_metatype omc_InnerOuter_hashTableValueList(threadData_t *threadData, modelica_metatype _hashTable)
{
modelica_metatype _valLst = NULL;
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
_valLst = omc_List_map(threadData, omc_InnerOuter_hashTableList(threadData, _hashTable), boxvar_Util_tuple22);
_return: OMC_LABEL_UNUSED
return _valLst;
}
DLLExport
modelica_integer omc_InnerOuter_get2(threadData_t *threadData, modelica_metatype _key, modelica_metatype _keyIndices)
{
modelica_integer _index;
modelica_integer tmp1 = 0;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp4_1;
tmp4_1 = _keyIndices;
{
modelica_metatype _key2 = NULL;
modelica_metatype _xs = NULL;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp3_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp4 < 2; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
modelica_integer tmp6;
modelica_boolean tmp7;
if (listEmpty(tmp4_1)) goto tmp3_end;
tmpMeta[0] = MMC_CAR(tmp4_1);
tmpMeta[1] = MMC_CDR(tmp4_1);
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 1));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 2));
tmp6 = mmc_unbox_integer(tmpMeta[3]);
_key2 = tmpMeta[2];
_index = tmp6;
tmp7 = omc_InnerOuter_keyEqual(threadData, _key, _key2);
if (1 != tmp7) goto goto_2;
tmp1 = _index;
goto tmp3_done;
}
case 1: {
if (listEmpty(tmp4_1)) goto tmp3_end;
tmpMeta[0] = MMC_CAR(tmp4_1);
tmpMeta[1] = MMC_CDR(tmp4_1);
_xs = tmpMeta[1];
tmp1 = omc_InnerOuter_get2(threadData, _key, _xs);
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
tmp3_done:
(void)tmp4;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp3_done2;
goto_2:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp4 < 2) {
goto tmp3_top;
}
MMC_THROW_INTERNAL();
tmp3_done2:;
}
}
_index = tmp1;
_return: OMC_LABEL_UNUSED
return _index;
}
modelica_metatype boxptr_InnerOuter_get2(threadData_t *threadData, modelica_metatype _key, modelica_metatype _keyIndices)
{
modelica_integer _index;
modelica_metatype out_index;
_index = omc_InnerOuter_get2(threadData, _key, _keyIndices);
out_index = mmc_mk_icon(_index);
return out_index;
}
DLLExport
modelica_metatype omc_InnerOuter_get1(threadData_t *threadData, modelica_metatype _key, modelica_metatype _hashTable, modelica_integer *out_indx)
{
modelica_metatype _value = NULL;
modelica_integer _indx;
modelica_integer tmp1_c1 __attribute__((unused)) = 0;
modelica_metatype tmpMeta[5] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp4_1;
tmp4_1 = _hashTable;
{
modelica_integer _hval;
modelica_integer _hashindx;
modelica_integer _bsize;
modelica_metatype _indexes = NULL;
modelica_metatype _v = NULL;
modelica_metatype _hashvec = NULL;
modelica_metatype _varr = NULL;
modelica_metatype _k = NULL;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
for (; tmp4 < 1; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
modelica_integer tmp6;
modelica_boolean tmp7;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 3));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 4));
tmp6 = mmc_unbox_integer(tmpMeta[4]);
_hashvec = tmpMeta[2];
_varr = tmpMeta[3];
_bsize = tmp6;
_hval = omc_InnerOuter_hashFunc(threadData, _key);
_hashindx = modelica_integer_mod(_hval, _bsize);
_indexes = arrayGet(_hashvec,((modelica_integer) 1) + _hashindx);
_indx = omc_InnerOuter_get2(threadData, _key, _indexes);
_k = omc_InnerOuter_valueArrayNth(threadData, _varr, _indx ,&_v);
tmp7 = omc_InnerOuter_keyEqual(threadData, _k, _key);
if (1 != tmp7) goto goto_2;
tmpMeta[0+0] = _v;
tmp1_c1 = _indx;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
goto_2:;
MMC_THROW_INTERNAL();
goto tmp3_done;
tmp3_done:;
}
}
_value = tmpMeta[0+0];
_indx = tmp1_c1;
_return: OMC_LABEL_UNUSED
if (out_indx) { *out_indx = _indx; }
return _value;
}
modelica_metatype boxptr_InnerOuter_get1(threadData_t *threadData, modelica_metatype _key, modelica_metatype _hashTable, modelica_metatype *out_indx)
{
modelica_integer _indx;
modelica_metatype _value = NULL;
_value = omc_InnerOuter_get1(threadData, _key, _hashTable, &_indx);
if (out_indx) { *out_indx = mmc_mk_icon(_indx); }
return _value;
}
DLLExport
modelica_metatype omc_InnerOuter_get(threadData_t *threadData, modelica_metatype _key, modelica_metatype _hashTable)
{
modelica_metatype _value = NULL;
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
_value = omc_InnerOuter_get1(threadData, _key, _hashTable, NULL);
_return: OMC_LABEL_UNUSED
return _value;
}
DLLExport
modelica_metatype omc_InnerOuter_delete(threadData_t *threadData, modelica_metatype _key, modelica_metatype _hashTable)
{
modelica_metatype _outHashTable = NULL;
modelica_metatype tmpMeta[5] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _hashTable;
{
modelica_integer _indx;
modelica_integer _n;
modelica_integer _bsize;
modelica_metatype _varr_1 = NULL;
modelica_metatype _varr = NULL;
modelica_metatype _hashvec = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
modelica_integer tmp5;
modelica_integer tmp6;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 4));
tmp5 = mmc_unbox_integer(tmpMeta[3]);
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 5));
tmp6 = mmc_unbox_integer(tmpMeta[4]);
_hashvec = tmpMeta[1];
_varr = tmpMeta[2];
_bsize = tmp5;
_n = tmp6;
omc_InnerOuter_get1(threadData, _key, _hashTable ,&_indx);
_varr_1 = omc_InnerOuter_valueArrayClearnth(threadData, _varr, _indx);
tmpMeta[1] = mmc_mk_box5(3, &InnerOuter_InstHierarchyHashTable_HASHTABLE__desc, _hashvec, _varr_1, mmc_mk_integer(_bsize), mmc_mk_integer(_n));
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 1: {
fputs(MMC_STRINGDATA(_OMC_LIT3),stdout);
fputs(MMC_STRINGDATA(_OMC_LIT4),stdout);
omc_InnerOuter_dumpInstHierarchyHashTable(threadData, _hashTable);
goto goto_1;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 2) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outHashTable = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outHashTable;
}
DLLExport
modelica_metatype omc_InnerOuter_addNoUpdCheck(threadData_t *threadData, modelica_metatype _entry, modelica_metatype _hashTable)
{
modelica_metatype _outHashTable = NULL;
modelica_metatype tmpMeta[5] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;volatile modelica_metatype tmp3_2;
tmp3_1 = _entry;
tmp3_2 = _hashTable;
{
modelica_integer _hval;
modelica_integer _indx;
modelica_integer _newpos;
modelica_integer _n_1;
modelica_integer _bsize;
modelica_metatype _varr_1 = NULL;
modelica_metatype _varr = NULL;
modelica_metatype _indexes = NULL;
modelica_metatype _hashvec_1 = NULL;
modelica_metatype _hashvec = NULL;
modelica_metatype _v = NULL;
modelica_metatype _key = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
modelica_integer tmp5;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 3));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 4));
tmp5 = mmc_unbox_integer(tmpMeta[4]);
_v = tmp3_1;
_key = tmpMeta[1];
_hashvec = tmpMeta[2];
_varr = tmpMeta[3];
_bsize = tmp5;
_hval = omc_InnerOuter_hashFunc(threadData, _key);
_indx = modelica_integer_mod(_hval, _bsize);
_newpos = omc_InnerOuter_valueArrayLength(threadData, _varr);
_varr_1 = omc_InnerOuter_valueArrayAdd(threadData, _varr, _v);
_indexes = arrayGet(_hashvec,((modelica_integer) 1) + _indx);
tmpMeta[2] = mmc_mk_box2(0, _key, mmc_mk_integer(_newpos));
tmpMeta[1] = mmc_mk_cons(tmpMeta[2], _indexes);
_hashvec_1 = arrayUpdate(_hashvec, ((modelica_integer) 1) + _indx, tmpMeta[1]);
_n_1 = omc_InnerOuter_valueArrayLength(threadData, _varr_1);
tmpMeta[1] = mmc_mk_box5(3, &InnerOuter_InstHierarchyHashTable_HASHTABLE__desc, _hashvec_1, _varr_1, mmc_mk_integer(_bsize), mmc_mk_integer(_n_1));
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 1: {
fputs(MMC_STRINGDATA(_OMC_LIT5),stdout);
goto goto_1;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 2) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outHashTable = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outHashTable;
}
DLLExport
modelica_metatype omc_InnerOuter_add(threadData_t *threadData, modelica_metatype _entry, modelica_metatype _hashTable)
{
modelica_metatype _outHashTable = NULL;
modelica_metatype tmpMeta[6] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;volatile modelica_metatype tmp3_2;
tmp3_1 = _entry;
tmp3_2 = _hashTable;
{
modelica_integer _hval;
modelica_integer _indx;
modelica_integer _newpos;
modelica_integer _n;
modelica_integer _n_1;
modelica_integer _bsize;
modelica_metatype _varr_1 = NULL;
modelica_metatype _varr = NULL;
modelica_metatype _indexes = NULL;
modelica_metatype _hashvec_1 = NULL;
modelica_metatype _hashvec = NULL;
modelica_metatype _v = NULL;
modelica_metatype _newv = NULL;
modelica_metatype _key = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
modelica_integer tmp5;
modelica_boolean tmp6;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 3));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 4));
tmp5 = mmc_unbox_integer(tmpMeta[4]);
_v = tmp3_1;
_key = tmpMeta[1];
_hashvec = tmpMeta[2];
_varr = tmpMeta[3];
_bsize = tmp5;
tmp6 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
omc_InnerOuter_get(threadData, _key, _hashTable);
tmp6 = 1;
goto goto_7;
goto_7:;
MMC_CATCH_INTERNAL(mmc_jumper)
if (tmp6) {goto goto_1;}
_hval = omc_InnerOuter_hashFunc(threadData, _key);
_indx = modelica_integer_mod(_hval, _bsize);
_newpos = omc_InnerOuter_valueArrayLength(threadData, _varr);
_varr_1 = omc_InnerOuter_valueArrayAdd(threadData, _varr, _v);
_indexes = arrayGet(_hashvec,((modelica_integer) 1) + _indx);
tmpMeta[2] = mmc_mk_box2(0, _key, mmc_mk_integer(_newpos));
tmpMeta[1] = mmc_mk_cons(tmpMeta[2], _indexes);
_hashvec_1 = arrayUpdate(_hashvec, ((modelica_integer) 1) + _indx, tmpMeta[1]);
_n_1 = omc_InnerOuter_valueArrayLength(threadData, _varr_1);
tmpMeta[1] = mmc_mk_box5(3, &InnerOuter_InstHierarchyHashTable_HASHTABLE__desc, _hashvec_1, _varr_1, mmc_mk_integer(_bsize), mmc_mk_integer(_n_1));
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 1: {
modelica_integer tmp8;
modelica_integer tmp9;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 1));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 3));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 4));
tmp8 = mmc_unbox_integer(tmpMeta[4]);
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 5));
tmp9 = mmc_unbox_integer(tmpMeta[5]);
_newv = tmp3_1;
_key = tmpMeta[1];
_hashvec = tmpMeta[2];
_varr = tmpMeta[3];
_bsize = tmp8;
_n = tmp9;
omc_InnerOuter_get1(threadData, _key, _hashTable ,&_indx);
_varr_1 = omc_InnerOuter_valueArraySetnth(threadData, _varr, _indx, _newv);
tmpMeta[1] = mmc_mk_box5(3, &InnerOuter_InstHierarchyHashTable_HASHTABLE__desc, _hashvec, _varr_1, mmc_mk_integer(_bsize), mmc_mk_integer(_n));
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 2: {
fputs(MMC_STRINGDATA(_OMC_LIT6),stdout);
goto goto_1;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 3) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outHashTable = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outHashTable;
}
DLLExport
modelica_boolean omc_InnerOuter_isEmpty(threadData_t *threadData, modelica_metatype _hashTable)
{
modelica_boolean _res;
modelica_boolean tmp1 = 0;
modelica_metatype tmpMeta[1] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp4_1;
tmp4_1 = _hashTable;
{
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
for (; tmp4 < 2; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
modelica_integer tmp6;
tmpMeta[0] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 5));
tmp6 = mmc_unbox_integer(tmpMeta[0]);
if (0 != tmp6) goto tmp3_end;
tmp1 = 1;
goto tmp3_done;
}
case 1: {
tmp1 = 0;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
goto_2:;
MMC_THROW_INTERNAL();
goto tmp3_done;
tmp3_done:;
}
}
_res = tmp1;
_return: OMC_LABEL_UNUSED
return _res;
}
modelica_metatype boxptr_InnerOuter_isEmpty(threadData_t *threadData, modelica_metatype _hashTable)
{
modelica_boolean _res;
modelica_metatype out_res;
_res = omc_InnerOuter_isEmpty(threadData, _hashTable);
out_res = mmc_mk_icon(_res);
return out_res;
}
DLLExport
modelica_metatype omc_InnerOuter_emptyInstHierarchyHashTable(threadData_t *threadData)
{
modelica_metatype _hashTable = NULL;
modelica_metatype _arr = NULL;
modelica_metatype _lst = NULL;
modelica_metatype _emptyarr = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
tmpMeta[0] = MMC_REFSTRUCTLIT(mmc_nil);
_arr = arrayCreate(((modelica_integer) 1000), tmpMeta[0]);
_emptyarr = arrayCreate(((modelica_integer) 100), mmc_mk_none());
tmpMeta[0] = mmc_mk_box3(3, &InnerOuter_ValueArray_VALUE__ARRAY__desc, mmc_mk_integer(((modelica_integer) 0)), _emptyarr);
tmpMeta[1] = mmc_mk_box5(3, &InnerOuter_InstHierarchyHashTable_HASHTABLE__desc, _arr, tmpMeta[0], mmc_mk_integer(((modelica_integer) 1000)), mmc_mk_integer(((modelica_integer) 0)));
_hashTable = tmpMeta[1];
_return: OMC_LABEL_UNUSED
return _hashTable;
}
DLLExport
modelica_metatype omc_InnerOuter_cloneInstHierarchyHashTable(threadData_t *threadData, modelica_metatype _inHash)
{
modelica_metatype _outHash = NULL;
modelica_metatype tmpMeta[7] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;
tmp3_1 = _inHash;
{
modelica_metatype _arg1 = NULL;
modelica_metatype _arg1_2 = NULL;
modelica_integer _arg3;
modelica_integer _arg4;
modelica_integer _arg3_2;
modelica_integer _arg4_2;
modelica_integer _arg21;
modelica_integer _arg21_2;
modelica_metatype _arg22 = NULL;
modelica_metatype _arg22_2 = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 1; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
modelica_integer tmp5;
modelica_integer tmp6;
modelica_integer tmp7;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 2));
tmp5 = mmc_unbox_integer(tmpMeta[3]);
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 3));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 4));
tmp6 = mmc_unbox_integer(tmpMeta[5]);
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 5));
tmp7 = mmc_unbox_integer(tmpMeta[6]);
_arg1 = tmpMeta[1];
_arg21 = tmp5;
_arg22 = tmpMeta[4];
_arg3 = tmp6;
_arg4 = tmp7;
_arg1_2 = arrayCopy(_arg1);
_arg21_2 = _arg21;
_arg22_2 = arrayCopy(_arg22);
_arg3_2 = _arg3;
_arg4_2 = _arg4;
tmpMeta[1] = mmc_mk_box3(3, &InnerOuter_ValueArray_VALUE__ARRAY__desc, mmc_mk_integer(_arg21_2), _arg22_2);
tmpMeta[2] = mmc_mk_box5(3, &InnerOuter_InstHierarchyHashTable_HASHTABLE__desc, _arg1_2, tmpMeta[1], mmc_mk_integer(_arg3_2), mmc_mk_integer(_arg4_2));
tmpMeta[0] = tmpMeta[2];
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outHash = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outHash;
}
DLLExport
modelica_string omc_InnerOuter_dumpTuple(threadData_t *threadData, modelica_metatype _tpl)
{
modelica_string _str = NULL;
modelica_string tmp1 = 0;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp4_1;
tmp4_1 = _tpl;
{
modelica_metatype _k = NULL;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
for (; tmp4 < 1; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
tmpMeta[0] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 1));
_k = tmpMeta[0];
tmpMeta[0] = stringAppend(_OMC_LIT7,omc_ComponentReference_crefStr(threadData, _k));
tmpMeta[1] = stringAppend(tmpMeta[0],_OMC_LIT8);
tmpMeta[2] = stringAppend(tmpMeta[1],_OMC_LIT9);
tmp1 = tmpMeta[2];
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
goto_2:;
MMC_THROW_INTERNAL();
goto tmp3_done;
tmp3_done:;
}
}
_str = tmp1;
_return: OMC_LABEL_UNUSED
return _str;
}
DLLExport
void omc_InnerOuter_dumpInstHierarchyHashTable(threadData_t *threadData, modelica_metatype _t)
{
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
fputs(MMC_STRINGDATA(_OMC_LIT10),stdout);
fputs(MMC_STRINGDATA(stringDelimitList(omc_List_map(threadData, omc_InnerOuter_hashTableList(threadData, _t), boxvar_InnerOuter_dumpTuple), _OMC_LIT11)),stdout);
fputs(MMC_STRINGDATA(_OMC_LIT11),stdout);
_return: OMC_LABEL_UNUSED
return;
}
DLLExport
modelica_boolean omc_InnerOuter_keyEqual(threadData_t *threadData, modelica_metatype _key1, modelica_metatype _key2)
{
modelica_boolean _res;
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
_res = omc_ComponentReference_crefEqualNoStringCompare(threadData, _key1, _key2);
_return: OMC_LABEL_UNUSED
return _res;
}
modelica_metatype boxptr_InnerOuter_keyEqual(threadData_t *threadData, modelica_metatype _key1, modelica_metatype _key2)
{
modelica_boolean _res;
modelica_metatype out_res;
_res = omc_InnerOuter_keyEqual(threadData, _key1, _key2);
out_res = mmc_mk_icon(_res);
return out_res;
}
DLLExport
modelica_integer omc_InnerOuter_hashFunc(threadData_t *threadData, modelica_metatype _k)
{
modelica_integer _res;
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
_res = stringHashDjb2(omc_ComponentReference_printComponentRefStr(threadData, _k));
_return: OMC_LABEL_UNUSED
return _res;
}
modelica_metatype boxptr_InnerOuter_hashFunc(threadData_t *threadData, modelica_metatype _k)
{
modelica_integer _res;
modelica_metatype out_res;
_res = omc_InnerOuter_hashFunc(threadData, _k);
out_res = mmc_mk_icon(_res);
return out_res;
}
DLLExport
modelica_metatype omc_InnerOuter_getValue(threadData_t *threadData, modelica_metatype _tpl)
{
modelica_metatype _v = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;
tmp3_1 = _tpl;
{
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 1; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
_v = tmpMeta[1];
tmpMeta[0] = _v;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_v = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _v;
}
DLLExport
modelica_metatype omc_InnerOuter_getInnersFromInstHierarchyHashTable(threadData_t *threadData, modelica_metatype _t)
{
modelica_metatype _inners = NULL;
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
_inners = omc_List_map(threadData, omc_InnerOuter_hashTableList(threadData, _t), boxvar_InnerOuter_getValue);
_return: OMC_LABEL_UNUSED
return _inners;
}
DLLExport
modelica_string omc_InnerOuter_getExistingInnerDeclarations(threadData_t *threadData, modelica_metatype _inIH, modelica_metatype _inEnv)
{
modelica_string _innerDeclarations = NULL;
modelica_string tmp1 = 0;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp4_1;
tmp4_1 = _inIH;
{
modelica_metatype _ht = NULL;
modelica_metatype _inners = NULL;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
for (; tmp4 < 2; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
if (!listEmpty(tmp4_1)) goto tmp3_end;
tmpMeta[0] = stringAppend(_OMC_LIT12,omc_FGraph_printGraphPathStr(threadData, _inEnv));
tmpMeta[1] = stringAppend(tmpMeta[0],_OMC_LIT13);
tmp1 = tmpMeta[1];
goto tmp3_done;
}
case 1: {
if (listEmpty(tmp4_1)) goto tmp3_end;
tmpMeta[0] = MMC_CAR(tmp4_1);
tmpMeta[1] = MMC_CDR(tmp4_1);
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 3));
_ht = tmpMeta[2];
_inners = omc_InnerOuter_getInnersFromInstHierarchyHashTable(threadData, _ht);
tmp1 = stringDelimitList(omc_List_map(threadData, _inners, boxvar_InnerOuter_printInnerDefStr), _OMC_LIT14);
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
goto_2:;
MMC_THROW_INTERNAL();
goto tmp3_done;
tmp3_done:;
}
}
_innerDeclarations = tmp1;
_return: OMC_LABEL_UNUSED
return _innerDeclarations;
}
DLLExport
modelica_string omc_InnerOuter_printInnerDefStr(threadData_t *threadData, modelica_metatype _inInstInner)
{
modelica_string _outStr = NULL;
modelica_string tmp1 = 0;
modelica_metatype tmpMeta[6] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp4_1;
tmp4_1 = _inInstInner;
{
modelica_string _fullName = NULL;
modelica_metatype _typePath = NULL;
modelica_string _scope = NULL;
modelica_metatype _outers = NULL;
modelica_string _strOuters = NULL;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
for (; tmp4 < 1; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
modelica_boolean tmp6;
modelica_string tmp7;
tmpMeta[0] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 5));
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 6));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 7));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 9));
_fullName = tmpMeta[0];
_typePath = tmpMeta[1];
_scope = tmpMeta[2];
_outers = tmpMeta[3];
_outers = omc_List_uniqueOnTrue(threadData, _outers, boxvar_ComponentReference_crefEqualNoStringCompare);
tmp6 = (modelica_boolean)listEmpty(_outers);
if(tmp6)
{
tmp7 = _OMC_LIT15;
}
else
{
tmpMeta[0] = stringAppend(_OMC_LIT16,stringDelimitList(omc_List_map(threadData, _outers, boxvar_ComponentReference_printComponentRefStr), _OMC_LIT17));
tmpMeta[1] = stringAppend(tmpMeta[0],_OMC_LIT18);
tmp7 = tmpMeta[1];
}
_strOuters = tmp7;
tmpMeta[0] = stringAppend(omc_AbsynUtil_pathString(threadData, _typePath, _OMC_LIT13, 1, 0),_OMC_LIT19);
tmpMeta[1] = stringAppend(tmpMeta[0],_fullName);
tmpMeta[2] = stringAppend(tmpMeta[1],_OMC_LIT20);
tmpMeta[3] = stringAppend(tmpMeta[2],_scope);
tmpMeta[4] = stringAppend(tmpMeta[3],_OMC_LIT13);
tmpMeta[5] = stringAppend(tmpMeta[4],_strOuters);
tmp1 = tmpMeta[5];
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
goto_2:;
MMC_THROW_INTERNAL();
goto tmp3_done;
tmp3_done:;
}
}
_outStr = tmp1;
_return: OMC_LABEL_UNUSED
return _outStr;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_searchForInnerPrefix(threadData_t *threadData, modelica_metatype _fullCref, modelica_metatype _inOuterCref, modelica_metatype _outerPrefixes, modelica_metatype *out_innerCrefPrefix)
{
modelica_metatype _outerCrefPrefix = NULL;
modelica_metatype _innerCrefPrefix = NULL;
modelica_metatype _cr = NULL;
modelica_metatype _id = NULL;
modelica_boolean _b1;
modelica_boolean _b2;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
_b1 = 0;
_b2 = 0;
{
modelica_metatype _op;
for (tmpMeta[0] = _outerPrefixes; !listEmpty(tmpMeta[0]); tmpMeta[0]=MMC_CDR(tmpMeta[0]))
{
_op = MMC_CAR(tmpMeta[0]);
tmpMeta[1] = _op;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
_outerCrefPrefix = tmpMeta[2];
_b1 = omc_ComponentReference_crefPrefixOfIgnoreSubscripts(threadData, _outerCrefPrefix, _fullCref);
if((!_b1))
{
_cr = omc_ComponentReference_crefStripLastIdent(threadData, _outerCrefPrefix);
_b2 = ((stringEqual(omc_ComponentReference_crefLastIdent(threadData, _outerCrefPrefix), omc_ComponentReference_crefFirstIdent(threadData, _inOuterCref))) && omc_ComponentReference_crefPrefixOfIgnoreSubscripts(threadData, _cr, _fullCref));
}
if((_b1 || _b2))
{
tmpMeta[1] = _op;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
_innerCrefPrefix = tmpMeta[2];
goto _return;
}
}
}
MMC_THROW_INTERNAL();
_return: OMC_LABEL_UNUSED
if (out_innerCrefPrefix) { *out_innerCrefPrefix = _innerCrefPrefix; }
return _outerCrefPrefix;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_changeOuterReferenceToInnerReference(threadData_t *threadData, modelica_metatype _inFullCref, modelica_metatype _inOuterCrefPrefix, modelica_metatype _inInnerCrefPrefix)
{
modelica_metatype _outInnerCref = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;modelica_metatype tmp3_3;
tmp3_1 = _inFullCref;
tmp3_2 = _inOuterCrefPrefix;
tmp3_3 = _inInnerCrefPrefix;
{
modelica_metatype _ifull = NULL;
modelica_metatype _ocp = NULL;
modelica_metatype _icp = NULL;
modelica_metatype _eifull = NULL;
modelica_metatype _eocp = NULL;
modelica_metatype _eicp = NULL;
modelica_metatype _epre = NULL;
modelica_metatype _erest = NULL;
modelica_metatype _esuffix = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 1; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
_ifull = tmp3_1;
_ocp = tmp3_2;
_icp = tmp3_3;
_eifull = omc_ComponentReference_explode(threadData, _ifull);
_eicp = omc_ComponentReference_explode(threadData, _icp);
_eocp = omc_List_split(threadData, _eifull, omc_ComponentReference_identifierCount(threadData, _ocp) ,&_esuffix);
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
_epre = omc_List_splitEqualPrefix(threadData, _eocp, _eicp, boxvar_ComponentReference_crefFirstIdentEqual, tmpMeta[1] ,&_erest);
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
omc_List_splitEqualPrefix(threadData, _eicp, _epre, boxvar_ComponentReference_crefFirstIdentEqual, tmpMeta[1] ,&_eicp);
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
_erest = omc_List_splitEqualPrefix(threadData, listReverse(_erest), listReverse(_eicp), boxvar_ComponentReference_crefFirstIdentEqual, tmpMeta[1], NULL);
_erest = omc_List_append__reverse(threadData, _erest, _esuffix);
_eifull = listAppend(_epre, _erest);
tmpMeta[0] = omc_ComponentReference_implode(threadData, _eifull);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outInnerCref = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outInnerCref;
}
DLLExport
modelica_metatype omc_InnerOuter_prefixOuterCrefWithTheInnerPrefix(threadData_t *threadData, modelica_metatype _inIH, modelica_metatype _inOuterComponentRef, modelica_metatype _inPrefix)
{
modelica_metatype _outInnerComponentRef = NULL;
modelica_metatype tmpMeta[6] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;
tmp3_1 = _inIH;
{
modelica_metatype _outerCrefPrefix = NULL;
modelica_metatype _fullCref = NULL;
modelica_metatype _innerCrefPrefix = NULL;
modelica_metatype _outerPrefixes = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
goto goto_1;
goto tmp2_done;
}
case 1: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
if (listEmpty(tmpMeta[3])) goto tmp2_end;
tmpMeta[4] = MMC_CAR(tmpMeta[3]);
tmpMeta[5] = MMC_CDR(tmpMeta[3]);
if (!listEmpty(tmpMeta[2])) goto tmp2_end;
_outerPrefixes = tmpMeta[3];
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
omc_PrefixUtil_prefixCref(threadData, omc_FCore_emptyCache(threadData), omc_FGraph_empty(threadData), tmpMeta[1], _inPrefix, _inOuterComponentRef ,&_fullCref);
_outerCrefPrefix = omc_InnerOuter_searchForInnerPrefix(threadData, _fullCref, _inOuterComponentRef, _outerPrefixes ,&_innerCrefPrefix);
tmpMeta[0] = omc_InnerOuter_changeOuterReferenceToInnerReference(threadData, _fullCref, _outerCrefPrefix, _innerCrefPrefix);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outInnerComponentRef = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outInnerComponentRef;
}
DLLExport
modelica_metatype omc_InnerOuter_addOuterPrefixToIH(threadData_t *threadData, modelica_metatype _inIH, modelica_metatype _inOuterComponentRef, modelica_metatype _inInnerComponentRef)
{
modelica_metatype _outIH = NULL;
modelica_metatype tmpMeta[7] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _inIH;
{
modelica_metatype _tih = NULL;
modelica_metatype _restIH = NULL;
modelica_metatype _ht = NULL;
modelica_metatype _pathOpt = NULL;
modelica_metatype _outerPrefixes = NULL;
modelica_metatype _sm = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
tmp3 += 1;
_ht = omc_InnerOuter_emptyInstHierarchyHashTable(threadData);
_sm = omc_HashSet_emptyHashSet(threadData);
tmpMeta[2] = mmc_mk_box3(3, &InnerOuter_OuterPrefix_OUTER__desc, omc_ComponentReference_crefStripSubs(threadData, _inOuterComponentRef), _inInnerComponentRef);
tmpMeta[1] = mmc_mk_cons(tmpMeta[2], MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[3] = mmc_mk_box5(3, &InnerOuter_TopInstance_TOP__INSTANCE__desc, mmc_mk_none(), _ht, tmpMeta[1], _sm);
_tih = tmpMeta[3];
tmpMeta[1] = mmc_mk_cons(_tih, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 1: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 5));
_pathOpt = tmpMeta[3];
_ht = tmpMeta[4];
_outerPrefixes = tmpMeta[5];
_sm = tmpMeta[6];
_restIH = tmpMeta[2];
tmpMeta[1] = mmc_mk_box3(3, &InnerOuter_OuterPrefix_OUTER__desc, omc_ComponentReference_crefStripSubs(threadData, _inOuterComponentRef), _inInnerComponentRef);
_outerPrefixes = omc_List_unionElt(threadData, tmpMeta[1], _outerPrefixes);
tmpMeta[2] = mmc_mk_box5(3, &InnerOuter_TopInstance_TOP__INSTANCE__desc, _pathOpt, _ht, _outerPrefixes, _sm);
tmpMeta[1] = mmc_mk_cons(tmpMeta[2], _restIH);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 2: {
modelica_boolean tmp5;
tmp5 = omc_Flags_isSet(threadData, _OMC_LIT24);
if (1 != tmp5) goto goto_1;
tmpMeta[1] = stringAppend(_OMC_LIT25,omc_ComponentReference_printComponentRefStr(threadData, _inOuterComponentRef));
tmpMeta[2] = stringAppend(tmpMeta[1],_OMC_LIT26);
tmpMeta[3] = stringAppend(tmpMeta[2],omc_ComponentReference_printComponentRefStr(threadData, _inInnerComponentRef));
tmpMeta[4] = stringAppend(tmpMeta[3],_OMC_LIT27);
omc_Debug_traceln(threadData, tmpMeta[4]);
goto goto_1;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 3) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outIH = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outIH;
}
DLLExport
modelica_metatype omc_InnerOuter_addClassIfInner(threadData_t *threadData, modelica_metatype _inClass, modelica_metatype _inPrefix, modelica_metatype _inScope, modelica_metatype _inIH)
{
modelica_metatype _outIH = NULL;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _inClass;
{
modelica_string _name = NULL;
modelica_string _scopeName = NULL;
modelica_metatype _io = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
modelica_boolean tmp5;
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,2,8) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 5));
_name = tmpMeta[1];
_io = tmpMeta[3];
tmp5 = omc_AbsynUtil_isInner(threadData, _io);
if (1 != tmp5) goto goto_1;
_scopeName = omc_FGraph_getGraphNameStr(threadData, _inScope);
tmpMeta[1] = mmc_mk_box2(4, &Absyn_Path_IDENT__desc, _name);
tmpMeta[2] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[3] = mmc_mk_box10(3, &InnerOuter_InstInner_INST__INNER__desc, _inPrefix, _name, _io, _name, tmpMeta[1], _scopeName, mmc_mk_none(), tmpMeta[2], mmc_mk_some(_inClass));
tmpMeta[0] = omc_InnerOuter_updateInstHierarchy(threadData, _inIH, _inPrefix, _io, tmpMeta[3]);
goto tmp2_done;
}
case 1: {
tmpMeta[0] = _inIH;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 2) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outIH = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outIH;
}
DLLExport
modelica_metatype omc_InnerOuter_updateSMHierarchy(threadData_t *threadData, modelica_metatype _smState, modelica_metatype _inIH)
{
modelica_metatype _outIH = NULL;
modelica_metatype tmpMeta[7] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _smState;
tmp3_2 = _inIH;
{
modelica_metatype _tih = NULL;
modelica_metatype _restIH = NULL;
modelica_metatype _cref = NULL;
modelica_string _name = NULL;
modelica_metatype _ht = NULL;
modelica_metatype _pathOpt = NULL;
modelica_metatype _outerPrefixes = NULL;
modelica_metatype _sm = NULL;
modelica_metatype _sm2 = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_2)) goto tmp2_end;
_ht = omc_InnerOuter_emptyInstHierarchyHashTable(threadData);
_sm = omc_HashSet_emptyHashSet(threadData);
_sm2 = omc_BaseHashSet_add(threadData, _smState, _sm);
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[2] = mmc_mk_box5(3, &InnerOuter_TopInstance_TOP__INSTANCE__desc, mmc_mk_none(), _ht, tmpMeta[1], _sm2);
_tih = tmpMeta[2];
tmpMeta[1] = mmc_mk_cons(_tih, MMC_REFSTRUCTLIT(mmc_nil));
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 1: {
if (listEmpty(tmp3_2)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_2);
tmpMeta[2] = MMC_CDR(tmp3_2);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 5));
_pathOpt = tmpMeta[3];
_ht = tmpMeta[4];
_outerPrefixes = tmpMeta[5];
_sm = tmpMeta[6];
_restIH = tmpMeta[2];
_cref = tmp3_1;
_sm = omc_BaseHashSet_add(threadData, _cref, _sm);
tmpMeta[2] = mmc_mk_box5(3, &InnerOuter_TopInstance_TOP__INSTANCE__desc, _pathOpt, _ht, _outerPrefixes, _sm);
tmpMeta[1] = mmc_mk_cons(tmpMeta[2], _restIH);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 2: {
modelica_boolean tmp5;
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,1,3) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
_name = tmpMeta[1];
tmp5 = omc_Flags_isSet(threadData, _OMC_LIT31);
if (1 != tmp5) goto goto_1;
tmpMeta[1] = stringAppend(_OMC_LIT32,_name);
omc_Debug_traceln(threadData, tmpMeta[1]);
goto goto_1;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outIH = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outIH;
}
DLLExport
modelica_metatype omc_InnerOuter_updateInstHierarchy(threadData_t *threadData, modelica_metatype _inIH, modelica_metatype _inPrefix, modelica_metatype _inInnerOuter, modelica_metatype _inInstInner)
{
modelica_metatype _outIH = NULL;
modelica_metatype tmpMeta[8] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inIH;
tmp3_2 = _inInstInner;
{
modelica_metatype _tih = NULL;
modelica_metatype _restIH = NULL;
modelica_metatype _cref = NULL;
modelica_string _name = NULL;
modelica_metatype _ht = NULL;
modelica_metatype _pathOpt = NULL;
modelica_metatype _outerPrefixes = NULL;
modelica_metatype _cref_ = NULL;
modelica_metatype _sm = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
_ht = omc_InnerOuter_emptyInstHierarchyHashTable(threadData);
_sm = omc_HashSet_emptyHashSet(threadData);
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[2] = mmc_mk_box5(3, &InnerOuter_TopInstance_TOP__INSTANCE__desc, mmc_mk_none(), _ht, tmpMeta[1], _sm);
_tih = tmpMeta[2];
tmpMeta[1] = mmc_mk_cons(_tih, MMC_REFSTRUCTLIT(mmc_nil));
_inIH = tmpMeta[1];
goto _tailrecursive;
goto tmp2_done;
}
case 1: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 5));
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 3));
_pathOpt = tmpMeta[3];
_ht = tmpMeta[4];
_outerPrefixes = tmpMeta[5];
_sm = tmpMeta[6];
_restIH = tmpMeta[2];
_name = tmpMeta[7];
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
_cref_ = omc_ComponentReference_makeCrefIdent(threadData, _name, _OMC_LIT33, tmpMeta[1]);
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
omc_PrefixUtil_prefixCref(threadData, omc_FCore_emptyCache(threadData), omc_FGraph_empty(threadData), tmpMeta[1], _inPrefix, _cref_ ,&_cref);
tmpMeta[1] = mmc_mk_box2(0, _cref, _inInstInner);
_ht = omc_InnerOuter_add(threadData, tmpMeta[1], _ht);
tmpMeta[2] = mmc_mk_box5(3, &InnerOuter_TopInstance_TOP__INSTANCE__desc, _pathOpt, _ht, _outerPrefixes, _sm);
tmpMeta[1] = mmc_mk_cons(tmpMeta[2], _restIH);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outIH = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outIH;
}
DLLExport
modelica_metatype omc_InnerOuter_lookupInnerVar(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _inPrefix, modelica_string _inIdent, modelica_metatype _io)
{
modelica_metatype _outInstInner = NULL;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;volatile modelica_metatype tmp3_2;volatile modelica_string tmp3_3;
tmp3_1 = _inIH;
tmp3_2 = _inPrefix;
tmp3_3 = _inIdent;
{
modelica_string _n = NULL;
modelica_metatype _pre = NULL;
modelica_metatype _tih = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
_tih = tmpMeta[1];
_pre = tmp3_2;
_n = tmp3_3;
tmpMeta[0] = omc_InnerOuter_lookupInnerInIH(threadData, _tih, _pre, _n);
goto tmp2_done;
}
case 1: {
modelica_boolean tmp5;
_pre = tmp3_2;
_n = tmp3_3;
tmp5 = omc_Flags_isSet(threadData, _OMC_LIT24);
if (1 != tmp5) goto goto_1;
tmpMeta[1] = stringAppend(_OMC_LIT34,omc_PrefixUtil_printPrefixStr(threadData, _pre));
tmpMeta[2] = stringAppend(tmpMeta[1],_OMC_LIT35);
tmpMeta[3] = stringAppend(tmpMeta[2],_n);
omc_Debug_traceln(threadData, tmpMeta[3]);
goto goto_1;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 2) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outInstInner = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outInstInner;
}
DLLExport
modelica_metatype omc_InnerOuter_emptyInstInner(threadData_t *threadData, modelica_metatype _innerPrefix, modelica_string _name)
{
modelica_metatype _outInstInner = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
tmpMeta[0] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[1] = mmc_mk_box10(3, &InnerOuter_InstInner_INST__INNER__desc, _innerPrefix, _name, _OMC_LIT36, _OMC_LIT15, _OMC_LIT37, _OMC_LIT15, mmc_mk_none(), tmpMeta[0], mmc_mk_none());
_outInstInner = tmpMeta[1];
_return: OMC_LABEL_UNUSED
return _outInstInner;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_switchInnerToOuterInChildrenValue(threadData_t *threadData, modelica_metatype _inNode, modelica_metatype _inCr)
{
modelica_metatype _outNode = NULL;
modelica_metatype tmpMeta[9] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _inNode;
{
modelica_metatype _r = NULL;
modelica_metatype _node = NULL;
modelica_string _name = NULL;
modelica_metatype _attributes = NULL;
modelica_metatype _visibility = NULL;
modelica_metatype _ty = NULL;
modelica_metatype _binding = NULL;
modelica_boolean _bndsrc;
modelica_metatype _ct = NULL;
modelica_metatype _parallelism = NULL;
modelica_metatype _variability = NULL;
modelica_metatype _direction = NULL;
modelica_metatype _cnstForRange = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
modelica_integer tmp5;
_node = tmp3_1;
_r = omc_FNode_childFromNode(threadData, _node, _OMC_LIT38);
tmpMeta[1] = omc_FNode_refData(threadData, _r);
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],1,1) == 0) goto goto_1;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 3));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 4));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 5));
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 6));
tmp5 = mmc_unbox_integer(tmpMeta[7]);
tmpMeta[8] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 7));
_name = tmpMeta[3];
_attributes = tmpMeta[4];
_ty = tmpMeta[5];
_binding = tmpMeta[6];
_bndsrc = tmp5;
_cnstForRange = tmpMeta[8];
tmpMeta[1] = _attributes;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 5));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 6));
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[6],0,0) == 0) goto goto_1;
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 7));
_ct = tmpMeta[2];
_parallelism = tmpMeta[3];
_variability = tmpMeta[4];
_direction = tmpMeta[5];
_visibility = tmpMeta[7];
tmpMeta[1] = mmc_mk_box7(3, &DAE_Attributes_ATTR__desc, _ct, _parallelism, _variability, _direction, _OMC_LIT39, _visibility);
_attributes = tmpMeta[1];
tmpMeta[1] = mmc_mk_box7(3, &DAE_Var_TYPES__VAR__desc, _name, _attributes, _ty, _binding, mmc_mk_boolean(_bndsrc), _cnstForRange);
tmpMeta[2] = mmc_mk_box2(4, &FCore_Data_IT__desc, tmpMeta[1]);
_r = omc_FNode_updateRef(threadData, _r, omc_FNode_setData(threadData, omc_FNode_fromRef(threadData, _r), tmpMeta[2]));
tmpMeta[0] = _node;
goto tmp2_done;
}
case 1: {
modelica_integer tmp6;
_node = tmp3_1;
_r = omc_FNode_childFromNode(threadData, _node, _OMC_LIT38);
tmpMeta[1] = omc_FNode_refData(threadData, _r);
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],1,1) == 0) goto goto_1;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 3));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 4));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 5));
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 6));
tmp6 = mmc_unbox_integer(tmpMeta[7]);
tmpMeta[8] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 7));
_name = tmpMeta[3];
_attributes = tmpMeta[4];
_ty = tmpMeta[5];
_binding = tmpMeta[6];
_bndsrc = tmp6;
_cnstForRange = tmpMeta[8];
tmpMeta[1] = _attributes;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 5));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 6));
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[6],2,0) == 0) goto goto_1;
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 7));
_ct = tmpMeta[2];
_parallelism = tmpMeta[3];
_variability = tmpMeta[4];
_direction = tmpMeta[5];
_visibility = tmpMeta[7];
tmpMeta[1] = mmc_mk_box7(3, &DAE_Attributes_ATTR__desc, _ct, _parallelism, _variability, _direction, _OMC_LIT39, _visibility);
_attributes = tmpMeta[1];
tmpMeta[1] = mmc_mk_box7(3, &DAE_Var_TYPES__VAR__desc, _name, _attributes, _ty, _binding, mmc_mk_boolean(_bndsrc), _cnstForRange);
tmpMeta[2] = mmc_mk_box2(4, &FCore_Data_IT__desc, tmpMeta[1]);
_r = omc_FNode_updateRef(threadData, _r, omc_FNode_setData(threadData, omc_FNode_fromRef(threadData, _r), tmpMeta[2]));
tmpMeta[0] = _node;
goto tmp2_done;
}
case 2: {
tmpMeta[0] = _inNode;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 3) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outNode = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outNode;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_switchInnerToOuterInChild(threadData_t *threadData, modelica_string _name, modelica_metatype _cr, modelica_metatype _inRef)
{
modelica_metatype _ref = NULL;
modelica_metatype _n = NULL;
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
_n = omc_FNode_fromRef(threadData, _inRef);
_n = omc_InnerOuter_switchInnerToOuterInChildrenValue(threadData, _n, _cr);
_ref = omc_FNode_updateRef(threadData, _inRef, _n);
_return: OMC_LABEL_UNUSED
return _ref;
}
static modelica_metatype closure0_InnerOuter_switchInnerToOuterInChild(threadData_t *thData, modelica_metatype closure, modelica_string name, modelica_metatype inRef)
{
modelica_metatype cr = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(closure),1));
return boxptr_InnerOuter_switchInnerToOuterInChild(thData, name, cr, inRef);
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_switchInnerToOuterInNode(threadData_t *threadData, modelica_metatype _inNode, modelica_metatype _inCr)
{
modelica_metatype _outNode = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
_outNode = _inNode;
{
modelica_metatype tmp3_1;
tmp3_1 = _outNode;
{
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
tmpMeta[1] = mmc_mk_box1(0, _inCr);
tmpMeta[0] = MMC_TAGPTR(mmc_alloc_words(7));
memcpy(MMC_UNTAGPTR(tmpMeta[0]), MMC_UNTAGPTR(_outNode), 7*sizeof(modelica_metatype));
((modelica_metatype*)MMC_UNTAGPTR(tmpMeta[0]))[5] = omc_FCore_RefTree_map(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_outNode), 5))), (modelica_fnptr) mmc_mk_box2(0,closure0_InnerOuter_switchInnerToOuterInChild,tmpMeta[1]));
_outNode = tmpMeta[0];
goto tmp2_done;
}
case 1: {
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
;
_return: OMC_LABEL_UNUSED
return _outNode;
}
DLLExport
modelica_metatype omc_InnerOuter_switchInnerToOuterInGraph(threadData_t *threadData, modelica_metatype _inEnv, modelica_metatype _inCr)
{
modelica_metatype _outEnv = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _inEnv;
tmp3_2 = _inCr;
{
modelica_metatype _cr = NULL;
modelica_metatype _r = NULL;
modelica_metatype _n = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,1,1) == 0) goto tmp2_end;
tmpMeta[0] = _inEnv;
goto tmp2_done;
}
case 1: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,2) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
if (!listEmpty(tmpMeta[1])) goto tmp2_end;
tmpMeta[0] = _inEnv;
goto tmp2_done;
}
case 2: {
_cr = tmp3_2;
_r = omc_FGraph_lastScopeRef(threadData, _inEnv);
_n = omc_FNode_fromRef(threadData, _r);
_n = omc_InnerOuter_switchInnerToOuterInNode(threadData, _n, _cr);
_r = omc_FNode_updateRef(threadData, _r, _n);
tmpMeta[0] = _inEnv;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outEnv = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outEnv;
}
DLLExport
modelica_metatype omc_InnerOuter_prefixOuterDaeVars(threadData_t *threadData, modelica_metatype _inDae, modelica_metatype _crefPrefix)
{
modelica_metatype _outDae = NULL;
modelica_metatype tmpMeta[16] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _inDae;
{
modelica_metatype _lst = NULL;
modelica_metatype _r_1 = NULL;
modelica_metatype _r = NULL;
modelica_metatype _lst_1 = NULL;
modelica_metatype _cr = NULL;
modelica_metatype _vk = NULL;
modelica_metatype _t = NULL;
modelica_metatype _e = NULL;
modelica_metatype _id = NULL;
modelica_metatype _ct = NULL;
modelica_metatype _dae_var_attr = NULL;
modelica_metatype _comment = NULL;
modelica_metatype _dir = NULL;
modelica_metatype _prl = NULL;
modelica_metatype _x = NULL;
modelica_metatype _io = NULL;
modelica_metatype _prot = NULL;
modelica_string _idName = NULL;
modelica_metatype _source = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 4; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
tmp3 += 3;
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 1: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],0,13) == 0) goto tmp2_end;
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 5));
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 6));
tmpMeta[8] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 7));
tmpMeta[9] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 8));
tmpMeta[10] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 9));
tmpMeta[11] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 10));
tmpMeta[12] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 11));
tmpMeta[13] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 12));
tmpMeta[14] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 13));
tmpMeta[15] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 14));
_cr = tmpMeta[3];
_vk = tmpMeta[4];
_dir = tmpMeta[5];
_prl = tmpMeta[6];
_prot = tmpMeta[7];
_t = tmpMeta[8];
_e = tmpMeta[9];
_id = tmpMeta[10];
_ct = tmpMeta[11];
_source = tmpMeta[12];
_dae_var_attr = tmpMeta[13];
_comment = tmpMeta[14];
_io = tmpMeta[15];
_r = tmpMeta[2];
tmp3 += 1;
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
omc_PrefixUtil_prefixCref(threadData, omc_FCore_emptyCache(threadData), omc_FGraph_empty(threadData), tmpMeta[1], _crefPrefix, _cr ,&_cr);
_r_1 = omc_InnerOuter_prefixOuterDaeVars(threadData, _r, _crefPrefix);
tmpMeta[2] = mmc_mk_box14(3, &DAE_Element_VAR__desc, _cr, _vk, _dir, _prl, _prot, _t, _e, _id, _ct, _source, _dae_var_attr, _comment, _io);
tmpMeta[1] = mmc_mk_cons(tmpMeta[2], _r_1);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 2: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],17,4) == 0) goto tmp2_end;
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 5));
_idName = tmpMeta[3];
_lst = tmpMeta[4];
_source = tmpMeta[5];
_comment = tmpMeta[6];
_r = tmpMeta[2];
_lst_1 = omc_InnerOuter_prefixOuterDaeVars(threadData, _lst, _crefPrefix);
_r_1 = omc_InnerOuter_prefixOuterDaeVars(threadData, _r, _crefPrefix);
tmpMeta[2] = mmc_mk_box5(20, &DAE_Element_COMP__desc, _idName, _lst_1, _source, _comment);
tmpMeta[1] = mmc_mk_cons(tmpMeta[2], _r_1);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 3: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
_x = tmpMeta[1];
_r = tmpMeta[2];
_r_1 = omc_InnerOuter_prefixOuterDaeVars(threadData, _r, _crefPrefix);
tmpMeta[1] = mmc_mk_cons(_x, _r_1);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 4) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outDae = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outDae;
}
DLLExport
modelica_metatype omc_InnerOuter_switchInnerToOuterAndPrefix(threadData_t *threadData, modelica_metatype _inDae, modelica_metatype _io, modelica_metatype _pre)
{
modelica_metatype _outDae = NULL;
modelica_metatype tmpMeta[16] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;volatile modelica_metatype tmp3_2;
tmp3_1 = _inDae;
tmp3_2 = _io;
{
modelica_metatype _lst = NULL;
modelica_metatype _r_1 = NULL;
modelica_metatype _r = NULL;
modelica_metatype _lst_1 = NULL;
modelica_metatype _v = NULL;
modelica_metatype _cr = NULL;
modelica_metatype _vk = NULL;
modelica_metatype _t = NULL;
modelica_metatype _e = NULL;
modelica_metatype _id = NULL;
modelica_metatype _ct = NULL;
modelica_metatype _dae_var_attr = NULL;
modelica_metatype _comment = NULL;
modelica_metatype _dir = NULL;
modelica_metatype _prl = NULL;
modelica_metatype _x = NULL;
modelica_metatype _prot = NULL;
modelica_string _idName = NULL;
modelica_metatype _source = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 6; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_2,3,0) == 0) goto tmp2_end;
_lst = tmp3_1;
tmpMeta[0] = _lst;
goto tmp2_done;
}
case 1: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
tmp3 += 4;
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 2: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],0,13) == 0) goto tmp2_end;
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 5));
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 6));
tmpMeta[8] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 7));
tmpMeta[9] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 8));
tmpMeta[10] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 9));
tmpMeta[11] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 10));
tmpMeta[12] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 11));
tmpMeta[13] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 12));
tmpMeta[14] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 13));
tmpMeta[15] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 14));
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[15],0,0) == 0) goto tmp2_end;
_cr = tmpMeta[3];
_vk = tmpMeta[4];
_dir = tmpMeta[5];
_prl = tmpMeta[6];
_prot = tmpMeta[7];
_t = tmpMeta[8];
_e = tmpMeta[9];
_id = tmpMeta[10];
_ct = tmpMeta[11];
_source = tmpMeta[12];
_dae_var_attr = tmpMeta[13];
_comment = tmpMeta[14];
_r = tmpMeta[2];
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
omc_PrefixUtil_prefixCref(threadData, omc_FCore_emptyCache(threadData), omc_FGraph_empty(threadData), tmpMeta[1], _pre, _cr ,&_cr);
_r_1 = omc_InnerOuter_switchInnerToOuterAndPrefix(threadData, _r, _io, _pre);
tmpMeta[2] = mmc_mk_box14(3, &DAE_Element_VAR__desc, _cr, _vk, _dir, _prl, _prot, _t, _e, _id, _ct, _source, _dae_var_attr, _comment, _io);
tmpMeta[1] = mmc_mk_cons(tmpMeta[2], _r_1);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 3: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],0,13) == 0) goto tmp2_end;
_v = tmpMeta[1];
_r = tmpMeta[2];
tmp3 += 1;
_r_1 = omc_InnerOuter_switchInnerToOuterAndPrefix(threadData, _r, _io, _pre);
tmpMeta[1] = mmc_mk_cons(_v, _r_1);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 4: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],17,4) == 0) goto tmp2_end;
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 3));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 5));
_idName = tmpMeta[3];
_lst = tmpMeta[4];
_source = tmpMeta[5];
_comment = tmpMeta[6];
_r = tmpMeta[2];
_lst_1 = omc_InnerOuter_switchInnerToOuterAndPrefix(threadData, _lst, _io, _pre);
_r_1 = omc_InnerOuter_switchInnerToOuterAndPrefix(threadData, _r, _io, _pre);
tmpMeta[2] = mmc_mk_box5(20, &DAE_Element_COMP__desc, _idName, _lst_1, _source, _comment);
tmpMeta[1] = mmc_mk_cons(tmpMeta[2], _r_1);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 5: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
_x = tmpMeta[1];
_r = tmpMeta[2];
_r_1 = omc_InnerOuter_switchInnerToOuterAndPrefix(threadData, _r, _io, _pre);
tmpMeta[1] = mmc_mk_cons(_x, _r_1);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 6) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outDae = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outDae;
}
DLLExport
modelica_boolean omc_InnerOuter_modificationOnOuter(threadData_t *threadData, modelica_metatype _cache, modelica_metatype _env, modelica_metatype _ih, modelica_metatype _prefix, modelica_string _componentName, modelica_metatype _cr, modelica_metatype _inMod, modelica_metatype _io, modelica_boolean _impl, modelica_metatype _inInfo)
{
modelica_boolean _modd;
modelica_boolean tmp1 = 0;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp4_1;volatile modelica_metatype tmp4_2;
tmp4_1 = _inMod;
tmp4_2 = _io;
{
modelica_string _s1 = NULL;
modelica_string _s2 = NULL;
modelica_string _s = NULL;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp3_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp4 < 2; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,5) == 0) goto tmp3_end;
if (mmc__uniontype__metarecord__typedef__equal(tmp4_2,1,0) == 0) goto tmp3_end;
_s1 = omc_ComponentReference_printComponentRefStr(threadData, _cr);
_s2 = omc_Mod_prettyPrintMod(threadData, _inMod, ((modelica_integer) 0));
tmpMeta[0] = stringAppend(_s1,_OMC_LIT19);
tmpMeta[1] = stringAppend(tmpMeta[0],_s2);
_s = tmpMeta[1];
tmpMeta[0] = mmc_mk_cons(_s, MMC_REFSTRUCTLIT(mmc_nil));
omc_Error_addSourceMessage(threadData, _OMC_LIT44, tmpMeta[0], _inInfo);
tmp1 = 1;
goto tmp3_done;
}
case 1: {
tmp1 = 0;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
tmp3_done:
(void)tmp4;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp3_done2;
goto_2:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp4 < 2) {
goto tmp3_top;
}
MMC_THROW_INTERNAL();
tmp3_done2:;
}
}
_modd = tmp1;
_return: OMC_LABEL_UNUSED
return _modd;
}
modelica_metatype boxptr_InnerOuter_modificationOnOuter(threadData_t *threadData, modelica_metatype _cache, modelica_metatype _env, modelica_metatype _ih, modelica_metatype _prefix, modelica_metatype _componentName, modelica_metatype _cr, modelica_metatype _inMod, modelica_metatype _io, modelica_metatype _impl, modelica_metatype _inInfo)
{
modelica_integer tmp1;
modelica_boolean _modd;
modelica_metatype out_modd;
tmp1 = mmc_unbox_integer(_impl);
_modd = omc_InnerOuter_modificationOnOuter(threadData, _cache, _env, _ih, _prefix, _componentName, _cr, _inMod, _io, tmp1, _inInfo);
out_modd = mmc_mk_icon(_modd);
return out_modd;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_lookupInnerInIH(threadData_t *threadData, modelica_metatype _inTIH, modelica_metatype _inPrefix, modelica_string _inComponentIdent)
{
modelica_metatype _outInstInner = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;volatile modelica_metatype tmp3_2;volatile modelica_string tmp3_3;
tmp3_1 = _inTIH;
tmp3_2 = _inPrefix;
tmp3_3 = _inComponentIdent;
{
modelica_string _name = NULL;
modelica_metatype _prefix = NULL;
modelica_metatype _ht = NULL;
modelica_metatype _cref = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 5; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_2,1,2) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_2), 2));
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[1],1,0) == 0) goto tmp2_end;
tmp3 += 1;
tmpMeta[0] = omc_InnerOuter_lookupInnerInIH(threadData, _inTIH, _OMC_LIT45, _inComponentIdent);
goto tmp2_done;
}
case 1: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_2,0,0) == 0) goto tmp2_end;
_name = tmp3_3;
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[2] = mmc_mk_box10(3, &InnerOuter_InstInner_INST__INNER__desc, _OMC_LIT45, _name, _OMC_LIT36, _OMC_LIT15, _OMC_LIT37, _OMC_LIT15, mmc_mk_none(), tmpMeta[1], mmc_mk_none());
tmpMeta[0] = tmpMeta[2];
goto tmp2_done;
}
case 2: {
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
_ht = tmpMeta[1];
_name = tmp3_3;
_prefix = omc_PrefixUtil_prefixStripLast(threadData, _inPrefix);
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[2] = MMC_REFSTRUCTLIT(mmc_nil);
omc_PrefixUtil_prefixCref(threadData, omc_FCore_emptyCache(threadData), omc_FGraph_empty(threadData), tmpMeta[1], _prefix, omc_ComponentReference_makeCrefIdent(threadData, _name, _OMC_LIT33, tmpMeta[2]) ,&_cref);
tmpMeta[0] = omc_InnerOuter_get(threadData, _cref, _ht);
goto tmp2_done;
}
case 3: {
modelica_boolean tmp5;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
_ht = tmpMeta[1];
_name = tmp3_3;
_prefix = omc_PrefixUtil_prefixStripLast(threadData, _inPrefix);
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[2] = MMC_REFSTRUCTLIT(mmc_nil);
omc_PrefixUtil_prefixCref(threadData, omc_FCore_emptyCache(threadData), omc_FGraph_empty(threadData), tmpMeta[1], _prefix, omc_ComponentReference_makeCrefIdent(threadData, _name, _OMC_LIT33, tmpMeta[2]) ,&_cref);
tmp5 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
omc_InnerOuter_get(threadData, _cref, _ht);
tmp5 = 1;
goto goto_6;
goto_6:;
MMC_CATCH_INTERNAL(mmc_jumper)
if (tmp5) {goto goto_1;}
tmpMeta[0] = omc_InnerOuter_lookupInnerInIH(threadData, _inTIH, _prefix, _name);
goto tmp2_done;
}
case 4: {
_prefix = tmp3_2;
_name = tmp3_3;
tmpMeta[1] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[2] = mmc_mk_box10(3, &InnerOuter_InstInner_INST__INNER__desc, _prefix, _name, _OMC_LIT36, _OMC_LIT15, _OMC_LIT37, _OMC_LIT15, mmc_mk_none(), tmpMeta[1], mmc_mk_none());
tmpMeta[0] = tmpMeta[2];
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 5) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outInstInner = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outInstInner;
}
DLLExport
modelica_boolean omc_InnerOuter_outerConnection(threadData_t *threadData, modelica_metatype _io1, modelica_metatype _io2)
{
modelica_boolean _isOuter;
modelica_boolean tmp1 = 0;
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp4_1;modelica_metatype tmp4_2;
tmp4_1 = _io1;
tmp4_2 = _io2;
{
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
for (; tmp4 < 5; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,0) == 0) goto tmp3_end;
tmp1 = 1;
goto tmp3_done;
}
case 1: {
if (mmc__uniontype__metarecord__typedef__equal(tmp4_2,1,0) == 0) goto tmp3_end;
tmp1 = 1;
goto tmp3_done;
}
case 2: {
if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,2,0) == 0) goto tmp3_end;
tmp1 = 1;
goto tmp3_done;
}
case 3: {
if (mmc__uniontype__metarecord__typedef__equal(tmp4_2,2,0) == 0) goto tmp3_end;
tmp1 = 1;
goto tmp3_done;
}
case 4: {
tmp1 = 0;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
goto_2:;
MMC_THROW_INTERNAL();
goto tmp3_done;
tmp3_done:;
}
}
_isOuter = tmp1;
_return: OMC_LABEL_UNUSED
return _isOuter;
}
modelica_metatype boxptr_InnerOuter_outerConnection(threadData_t *threadData, modelica_metatype _io1, modelica_metatype _io2)
{
modelica_boolean _isOuter;
modelica_metatype out_isOuter;
_isOuter = omc_InnerOuter_outerConnection(threadData, _io1, _io2);
out_isOuter = mmc_mk_icon(_isOuter);
return out_isOuter;
}
DLLExport
modelica_boolean omc_InnerOuter_referOuter(threadData_t *threadData, modelica_metatype _io1, modelica_metatype _io2, modelica_boolean *out_prefix2)
{
modelica_boolean _prefix1;
modelica_boolean _prefix2;
modelica_boolean tmp1_c0 __attribute__((unused)) = 0;
modelica_boolean tmp1_c1 __attribute__((unused)) = 0;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp4_1;modelica_metatype tmp4_2;
tmp4_1 = _io1;
tmp4_2 = _io2;
{
modelica_boolean _b1;
modelica_boolean _b2;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
for (; tmp4 < 3; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,2,0) == 0) goto tmp3_end;
if (mmc__uniontype__metarecord__typedef__equal(tmp4_2,3,0) == 0) goto tmp3_end;
tmp1_c0 = 1;
tmp1_c1 = 0;
goto tmp3_done;
}
case 1: {
if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,2,0) == 0) goto tmp3_end;
if (mmc__uniontype__metarecord__typedef__equal(tmp4_2,1,0) == 0) goto tmp3_end;
tmp1_c0 = 0;
tmp1_c1 = 1;
goto tmp3_done;
}
case 2: {
omc_InnerOuter_innerOuterBooleans(threadData, _io1 ,&_b1);
omc_InnerOuter_innerOuterBooleans(threadData, _io2 ,&_b2);
tmp1_c0 = _b1;
tmp1_c1 = _b2;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
goto_2:;
MMC_THROW_INTERNAL();
goto tmp3_done;
tmp3_done:;
}
}
_prefix1 = tmp1_c0;
_prefix2 = tmp1_c1;
_return: OMC_LABEL_UNUSED
if (out_prefix2) { *out_prefix2 = _prefix2; }
return _prefix1;
}
modelica_metatype boxptr_InnerOuter_referOuter(threadData_t *threadData, modelica_metatype _io1, modelica_metatype _io2, modelica_metatype *out_prefix2)
{
modelica_boolean _prefix2;
modelica_boolean _prefix1;
modelica_metatype out_prefix1;
_prefix1 = omc_InnerOuter_referOuter(threadData, _io1, _io2, &_prefix2);
out_prefix1 = mmc_mk_icon(_prefix1);
if (out_prefix2) { *out_prefix2 = mmc_mk_icon(_prefix2); }
return out_prefix1;
}
DLLExport
modelica_boolean omc_InnerOuter_innerOuterBooleans(threadData_t *threadData, modelica_metatype _io, modelica_boolean *out_outer1)
{
modelica_boolean _inner1;
modelica_boolean _outer1;
modelica_boolean tmp1_c0 __attribute__((unused)) = 0;
modelica_boolean tmp1_c1 __attribute__((unused)) = 0;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp4_1;
tmp4_1 = _io;
{
int tmp4;
{
switch (MMC_SWITCH_CAST(valueConstructor(tmp4_1))) {
case 3: {
tmp1_c0 = 1;
tmp1_c1 = 0;
goto tmp3_done;
}
case 4: {
tmp1_c0 = 0;
tmp1_c1 = 1;
goto tmp3_done;
}
case 5: {
tmp1_c0 = 1;
tmp1_c1 = 1;
goto tmp3_done;
}
case 6: {
tmp1_c0 = 0;
tmp1_c1 = 0;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
goto_2:;
MMC_THROW_INTERNAL();
goto tmp3_done;
tmp3_done:;
}
}
_inner1 = tmp1_c0;
_outer1 = tmp1_c1;
_return: OMC_LABEL_UNUSED
if (out_outer1) { *out_outer1 = _outer1; }
return _inner1;
}
modelica_metatype boxptr_InnerOuter_innerOuterBooleans(threadData_t *threadData, modelica_metatype _io, modelica_metatype *out_outer1)
{
modelica_boolean _outer1;
modelica_boolean _inner1;
modelica_metatype out_inner1;
_inner1 = omc_InnerOuter_innerOuterBooleans(threadData, _io, &_outer1);
out_inner1 = mmc_mk_icon(_inner1);
if (out_outer1) { *out_outer1 = mmc_mk_icon(_outer1); }
return out_inner1;
}
DLLExport
void omc_InnerOuter_failExceptForCheck(threadData_t *threadData)
{
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
{
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 1; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
modelica_boolean tmp5;
tmp5 = omc_Flags_getConfigBool(threadData, _OMC_LIT51);
if (1 != tmp5) goto goto_1;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
;
_return: OMC_LABEL_UNUSED
return;
}
PROTECTED_FUNCTION_STATIC void omc_InnerOuter_checkMissingInnerDecl2(threadData_t *threadData, modelica_metatype _outerVar, modelica_metatype _innerVars)
{
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;
tmp3_1 = _outerVar;
{
modelica_string _str = NULL;
modelica_string _str2 = NULL;
modelica_metatype _cr = NULL;
modelica_metatype _crs = NULL;
modelica_metatype _res = NULL;
modelica_metatype _io = NULL;
modelica_metatype _source = NULL;
modelica_metatype _info = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 1; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,13) == 0) goto tmp2_end;
tmpMeta[0] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 11));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 14));
_cr = tmpMeta[0];
_source = tmpMeta[1];
_io = tmpMeta[2];
_crs = omc_List_map(threadData, _innerVars, boxvar_DAEUtil_varCref);
_res = omc_List_select1(threadData, _crs, boxvar_InnerOuter_isInnerOuterMatch, _cr);
if(listEmpty(_res))
{
if((!omc_Flags_getConfigBool(threadData, _OMC_LIT51)))
{
_str2 = omc_Dump_unparseInnerouterStr(threadData, _io);
_str = omc_ComponentReference_printComponentRefStr(threadData, _cr);
_info = omc_ElementSource_getElementSourceFileInfo(threadData, _source);
tmpMeta[0] = mmc_mk_cons(_str, mmc_mk_cons(_str2, MMC_REFSTRUCTLIT(mmc_nil)));
omc_Error_addSourceMessage(threadData, _OMC_LIT54, tmpMeta[0], _info);
goto goto_1;
}
}
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
;
_return: OMC_LABEL_UNUSED
return;
}
PROTECTED_FUNCTION_STATIC void omc_InnerOuter_checkMissingInnerDecl1(threadData_t *threadData, modelica_metatype _innerVarsDae, modelica_metatype _outerVarsDae)
{
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
omc_List_map1__0(threadData, omc_DAEUtil_daeElements(threadData, _outerVarsDae), boxvar_InnerOuter_checkMissingInnerDecl2, omc_DAEUtil_daeElements(threadData, _innerVarsDae));
_return: OMC_LABEL_UNUSED
return;
}
DLLExport
void omc_InnerOuter_checkMissingInnerDecl(threadData_t *threadData, modelica_metatype _inDae, modelica_boolean _callScope)
{
modelica_metatype _innerVars = NULL;
modelica_metatype _outerVars = NULL;
modelica_metatype _allVars = NULL;
modelica_metatype _repl = NULL;
modelica_metatype _srcs = NULL;
modelica_metatype _targets = NULL;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_boolean tmp3_1;
tmp3_1 = _callScope;
{
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
modelica_boolean tmp5;
tmp5 = omc_System_getHasInnerOuterDefinitions(threadData);
if (0 != tmp5) goto goto_1;
goto tmp2_done;
}
case 1: {
if (1 != tmp3_1) goto tmp2_end;
tmp3 += 1;
tmpMeta[2] = omc_DAEUtil_findAllMatchingElements(threadData, _inDae, boxvar_DAEUtil_isInnerVar, boxvar_DAEUtil_isOuterVar, &tmpMeta[0]);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 2));
_innerVars = tmpMeta[3];
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 2));
_outerVars = tmpMeta[1];
tmpMeta[0] = mmc_mk_box2(3, &DAE_DAElist_DAE__desc, _innerVars);
tmpMeta[1] = mmc_mk_box2(3, &DAE_DAElist_DAE__desc, _outerVars);
omc_InnerOuter_checkMissingInnerDecl1(threadData, tmpMeta[0], tmpMeta[1]);
goto tmp2_done;
}
case 2: {
if (0 != tmp3_1) goto tmp2_end;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 3) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
;
_return: OMC_LABEL_UNUSED
return;
}
void boxptr_InnerOuter_checkMissingInnerDecl(threadData_t *threadData, modelica_metatype _inDae, modelica_metatype _callScope)
{
modelica_integer tmp1;
tmp1 = mmc_unbox_integer(_callScope);
omc_InnerOuter_checkMissingInnerDecl(threadData, _inDae, tmp1);
return;
}
PROTECTED_FUNCTION_STATIC modelica_boolean omc_InnerOuter_lookupVarInnerOuterAttr(threadData_t *threadData, modelica_metatype _cache, modelica_metatype _env, modelica_metatype _inIH, modelica_metatype _cr1, modelica_metatype _cr2, modelica_boolean *out_isOuter)
{
modelica_boolean _isInner;
modelica_boolean _isOuter;
modelica_boolean tmp1_c0 __attribute__((unused)) = 0;
modelica_boolean tmp1_c1 __attribute__((unused)) = 0;
modelica_metatype tmpMeta[4] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
{
modelica_metatype _io = NULL;
modelica_metatype _io1 = NULL;
modelica_metatype _io2 = NULL;
modelica_boolean _isInner1;
modelica_boolean _isInner2;
modelica_boolean _isOuter1;
modelica_boolean _isOuter2;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp3_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp4 < 4; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
omc_ErrorExt_setCheckpoint(threadData, _OMC_LIT55);
omc_Lookup_lookupVar(threadData, _cache, _env, _cr1, &tmpMeta[2], NULL, NULL, NULL, NULL, NULL, NULL, NULL);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 6));
_io1 = tmpMeta[3];
omc_Lookup_lookupVar(threadData, _cache, _env, _cr2, &tmpMeta[2], NULL, NULL, NULL, NULL, NULL, NULL, NULL);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 6));
_io2 = tmpMeta[3];
_isInner1 = omc_InnerOuter_innerOuterBooleans(threadData, _io1 ,&_isOuter1);
_isInner2 = omc_InnerOuter_innerOuterBooleans(threadData, _io2 ,&_isOuter2);
_isInner = (_isInner1 || _isInner2);
_isOuter = (_isOuter1 || _isOuter2);
omc_ErrorExt_rollBack(threadData, _OMC_LIT55);
tmp1_c0 = _isInner;
tmp1_c1 = _isOuter;
goto tmp3_done;
}
case 1: {
omc_Lookup_lookupVar(threadData, _cache, _env, _cr1, &tmpMeta[2], NULL, NULL, NULL, NULL, NULL, NULL, NULL);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 6));
_io = tmpMeta[3];
_isInner = omc_InnerOuter_innerOuterBooleans(threadData, _io ,&_isOuter);
omc_ErrorExt_rollBack(threadData, _OMC_LIT55);
tmp1_c0 = _isInner;
tmp1_c1 = _isOuter;
goto tmp3_done;
}
case 2: {
omc_Lookup_lookupVar(threadData, _cache, _env, _cr2, &tmpMeta[2], NULL, NULL, NULL, NULL, NULL, NULL, NULL);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 6));
_io = tmpMeta[3];
_isInner = omc_InnerOuter_innerOuterBooleans(threadData, _io ,&_isOuter);
omc_ErrorExt_rollBack(threadData, _OMC_LIT55);
tmp1_c0 = _isInner;
tmp1_c1 = _isOuter;
goto tmp3_done;
}
case 3: {
omc_ErrorExt_rollBack(threadData, _OMC_LIT55);
goto goto_2;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
tmp3_done:
(void)tmp4;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp3_done2;
goto_2:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp4 < 4) {
goto tmp3_top;
}
MMC_THROW_INTERNAL();
tmp3_done2:;
}
}
_isInner = tmp1_c0;
_isOuter = tmp1_c1;
_return: OMC_LABEL_UNUSED
if (out_isOuter) { *out_isOuter = _isOuter; }
return _isInner;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_InnerOuter_lookupVarInnerOuterAttr(threadData_t *threadData, modelica_metatype _cache, modelica_metatype _env, modelica_metatype _inIH, modelica_metatype _cr1, modelica_metatype _cr2, modelica_metatype *out_isOuter)
{
modelica_boolean _isOuter;
modelica_boolean _isInner;
modelica_metatype out_isInner;
_isInner = omc_InnerOuter_lookupVarInnerOuterAttr(threadData, _cache, _env, _inIH, _cr1, _cr2, &_isOuter);
out_isInner = mmc_mk_icon(_isInner);
if (out_isOuter) { *out_isOuter = mmc_mk_icon(_isOuter); }
return out_isInner;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_removeOuter(threadData_t *threadData, modelica_metatype _io)
{
modelica_metatype _outIo = NULL;
modelica_metatype tmpMeta[1] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;
tmp3_1 = _io;
{
int tmp3;
{
switch (MMC_SWITCH_CAST(valueConstructor(tmp3_1))) {
case 4: {
tmpMeta[0] = _OMC_LIT36;
goto tmp2_done;
}
case 3: {
tmpMeta[0] = _OMC_LIT56;
goto tmp2_done;
}
case 5: {
tmpMeta[0] = _OMC_LIT56;
goto tmp2_done;
}
case 6: {
tmpMeta[0] = _OMC_LIT36;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outIo = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outIo;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_addOuterConnectIfEmptyNoEnv(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _inPre, modelica_metatype _inSets, modelica_boolean _added, modelica_metatype _cr1, modelica_metatype _iio1, modelica_metatype _f1, modelica_metatype _cr2, modelica_metatype _iio2, modelica_metatype _f2, modelica_metatype _info)
{
modelica_metatype _outSets = NULL;
modelica_metatype tmpMeta[10] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;volatile modelica_metatype tmp3_2;volatile modelica_metatype tmp3_3;volatile modelica_metatype tmp3_4;volatile modelica_boolean tmp3_5;volatile modelica_metatype tmp3_6;volatile modelica_metatype tmp3_7;
tmp3_1 = _inCache;
tmp3_2 = _inEnv;
tmp3_3 = _inIH;
tmp3_4 = _inSets;
tmp3_5 = _added;
tmp3_6 = _iio1;
tmp3_7 = _iio2;
{
modelica_metatype _vt1 = NULL;
modelica_metatype _vt2 = NULL;
modelica_metatype _t1 = NULL;
modelica_metatype _t2 = NULL;
modelica_metatype _ct = NULL;
modelica_metatype _ih = NULL;
modelica_metatype _sets = NULL;
modelica_integer _sc;
modelica_metatype _cl = NULL;
modelica_metatype _oc = NULL;
modelica_metatype _cache = NULL;
modelica_metatype _env = NULL;
modelica_metatype _io1 = NULL;
modelica_metatype _io2 = NULL;
modelica_metatype _pre = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 4; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (1 != tmp3_5) goto tmp2_end;
tmp3 += 2;
tmpMeta[0] = _inSets;
goto tmp2_done;
}
case 1: {
modelica_integer tmp5;
modelica_integer tmp6;
if (0 != tmp3_5) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_4), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_4), 3));
tmp5 = mmc_unbox_integer(tmpMeta[2]);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_4), 4));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_4), 5));
_cache = tmp3_1;
_env = tmp3_2;
_ih = tmp3_3;
_sets = tmpMeta[1];
_sc = tmp5;
_cl = tmpMeta[3];
_oc = tmpMeta[4];
_io1 = tmp3_6;
_io2 = tmp3_7;
tmpMeta[5] = omc_Lookup_lookupVar(threadData, _cache, _env, _cr1, &tmpMeta[1], &tmpMeta[4], NULL, NULL, NULL, NULL, NULL, NULL);
_cache = tmpMeta[5];
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
_ct = tmpMeta[2];
_vt1 = tmpMeta[3];
_t1 = tmpMeta[4];
_pre = _OMC_LIT45;
_t2 = _t1;
_vt2 = _vt1;
_io1 = omc_InnerOuter_removeOuter(threadData, _io1);
_io2 = omc_InnerOuter_removeOuter(threadData, _io2);
tmpMeta[7] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[8] = mmc_mk_box5(3, &DAE_Connect_Sets_SETS__desc, _sets, mmc_mk_integer(_sc), _cl, tmpMeta[7]);
tmpMeta[9] = omc_InstSection_connectComponents(threadData, _cache, _env, _ih, tmpMeta[8], _pre, _cr1, _f1, _t1, _vt1, _cr2, _f2, _t2, _vt2, _ct, _io1, _io2, _OMC_LIT57, _info, &tmpMeta[1], &tmpMeta[2], &tmpMeta[3], NULL, NULL);
_cache = tmpMeta[9];
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 2));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 3));
tmp6 = mmc_unbox_integer(tmpMeta[5]);
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 4));
_env = tmpMeta[1];
_ih = tmpMeta[2];
_sets = tmpMeta[4];
_sc = tmp6;
_cl = tmpMeta[6];
tmpMeta[1] = mmc_mk_box5(3, &DAE_Connect_Sets_SETS__desc, _sets, mmc_mk_integer(_sc), _cl, _oc);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 2: {
modelica_integer tmp7;
modelica_integer tmp8;
if (0 != tmp3_5) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_4), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_4), 3));
tmp7 = mmc_unbox_integer(tmpMeta[2]);
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_4), 4));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_4), 5));
_cache = tmp3_1;
_env = tmp3_2;
_ih = tmp3_3;
_sets = tmpMeta[1];
_sc = tmp7;
_cl = tmpMeta[3];
_oc = tmpMeta[4];
_io1 = tmp3_6;
_io2 = tmp3_7;
_pre = _OMC_LIT45;
tmpMeta[5] = omc_Lookup_lookupVar(threadData, _cache, _env, _cr2, &tmpMeta[1], &tmpMeta[4], NULL, NULL, NULL, NULL, NULL, NULL);
_cache = tmpMeta[5];
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[1]), 4));
_ct = tmpMeta[2];
_vt2 = tmpMeta[3];
_t2 = tmpMeta[4];
_t1 = _t2;
_vt1 = _vt2;
_io1 = omc_InnerOuter_removeOuter(threadData, _io1);
_io2 = omc_InnerOuter_removeOuter(threadData, _io2);
tmpMeta[7] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[8] = mmc_mk_box5(3, &DAE_Connect_Sets_SETS__desc, _sets, mmc_mk_integer(_sc), _cl, tmpMeta[7]);
tmpMeta[9] = omc_InstSection_connectComponents(threadData, _cache, _env, _ih, tmpMeta[8], _pre, _cr1, _f1, _t1, _vt1, _cr2, _f2, _t2, _vt2, _ct, _io1, _io2, _OMC_LIT57, _info, &tmpMeta[1], &tmpMeta[2], &tmpMeta[3], NULL, NULL);
_cache = tmpMeta[9];
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 2));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 3));
tmp8 = mmc_unbox_integer(tmpMeta[5]);
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[3]), 4));
_env = tmpMeta[1];
_ih = tmpMeta[2];
_sets = tmpMeta[4];
_sc = tmp8;
_cl = tmpMeta[6];
tmpMeta[1] = mmc_mk_box5(3, &DAE_Connect_Sets_SETS__desc, _sets, mmc_mk_integer(_sc), _cl, _oc);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 3: {
fputs(MMC_STRINGDATA(_OMC_LIT58),stdout);
goto goto_1;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 4) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outSets = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outSets;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_InnerOuter_addOuterConnectIfEmptyNoEnv(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _inPre, modelica_metatype _inSets, modelica_metatype _added, modelica_metatype _cr1, modelica_metatype _iio1, modelica_metatype _f1, modelica_metatype _cr2, modelica_metatype _iio2, modelica_metatype _f2, modelica_metatype _info)
{
modelica_integer tmp1;
modelica_metatype _outSets = NULL;
tmp1 = mmc_unbox_integer(_added);
_outSets = omc_InnerOuter_addOuterConnectIfEmptyNoEnv(threadData, _inCache, _inEnv, _inIH, _inPre, _inSets, tmp1, _cr1, _iio1, _f1, _cr2, _iio2, _f2, _info);
return _outSets;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_addOuterConnectIfEmpty(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _pre, modelica_metatype _inSets, modelica_boolean _added, modelica_metatype _cr1, modelica_metatype _iio1, modelica_metatype _f1, modelica_metatype _cr2, modelica_metatype _iio2, modelica_metatype _f2, modelica_metatype _info, modelica_metatype _inCGraph, modelica_metatype *out_outCGraph)
{
modelica_metatype _outSets = NULL;
modelica_metatype _outCGraph = NULL;
modelica_metatype tmpMeta[12] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp4_1;modelica_metatype tmp4_2;modelica_metatype tmp4_3;modelica_metatype tmp4_4;modelica_boolean tmp4_5;modelica_metatype tmp4_6;modelica_metatype tmp4_7;modelica_metatype tmp4_8;
tmp4_1 = _inCache;
tmp4_2 = _inEnv;
tmp4_3 = _inIH;
tmp4_4 = _inSets;
tmp4_5 = _added;
tmp4_6 = _iio1;
tmp4_7 = _iio2;
tmp4_8 = _inCGraph;
{
modelica_metatype _vt1 = NULL;
modelica_metatype _vt2 = NULL;
modelica_metatype _t1 = NULL;
modelica_metatype _t2 = NULL;
modelica_metatype _ct = NULL;
modelica_metatype _ih = NULL;
modelica_metatype _sets = NULL;
modelica_integer _sc;
modelica_metatype _cl = NULL;
modelica_metatype _oc = NULL;
modelica_metatype _cache = NULL;
modelica_metatype _env = NULL;
modelica_metatype _io1 = NULL;
modelica_metatype _io2 = NULL;
modelica_metatype _graph = NULL;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
for (; tmp4 < 2; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
if (1 != tmp4_5) goto tmp3_end;
tmpMeta[0+0] = _inSets;
tmpMeta[0+1] = _inCGraph;
goto tmp3_done;
}
case 1: {
modelica_integer tmp6;
modelica_integer tmp7;
if (0 != tmp4_5) goto tmp3_end;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_4), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_4), 3));
tmp6 = mmc_unbox_integer(tmpMeta[3]);
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_4), 4));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_4), 5));
_cache = tmp4_1;
_env = tmp4_2;
_ih = tmp4_3;
_sets = tmpMeta[2];
_sc = tmp6;
_cl = tmpMeta[4];
_oc = tmpMeta[5];
_io1 = tmp4_6;
_io2 = tmp4_7;
_graph = tmp4_8;
tmpMeta[6] = omc_Lookup_lookupVar(threadData, _cache, _env, _cr1, &tmpMeta[2], &tmpMeta[5], NULL, NULL, NULL, NULL, NULL, NULL);
_cache = tmpMeta[6];
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 2));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 4));
_ct = tmpMeta[3];
_vt1 = tmpMeta[4];
_t1 = tmpMeta[5];
tmpMeta[5] = omc_Lookup_lookupVar(threadData, _cache, _env, _cr2, &tmpMeta[2], &tmpMeta[4], NULL, NULL, NULL, NULL, NULL, NULL);
_cache = tmpMeta[5];
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[2]), 4));
_vt2 = tmpMeta[3];
_t2 = tmpMeta[4];
_io1 = omc_InnerOuter_removeOuter(threadData, _io1);
_io2 = omc_InnerOuter_removeOuter(threadData, _io2);
tmpMeta[9] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[10] = mmc_mk_box5(3, &DAE_Connect_Sets_SETS__desc, _sets, mmc_mk_integer(_sc), _cl, tmpMeta[9]);
tmpMeta[11] = omc_InstSection_connectComponents(threadData, _cache, _env, _ih, tmpMeta[10], _pre, _cr1, _f1, _t1, _vt1, _cr2, _f2, _t2, _vt2, _ct, _io1, _io2, _graph, _info, &tmpMeta[2], &tmpMeta[3], &tmpMeta[4], NULL, &tmpMeta[8]);
_cache = tmpMeta[11];
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 2));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 3));
tmp7 = mmc_unbox_integer(tmpMeta[6]);
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 4));
_env = tmpMeta[2];
_ih = tmpMeta[3];
_sets = tmpMeta[5];
_sc = tmp7;
_cl = tmpMeta[7];
_graph = tmpMeta[8];
tmpMeta[2] = mmc_mk_box5(3, &DAE_Connect_Sets_SETS__desc, _sets, mmc_mk_integer(_sc), _cl, _oc);
tmpMeta[0+0] = tmpMeta[2];
tmpMeta[0+1] = _graph;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
goto_2:;
MMC_THROW_INTERNAL();
goto tmp3_done;
tmp3_done:;
}
}
_outSets = tmpMeta[0+0];
_outCGraph = tmpMeta[0+1];
_return: OMC_LABEL_UNUSED
if (out_outCGraph) { *out_outCGraph = _outCGraph; }
return _outSets;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_InnerOuter_addOuterConnectIfEmpty(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _pre, modelica_metatype _inSets, modelica_metatype _added, modelica_metatype _cr1, modelica_metatype _iio1, modelica_metatype _f1, modelica_metatype _cr2, modelica_metatype _iio2, modelica_metatype _f2, modelica_metatype _info, modelica_metatype _inCGraph, modelica_metatype *out_outCGraph)
{
modelica_integer tmp1;
modelica_metatype _outSets = NULL;
tmp1 = mmc_unbox_integer(_added);
_outSets = omc_InnerOuter_addOuterConnectIfEmpty(threadData, _inCache, _inEnv, _inIH, _pre, _inSets, tmp1, _cr1, _iio1, _f1, _cr2, _iio2, _f2, _info, _inCGraph, out_outCGraph);
return _outSets;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_convertInnerOuterInnerToOuter(threadData_t *threadData, modelica_metatype _io)
{
modelica_metatype _oio = NULL;
modelica_metatype tmpMeta[1] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;
tmp3_1 = _io;
{
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,0) == 0) goto tmp2_end;
tmpMeta[0] = _OMC_LIT39;
goto tmp2_done;
}
case 1: {
tmpMeta[0] = _io;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_oio = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _oio;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_retrieveOuterConnections2(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _inPrefix, modelica_metatype _inOuterConnects, modelica_metatype _inSets, modelica_boolean _inTopCall, modelica_metatype _inCGraph, modelica_metatype *out_outSets, modelica_metatype *out_outInnerOuterConnects, modelica_metatype *out_outCGraph)
{
modelica_metatype _outOuterConnects = NULL;
modelica_metatype _outSets = NULL;
modelica_metatype _outInnerOuterConnects = NULL;
modelica_metatype _outCGraph = NULL;
modelica_metatype tmpMeta[15] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp4_1;volatile modelica_metatype tmp4_2;volatile modelica_boolean tmp4_3;volatile modelica_metatype tmp4_4;
tmp4_1 = _inOuterConnects;
tmp4_2 = _inSets;
tmp4_3 = _inTopCall;
tmp4_4 = _inCGraph;
{
modelica_metatype _cr1 = NULL;
modelica_metatype _cr2 = NULL;
modelica_metatype _io1 = NULL;
modelica_metatype _io2 = NULL;
modelica_metatype _f1 = NULL;
modelica_metatype _f2 = NULL;
modelica_metatype _oc = NULL;
modelica_metatype _rest_oc = NULL;
modelica_metatype _ioc = NULL;
modelica_boolean _inner1;
modelica_boolean _inner2;
modelica_boolean _outer1;
modelica_boolean _outer2;
modelica_boolean _added;
modelica_metatype _scope = NULL;
modelica_metatype _source = NULL;
modelica_metatype _info = NULL;
modelica_metatype _sets = NULL;
modelica_metatype _graph = NULL;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp3_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp4 < 4; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
if (!listEmpty(tmp4_1)) goto tmp3_end;
tmp4 += 3;
tmpMeta[4] = MMC_REFSTRUCTLIT(mmc_nil);
tmpMeta[0+0] = _inOuterConnects;
tmpMeta[0+1] = _inSets;
tmpMeta[0+2] = tmpMeta[4];
tmpMeta[0+3] = _inCGraph;
goto tmp3_done;
}
case 1: {
modelica_boolean tmp6;
modelica_boolean tmp7;
modelica_boolean tmp8;
if (listEmpty(tmp4_1)) goto tmp3_end;
tmpMeta[4] = MMC_CAR(tmp4_1);
tmpMeta[5] = MMC_CDR(tmp4_1);
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 2));
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 3));
tmpMeta[8] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 4));
tmpMeta[9] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 5));
tmpMeta[10] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 6));
tmpMeta[11] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 7));
tmpMeta[12] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 8));
tmpMeta[13] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 9));
tmpMeta[14] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[13]), 2));
_scope = tmpMeta[6];
_cr1 = tmpMeta[7];
_io1 = tmpMeta[8];
_f1 = tmpMeta[9];
_cr2 = tmpMeta[10];
_io2 = tmpMeta[11];
_f2 = tmpMeta[12];
_source = tmpMeta[13];
_info = tmpMeta[14];
_rest_oc = tmpMeta[5];
_sets = tmp4_2;
_graph = tmp4_4;
_inner1 = omc_InnerOuter_lookupVarInnerOuterAttr(threadData, _inCache, _inEnv, _inIH, _cr1, _cr2 ,&_outer1);
tmp6 = _inner1;
if (1 != tmp6) goto goto_2;
tmp7 = _outer1;
if (0 != tmp7) goto goto_2;
_cr1 = omc_InnerOuter_removeInnerPrefixFromCref(threadData, _inPrefix, _cr1);
_cr2 = omc_InnerOuter_removeInnerPrefixFromCref(threadData, _inPrefix, _cr2);
_sets = omc_ConnectUtil_addOuterConnectToSets(threadData, _cr1, _cr2, _io1, _io2, _f1, _f2, _sets, _info ,&_added);
_sets = omc_InnerOuter_addOuterConnectIfEmpty(threadData, _inCache, _inEnv, _inIH, _inPrefix, _sets, _added, _cr1, _io1, _f1, _cr2, _io2, _f2, _info, _graph ,&_graph);
_rest_oc = omc_InnerOuter_retrieveOuterConnections2(threadData, _inCache, _inEnv, _inIH, _inPrefix, _rest_oc, _sets, _inTopCall, _graph ,&_sets ,&_ioc ,&_graph);
tmp8 = (modelica_boolean)_outer1;
if(tmp8)
{
tmpMeta[5] = mmc_mk_box9(3, &DAE_Connect_OuterConnect_OUTERCONNECT__desc, _scope, _cr1, _io1, _f1, _cr2, _io2, _f2, _source);
tmpMeta[4] = mmc_mk_cons(tmpMeta[5], _rest_oc);
tmpMeta[6] = tmpMeta[4];
}
else
{
tmpMeta[6] = _rest_oc;
}
_rest_oc = tmpMeta[6];
tmpMeta[0+0] = _rest_oc;
tmpMeta[0+1] = _sets;
tmpMeta[0+2] = _ioc;
tmpMeta[0+3] = _graph;
goto tmp3_done;
}
case 2: {
modelica_boolean tmp9;
modelica_boolean tmp10;
if (1 != tmp4_3) goto tmp3_end;
if (listEmpty(tmp4_1)) goto tmp3_end;
tmpMeta[4] = MMC_CAR(tmp4_1);
tmpMeta[5] = MMC_CDR(tmp4_1);
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 3));
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 4));
tmpMeta[8] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 5));
tmpMeta[9] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 6));
tmpMeta[10] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 7));
tmpMeta[11] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 8));
tmpMeta[12] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[4]), 9));
tmpMeta[13] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[12]), 2));
_cr1 = tmpMeta[6];
_io1 = tmpMeta[7];
_f1 = tmpMeta[8];
_cr2 = tmpMeta[9];
_io2 = tmpMeta[10];
_f2 = tmpMeta[11];
_info = tmpMeta[13];
_rest_oc = tmpMeta[5];
_sets = tmp4_2;
_graph = tmp4_4;
_inner1 = omc_InnerOuter_innerOuterBooleans(threadData, _io1 ,&_outer1);
_inner2 = omc_InnerOuter_innerOuterBooleans(threadData, _io2 ,&_outer2);
tmp9 = (_inner1 || _inner2);
if (1 != tmp9) goto goto_2;
tmp10 = (_outer1 || _outer2);
if (0 != tmp10) goto goto_2;
_io1 = omc_InnerOuter_convertInnerOuterInnerToOuter(threadData, _io1);
_io2 = omc_InnerOuter_convertInnerOuterInnerToOuter(threadData, _io2);
_sets = omc_ConnectUtil_addOuterConnectToSets(threadData, _cr1, _cr2, _io1, _io2, _f1, _f2, _sets, _info ,&_added);
_sets = omc_InnerOuter_addOuterConnectIfEmpty(threadData, _inCache, _inEnv, _inIH, _inPrefix, _sets, _added, _cr1, _io1, _f1, _cr2, _io2, _f2, _info, _graph ,&_graph);
tmpMeta[0+0] = omc_InnerOuter_retrieveOuterConnections2(threadData, _inCache, _inEnv, _inIH, _inPrefix, _rest_oc, _sets, 1, _graph, &tmpMeta[0+1], &tmpMeta[0+2], &tmpMeta[0+3]);
goto tmp3_done;
}
case 3: {
if (listEmpty(tmp4_1)) goto tmp3_end;
tmpMeta[4] = MMC_CAR(tmp4_1);
tmpMeta[5] = MMC_CDR(tmp4_1);
_oc = tmpMeta[4];
_rest_oc = tmpMeta[5];
_sets = tmp4_2;
_graph = tmp4_4;
_rest_oc = omc_InnerOuter_retrieveOuterConnections2(threadData, _inCache, _inEnv, _inIH, _inPrefix, _rest_oc, _sets, _inTopCall, _graph ,&_sets ,&_ioc ,&_graph);
tmpMeta[4] = mmc_mk_cons(_oc, _rest_oc);
tmpMeta[0+0] = tmpMeta[4];
tmpMeta[0+1] = _sets;
tmpMeta[0+2] = _ioc;
tmpMeta[0+3] = _graph;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
tmp3_done:
(void)tmp4;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp3_done2;
goto_2:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp4 < 4) {
goto tmp3_top;
}
MMC_THROW_INTERNAL();
tmp3_done2:;
}
}
_outOuterConnects = tmpMeta[0+0];
_outSets = tmpMeta[0+1];
_outInnerOuterConnects = tmpMeta[0+2];
_outCGraph = tmpMeta[0+3];
_return: OMC_LABEL_UNUSED
if (out_outSets) { *out_outSets = _outSets; }
if (out_outInnerOuterConnects) { *out_outInnerOuterConnects = _outInnerOuterConnects; }
if (out_outCGraph) { *out_outCGraph = _outCGraph; }
return _outOuterConnects;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_InnerOuter_retrieveOuterConnections2(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _inPrefix, modelica_metatype _inOuterConnects, modelica_metatype _inSets, modelica_metatype _inTopCall, modelica_metatype _inCGraph, modelica_metatype *out_outSets, modelica_metatype *out_outInnerOuterConnects, modelica_metatype *out_outCGraph)
{
modelica_integer tmp1;
modelica_metatype _outOuterConnects = NULL;
tmp1 = mmc_unbox_integer(_inTopCall);
_outOuterConnects = omc_InnerOuter_retrieveOuterConnections2(threadData, _inCache, _inEnv, _inIH, _inPrefix, _inOuterConnects, _inSets, tmp1, _inCGraph, out_outSets, out_outInnerOuterConnects, out_outCGraph);
return _outOuterConnects;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_removeInnerPrefixFromCref(threadData_t *threadData, modelica_metatype _inPrefix, modelica_metatype _inCref)
{
modelica_metatype _outCref = NULL;
modelica_metatype tmpMeta[1] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _inPrefix;
{
modelica_metatype _crefPrefix = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,0) == 0) goto tmp2_end;
tmpMeta[0] = _inCref;
goto tmp2_done;
}
case 1: {
_crefPrefix = omc_PrefixUtil_prefixToCref(threadData, _inPrefix);
tmpMeta[0] = omc_ComponentReference_crefStripPrefix(threadData, _inCref, _crefPrefix);
goto tmp2_done;
}
case 2: {
tmpMeta[0] = _inCref;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 3) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outCref = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outCref;
}
DLLExport
modelica_metatype omc_InnerOuter_retrieveOuterConnections(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _inPrefix, modelica_metatype _inSets, modelica_boolean _inTopCall, modelica_metatype _inCGraph, modelica_metatype *out_outInnerOuterConnects, modelica_metatype *out_outCGraph)
{
modelica_metatype _outSets = NULL;
modelica_metatype _outInnerOuterConnects = NULL;
modelica_metatype _outCGraph = NULL;
modelica_metatype _oc = NULL;
modelica_metatype tmpMeta[2] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
tmpMeta[0] = _inSets;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmpMeta[0]), 5));
_oc = tmpMeta[1];
_oc = omc_InnerOuter_retrieveOuterConnections2(threadData, _inCache, _inEnv, _inIH, _inPrefix, _oc, _inSets, _inTopCall, _inCGraph ,&_outSets ,&_outInnerOuterConnects ,&_outCGraph);
tmpMeta[0] = MMC_TAGPTR(mmc_alloc_words(6));
memcpy(MMC_UNTAGPTR(tmpMeta[0]), MMC_UNTAGPTR(_outSets), 6*sizeof(modelica_metatype));
((modelica_metatype*)MMC_UNTAGPTR(tmpMeta[0]))[5] = _oc;
_outSets = tmpMeta[0];
_return: OMC_LABEL_UNUSED
if (out_outInnerOuterConnects) { *out_outInnerOuterConnects = _outInnerOuterConnects; }
if (out_outCGraph) { *out_outCGraph = _outCGraph; }
return _outSets;
}
modelica_metatype boxptr_InnerOuter_retrieveOuterConnections(threadData_t *threadData, modelica_metatype _inCache, modelica_metatype _inEnv, modelica_metatype _inIH, modelica_metatype _inPrefix, modelica_metatype _inSets, modelica_metatype _inTopCall, modelica_metatype _inCGraph, modelica_metatype *out_outInnerOuterConnects, modelica_metatype *out_outCGraph)
{
modelica_integer tmp1;
modelica_metatype _outSets = NULL;
tmp1 = mmc_unbox_integer(_inTopCall);
_outSets = omc_InnerOuter_retrieveOuterConnections(threadData, _inCache, _inEnv, _inIH, _inPrefix, _inSets, tmp1, _inCGraph, out_outInnerOuterConnects, out_outCGraph);
return _outSets;
}
DLLExport
modelica_metatype omc_InnerOuter_renameUniqueVarsInTopScope(threadData_t *threadData, modelica_boolean _isTopScope, modelica_metatype _dae)
{
modelica_metatype _odae = NULL;
modelica_metatype tmpMeta[1] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_boolean tmp3_1;
tmp3_1 = _isTopScope;
{
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
modelica_boolean tmp5;
tmp5 = omc_System_getHasInnerOuterDefinitions(threadData);
if (0 != tmp5) goto goto_1;
tmpMeta[0] = _dae;
goto tmp2_done;
}
case 1: {
if (1 != tmp3_1) goto tmp2_end;
tmp3 += 1;
tmpMeta[0] = omc_DAEUtil_renameUniqueOuterVars(threadData, _dae);
goto tmp2_done;
}
case 2: {
if (0 != tmp3_1) goto tmp2_end;
tmpMeta[0] = _dae;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 3) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_odae = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _odae;
}
modelica_metatype boxptr_InnerOuter_renameUniqueVarsInTopScope(threadData_t *threadData, modelica_metatype _isTopScope, modelica_metatype _dae)
{
modelica_integer tmp1;
modelica_metatype _odae = NULL;
tmp1 = mmc_unbox_integer(_isTopScope);
_odae = omc_InnerOuter_renameUniqueVarsInTopScope(threadData, tmp1, _dae);
return _odae;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_extractCommonPart(threadData_t *threadData, modelica_metatype _prefixedCref, modelica_metatype _innerCref)
{
modelica_metatype _cr3 = NULL;
modelica_metatype tmpMeta[1] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
{
modelica_metatype _c1 = NULL;
modelica_metatype _c2 = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
modelica_boolean tmp5;
_c1 = omc_ComponentReference_crefLastCref(threadData, _prefixedCref);
_c2 = omc_ComponentReference_crefLastCref(threadData, _innerCref);
tmp5 = omc_ComponentReference_crefEqual(threadData, _c1, _c2);
if (1 != tmp5) goto goto_1;
tmpMeta[0] = omc_ComponentReference_crefSetLastType(threadData, _innerCref, omc_ComponentReference_crefLastType(threadData, _prefixedCref));
goto tmp2_done;
}
case 1: {
_c2 = omc_ComponentReference_crefStripLastIdent(threadData, _innerCref);
tmpMeta[0] = omc_InnerOuter_extractCommonPart(threadData, _prefixedCref, _c2);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 2) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_cr3 = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _cr3;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_stripCommonCrefPart(threadData_t *threadData, modelica_metatype _outerCr, modelica_metatype _innerCr, modelica_metatype *out_outInnerCr)
{
modelica_metatype _outOuterCr = NULL;
modelica_metatype _outInnerCr = NULL;
modelica_metatype tmpMeta[6] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp4_1;volatile modelica_metatype tmp4_2;
tmp4_1 = _outerCr;
tmp4_2 = _innerCr;
{
modelica_string _id1 = NULL;
modelica_string _id2 = NULL;
modelica_metatype _cr1 = NULL;
modelica_metatype _cr2 = NULL;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp3_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp4 < 2; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
modelica_boolean tmp6;
if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,4) == 0) goto tmp3_end;
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 2));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_1), 5));
if (mmc__uniontype__metarecord__typedef__equal(tmp4_2,0,4) == 0) goto tmp3_end;
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_2), 2));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp4_2), 5));
_id1 = tmpMeta[2];
_cr1 = tmpMeta[3];
_id2 = tmpMeta[4];
_cr2 = tmpMeta[5];
tmp6 = (stringEqual(_id1, _id2));
if (1 != tmp6) goto goto_2;
tmpMeta[0+0] = omc_InnerOuter_stripCommonCrefPart(threadData, _cr1, _cr2, &tmpMeta[0+1]);
goto tmp3_done;
}
case 1: {
_cr1 = tmp4_1;
_cr2 = tmp4_2;
tmpMeta[0+0] = _cr1;
tmpMeta[0+1] = _cr2;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
tmp3_done:
(void)tmp4;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp3_done2;
goto_2:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp4 < 2) {
goto tmp3_top;
}
MMC_THROW_INTERNAL();
tmp3_done2:;
}
}
_outOuterCr = tmpMeta[0+0];
_outInnerCr = tmpMeta[0+1];
_return: OMC_LABEL_UNUSED
if (out_outInnerCr) { *out_outInnerCr = _outInnerCr; }
return _outOuterCr;
}
PROTECTED_FUNCTION_STATIC modelica_boolean omc_InnerOuter_isInnerOuterMatch(threadData_t *threadData, modelica_metatype _outerCr, modelica_metatype _innerCr)
{
modelica_boolean _res;
modelica_boolean tmp1 = 0;
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
{
modelica_metatype _innerCr1 = NULL;
modelica_metatype _outerCr1 = NULL;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp3_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp4 < 2; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
modelica_boolean tmp6;
tmp6 = omc_ComponentReference_crefLastIdentEqual(threadData, _outerCr, _innerCr);
if (0 != tmp6) goto goto_2;
tmp1 = 0;
goto tmp3_done;
}
case 1: {
_outerCr1 = omc_InnerOuter_stripCommonCrefPart(threadData, _outerCr, _innerCr ,&_innerCr1);
tmp1 = omc_ComponentReference_crefContainedIn(threadData, _outerCr1, _innerCr1);
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
tmp3_done:
(void)tmp4;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp3_done2;
goto_2:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp4 < 2) {
goto tmp3_top;
}
MMC_THROW_INTERNAL();
tmp3_done2:;
}
}
_res = tmp1;
_return: OMC_LABEL_UNUSED
return _res;
}
PROTECTED_FUNCTION_STATIC modelica_metatype boxptr_InnerOuter_isInnerOuterMatch(threadData_t *threadData, modelica_metatype _outerCr, modelica_metatype _innerCr)
{
modelica_boolean _res;
modelica_metatype out_res;
_res = omc_InnerOuter_isInnerOuterMatch(threadData, _outerCr, _innerCr);
out_res = mmc_mk_icon(_res);
return out_res;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_buildInnerOuterReplVar(threadData_t *threadData, modelica_metatype _innerVar, modelica_metatype _outerVars, modelica_metatype _inRepl)
{
modelica_metatype _outRepl = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;volatile modelica_metatype tmp3_2;
tmp3_1 = _innerVar;
tmp3_2 = _inRepl;
{
modelica_metatype _outerCrs = NULL;
modelica_metatype _ourOuterCrs = NULL;
modelica_metatype _cr = NULL;
modelica_metatype _repl = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,13) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 14));
if (mmc__uniontype__metarecord__typedef__equal(tmpMeta[2],2,0) == 0) goto tmp2_end;
_cr = tmpMeta[1];
_repl = tmp3_2;
_outerCrs = omc_List_map(threadData, _outerVars, boxvar_DAEUtil_varCref);
_ourOuterCrs = omc_List_select1(threadData, _outerCrs, boxvar_InnerOuter_isInnerOuterMatch, _cr);
_cr = omc_DAEUtil_nameInnerouterUniqueCref(threadData, _cr);
tmpMeta[0] = omc_List_fold1r(threadData, _ourOuterCrs, boxvar_VarTransform_addReplacement, omc_Expression_crefExp(threadData, _cr), _repl);
goto tmp2_done;
}
case 1: {
if (mmc__uniontype__metarecord__typedef__equal(tmp3_1,0,13) == 0) goto tmp2_end;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
_cr = tmpMeta[1];
_repl = tmp3_2;
_outerCrs = omc_List_map(threadData, _outerVars, boxvar_DAEUtil_varCref);
_ourOuterCrs = omc_List_select1(threadData, _outerCrs, boxvar_InnerOuter_isInnerOuterMatch, _cr);
tmpMeta[0] = omc_List_fold1r(threadData, _ourOuterCrs, boxvar_VarTransform_addReplacement, omc_Expression_crefExp(threadData, _cr), _repl);
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 2) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outRepl = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outRepl;
}
PROTECTED_FUNCTION_STATIC modelica_metatype omc_InnerOuter_buildInnerOuterRepl(threadData_t *threadData, modelica_metatype _innerVars, modelica_metatype _outerVars, modelica_metatype _inRepl)
{
modelica_metatype _outRepl = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
modelica_metatype tmp3_1;modelica_metatype tmp3_2;
tmp3_1 = _innerVars;
tmp3_2 = _inRepl;
{
modelica_metatype _repl = NULL;
modelica_metatype _v = NULL;
modelica_metatype _rest = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
for (; tmp3 < 2; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
if (!listEmpty(tmp3_1)) goto tmp2_end;
_repl = tmp3_2;
tmpMeta[0] = _repl;
goto tmp2_done;
}
case 1: {
if (listEmpty(tmp3_1)) goto tmp2_end;
tmpMeta[1] = MMC_CAR(tmp3_1);
tmpMeta[2] = MMC_CDR(tmp3_1);
_v = tmpMeta[1];
_rest = tmpMeta[2];
_repl = tmp3_2;
_repl = omc_InnerOuter_buildInnerOuterReplVar(threadData, _v, _outerVars, _repl);
_innerVars = _rest;
_inRepl = _repl;
goto _tailrecursive;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
goto_1:;
MMC_THROW_INTERNAL();
goto tmp2_done;
tmp2_done:;
}
}
_outRepl = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outRepl;
}
DLLExport
modelica_metatype omc_InnerOuter_changeInnerOuterInOuterConnect2(threadData_t *threadData, modelica_metatype _inOC)
{
modelica_metatype _outOC = NULL;
modelica_metatype tmpMeta[9] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp3_1;
tmp3_1 = _inOC;
{
modelica_metatype _cr1 = NULL;
modelica_metatype _cr2 = NULL;
modelica_metatype _ncr1 = NULL;
modelica_metatype _ncr2 = NULL;
modelica_metatype _io1 = NULL;
modelica_metatype _io2 = NULL;
modelica_metatype _f1 = NULL;
modelica_metatype _f2 = NULL;
modelica_metatype _scope = NULL;
modelica_metatype _source = NULL;
volatile mmc_switch_type tmp3;
int tmp4;
tmp3 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp2_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp3 < 3; tmp3++) {
switch (MMC_SWITCH_CAST(tmp3)) {
case 0: {
modelica_boolean tmp5;
modelica_boolean tmp6;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 4));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 5));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 6));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 7));
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 8));
tmpMeta[8] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 9));
_scope = tmpMeta[1];
_cr1 = tmpMeta[2];
_io1 = tmpMeta[3];
_f1 = tmpMeta[4];
_cr2 = tmpMeta[5];
_io2 = tmpMeta[6];
_f2 = tmpMeta[7];
_source = tmpMeta[8];
omc_InnerOuter_innerOuterBooleans(threadData, _io1, &tmp5);
if (1 != tmp5) goto goto_1;
_ncr1 = omc_PrefixUtil_prefixToCref(threadData, _scope);
tmp6 = omc_ComponentReference_crefFirstCrefLastCrefEqual(threadData, _ncr1, _cr1);
if (0 != tmp6) goto goto_1;
tmpMeta[1] = mmc_mk_box9(3, &DAE_Connect_OuterConnect_OUTERCONNECT__desc, _scope, _cr1, _OMC_LIT56, _f1, _cr2, _io2, _f2, _source);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 1: {
modelica_boolean tmp7;
modelica_boolean tmp8;
tmpMeta[1] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 2));
tmpMeta[2] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 3));
tmpMeta[3] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 4));
tmpMeta[4] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 5));
tmpMeta[5] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 6));
tmpMeta[6] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 7));
tmpMeta[7] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 8));
tmpMeta[8] = MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(tmp3_1), 9));
_scope = tmpMeta[1];
_cr1 = tmpMeta[2];
_io1 = tmpMeta[3];
_f1 = tmpMeta[4];
_cr2 = tmpMeta[5];
_io2 = tmpMeta[6];
_f2 = tmpMeta[7];
_source = tmpMeta[8];
omc_InnerOuter_innerOuterBooleans(threadData, _io2, &tmp7);
if (1 != tmp7) goto goto_1;
_ncr2 = omc_PrefixUtil_prefixToCref(threadData, _scope);
tmp8 = omc_ComponentReference_crefFirstCrefLastCrefEqual(threadData, _ncr2, _cr2);
if (0 != tmp8) goto goto_1;
tmpMeta[1] = mmc_mk_box9(3, &DAE_Connect_OuterConnect_OUTERCONNECT__desc, _scope, _cr1, _io1, _f1, _cr2, _OMC_LIT56, _f2, _source);
tmpMeta[0] = tmpMeta[1];
goto tmp2_done;
}
case 2: {
tmpMeta[0] = _inOC;
goto tmp2_done;
}
}
goto tmp2_end;
tmp2_end: ;
}
goto goto_1;
tmp2_done:
(void)tmp3;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp2_done2;
goto_1:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp3 < 3) {
goto tmp2_top;
}
MMC_THROW_INTERNAL();
tmp2_done2:;
}
}
_outOC = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _outOC;
}
DLLExport
modelica_metatype omc_InnerOuter_changeInnerOuterInOuterConnect(threadData_t *threadData, modelica_metatype __omcQ_24in_5Fsets)
{
modelica_metatype _sets = NULL;
modelica_metatype tmpMeta[1] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
_sets = __omcQ_24in_5Fsets;
tmpMeta[0] = MMC_TAGPTR(mmc_alloc_words(6));
memcpy(MMC_UNTAGPTR(tmpMeta[0]), MMC_UNTAGPTR(_sets), 6*sizeof(modelica_metatype));
((modelica_metatype*)MMC_UNTAGPTR(tmpMeta[0]))[5] = omc_List_map(threadData, (MMC_FETCH(MMC_OFFSET(MMC_UNTAGPTR(_sets), 5))), boxvar_InnerOuter_changeInnerOuterInOuterConnect2);
_sets = tmpMeta[0];
_return: OMC_LABEL_UNUSED
return _sets;
}
DLLExport
modelica_metatype omc_InnerOuter_handleInnerOuterEquations(threadData_t *threadData, modelica_metatype _io, modelica_metatype _inDae, modelica_metatype _inIH, modelica_metatype _inGraphNew, modelica_metatype _inGraph, modelica_metatype *out_outIH, modelica_metatype *out_outGraph)
{
modelica_metatype _odae = NULL;
modelica_metatype _outIH = NULL;
modelica_metatype _outGraph = NULL;
modelica_metatype tmpMeta[3] __attribute__((unused)) = {0};
MMC_SO();
_tailrecursive: OMC_LABEL_UNUSED
{
volatile modelica_metatype tmp4_1;volatile modelica_metatype tmp4_2;volatile modelica_metatype tmp4_3;volatile modelica_metatype tmp4_4;volatile modelica_metatype tmp4_5;
tmp4_1 = _io;
tmp4_2 = _inDae;
tmp4_3 = _inIH;
tmp4_4 = _inGraphNew;
tmp4_5 = _inGraph;
{
modelica_metatype _dae1 = NULL;
modelica_metatype _dae2 = NULL;
modelica_metatype _dae = NULL;
modelica_metatype _graphNew = NULL;
modelica_metatype _graph = NULL;
modelica_metatype _ih = NULL;
volatile mmc_switch_type tmp4;
int tmp5;
tmp4 = 0;
MMC_TRY_INTERNAL(mmc_jumper)
tmp3_top:
threadData->mmc_jumper = &new_mmc_jumper;
for (; tmp4 < 5; tmp4++) {
switch (MMC_SWITCH_CAST(tmp4)) {
case 0: {
if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,1,0) == 0) goto tmp3_end;
_dae = tmp4_2;
_ih = tmp4_3;
_graph = tmp4_5;
tmp4 += 3;
_odae = omc_DAEUtil_splitDAEIntoVarsAndEquations(threadData, _dae, NULL);
tmpMeta[0+0] = _odae;
tmpMeta[0+1] = _ih;
tmpMeta[0+2] = _graph;
goto tmp3_done;
}
case 1: {
if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,2,0) == 0) goto tmp3_end;
_dae = tmp4_2;
_ih = tmp4_3;
_graph = tmp4_5;
tmp4 += 2;
_dae1 = omc_DAEUtil_splitDAEIntoVarsAndEquations(threadData, _dae ,&_dae2);
_dae2 = omc_DAEUtil_nameUniqueOuterVars(threadData, _dae2);
_dae = omc_DAEUtil_joinDaes(threadData, _dae1, _dae2);
tmpMeta[0+0] = _dae;
tmpMeta[0+1] = _ih;
tmpMeta[0+2] = _graph;
goto tmp3_done;
}
case 2: {
if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,0,0) == 0) goto tmp3_end;
_dae = tmp4_2;
_ih = tmp4_3;
_graphNew = tmp4_4;
tmp4 += 1;
tmpMeta[0+0] = _dae;
tmpMeta[0+1] = _ih;
tmpMeta[0+2] = _graphNew;
goto tmp3_done;
}
case 3: {
if (mmc__uniontype__metarecord__typedef__equal(tmp4_1,3,0) == 0) goto tmp3_end;
_dae = tmp4_2;
_ih = tmp4_3;
_graphNew = tmp4_4;
tmpMeta[0+0] = _dae;
tmpMeta[0+1] = _ih;
tmpMeta[0+2] = _graphNew;
goto tmp3_done;
}
case 4: {
fputs(MMC_STRINGDATA(_OMC_LIT59),stdout);
goto goto_2;
goto tmp3_done;
}
}
goto tmp3_end;
tmp3_end: ;
}
goto goto_2;
tmp3_done:
(void)tmp4;
MMC_RESTORE_INTERNAL(mmc_jumper);
goto tmp3_done2;
goto_2:;
MMC_CATCH_INTERNAL(mmc_jumper);
if (++tmp4 < 5) {
goto tmp3_top;
}
MMC_THROW_INTERNAL();
tmp3_done2:;
}
}
_odae = tmpMeta[0+0];
_outIH = tmpMeta[0+1];
_outGraph = tmpMeta[0+2];
_return: OMC_LABEL_UNUSED
if (out_outIH) { *out_outIH = _outIH; }
if (out_outGraph) { *out_outGraph = _outGraph; }
return _odae;
}
