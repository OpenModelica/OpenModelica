all: release

top_builddir=../..
builddir_bin=$(top_builddir)/build/bin
builddir_lib=$(top_builddir)/build/lib
builddir_inc=$(top_builddir)/build/include
builddir_doc=$(top_builddir)/build/doc
runtimedir=$(top_builddir)/Compiler/runtime/


CC=@CC@
CXX=@CXX@

EXEEXT=@EXEEXT@

USE_CORBA = @USE_CORBA@

CORBALIB = @CORBALIBS@
CORBAINC = @CORBACFLAGS@

CFLAGS = @CFLAGS@ -Wall $(USE_CORBA)
CPPFLAGS = $(CORBAINC) @CPPFLAGS@
CXXFLAGS = $(CFLAGS)
LDFLAGS = @LDFLAGS@ $(LIBS)

LIBS = @LIBREADLINE@ -lncurses $(CORBALIB) -lm -lpthread


OBJS += mosh.o options.o

ifdef USE_CORBA
  OBJS += omc_communication.o
mosh.o: omc_communication.h
endif

PROG = OMShell-terminal

release: $(PROG)$(EXEEXT)
	cp $(PROG)$(EXEEXT) $(builddir_bin)/

$(PROG)$(EXEEXT) : $(OBJS)
	$(CXX) -o $(PROG)$(EXEEXT) $(OBJS) $(CORBAOBJS) $(LDFLAGS)

omc_communication.cpp: omc_communication.cc
	ln -s $< $@
omc_communication.cc: $(runtimedir)/omc_communication.idl
	@IDLCMD@ $<
omc_communication.h: omc_communication.cc

clean:
	-rm -f *.o *~ core *.core omc_communication.* $(PROG)$(EXEEXT) $(builddir_bin)/$(PROG)$(EXEEXT)


mosh.o : mosh.cpp
options.o: options.cpp


.PRECIOUS: Makefile

Makefile: Makefile.in
	cd $(top_builddir) && ./config.status
