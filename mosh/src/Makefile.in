
top_builddir=../..
builddir_bin=$(top_builddir)/build/bin
builddir_lib=$(top_builddir)/build/lib
builddir_inc=$(top_builddir)/build/include
builddir_doc=$(top_builddir)/build/doc


CC=gcc
CXX=g++

ANTLR_HOME = @antlrhome@

ANTLR_INCP = -I@antlrinc@
ANTLR_LIBP = -L@antlrlib@

PARSE_INCP = -I$(top_builddir)/modelica_parser/src
PARSE_LIBP = -L$(top_builddir)/modelica_parser/src

READLINE_INCP = -I@readlineinc@
READLINE_LIBP = -L@readlinelib@

EXEEXT=@EXEEXT@

USE_CORBA = @USE_CORBA@
CORBAHOME = @CORBAHOME@

ifdef USE_CORBA
  CORBAIMPL = -I$(top_builddir)/Compiler/runtime
  CORBAOBJS = $(top_builddir)/Compiler/runtime/omc_communication.o \
	$(top_builddir)/Compiler/runtime/omc_communication_impl.o
  CORBALIB = -L$(CORBAHOME)/lib -lmico -lssl -lcrypto
  CORBAINC = -I$(CORBAHOME)/include
else
  CORBAIMPL =
  CORBAOBJS =
  CORBALIB =
endif

INCP = $(ANTLR_INCP) $(PARSE_INCP) $(READLINE_INCP) $(CORBAIMPL) $(CORBAINC)
LIBP = $(ANTLR_LIBP) $(PARSE_LIBP) $(READLINE_LIBP) 

CFLAGS = $(INCP) -g -Wall -DDEBUG $(USE_CORBA)
CXXFLAGS = $(CFLAGS)
LINKFLAGS = $(LIBP) 

LIBS = -lantlr -lmodelica_parser -lreadline -ltermcap  $(CORBALIB) -lm -lpthread 


OBJS += mosh.o options.o

PROG = OMShell

all: release


release: $(PROG)$(EXEEXT) 

$(PROG)$(EXEEXT) : $(OBJS) 
	$(CXX) -o $(PROG)$(EXEEXT) $(OBJS) $(CORBAOBJS) $(LINKFLAGS) $(LIBS)
	cp $(PROG)$(EXEEXT) $(builddir_bin)/

.cpp.o:
	$(CXX) $(CXXFLAGS) -c $<


clean:
	-rm -f *.o *~ core *.core $(PROG)$(EXEEXT) $(builddir_bin)/$(PROG)$(EXEEXT)


mosh.o : mosh.cpp 
options.o: options.cpp


.PRECIOUS: Makefile

Makefile: Makefile.in
	$(top_builddir)/config.status Makefile

