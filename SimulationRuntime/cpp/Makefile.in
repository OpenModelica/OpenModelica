# Adrian Pop, adrpo@ida.liu.se, 2006-02-01
# Makefile for compilation of OMC using OMDev-mingw
# OMDev-mingw: http://www.ida.liu.se/~adrpo/omc/omdev/

OMBUILDDIR=
LIBINSTALLEXT=

-include Makefile.env

BOOST_ROOT="@BOOST_ROOT@"
BOOST_STATIC_LINKING_COMMAND="@BOOST_STATIC_LINKING_COMMAND@"
BOOST_REALPATHS_COMMAND="@BOOST_REALPATHS_COMMAND@"
RUNTIME_PROFILING_COMMAND="@RUNTIME_PROFILING_COMMAND@"
SCOREP_COMMAND="@SCOREP_COMMAND@"
SCOREP_HOME="@SCOREP_HOME@"
FMU_SUNDIALS_COMMAND="@FMU_SUNDIALS_COMMAND@"
LOGGER_COMMAND="@LOGGER_COMMAND@"
CPP_ELEVEN_COMMAND="@CPP_ELEVEN_COMMAND@"

#Experimental
PARALLEL_OUTPUT_COMMAND="@PARALLEL_OUTPUT_COMMAND@"

#use this call to use precompiled headers
#BUILDTYPE = Release
#use this call if you want to debug the cpp runtime
BUILDTYPE=@CMAKE_BUILDTYPE@

CMAKE_COMMANDS=@CMAKE_COMMANDS@
CMAKE_ARGS=$(patsubst CMAKE_%, -D%, $(filter CMAKE_%, $(MAKEFLAGS)))

runtimeCpp:
	mkdir -p Build
	cd ./Build && echo "change to Build" && $(CMAKE_COMMANDS) cmake -DCMAKE_BUILD_TYPE=$(BUILDTYPE) -DBOOST_ROOT=$(BOOST_ROOT) $(BOOST_STATIC_LINKING_COMMAND) $(CPP_ELEVEN_COMMAND) $(BOOST_REALPATHS_COMMAND) $(PARALLEL_OUTPUT_COMMAND) $(RUNTIME_PROFILING_COMMAND) $(SCOREP_COMMAND) $(FMU_SUNDIALS_COMMAND) $(LOGGER_COMMAND) -DCMAKE_BUILD_TYPE=$(BUILDTYPE) -DCMAKE_INSTALL_PREFIX:PATH="$(OMBUILDDIR)" -DLIBINSTALLEXT=$(LIBINSTALLEXT) -DSCOREP_HOME:STRING="$(SCOREP_HOME)" $(BUILD_DOC_COMMAND) $(CMAKE_ARGS)  ../
	$(MAKE) -C Build VERBOSE=1

install: runtimeCpp
	(cd Build; $(MAKE) install)

clean:
	rm -R -f Build

Makefile: Makefile.in
	cd @top_builddir@ && ./config.status
