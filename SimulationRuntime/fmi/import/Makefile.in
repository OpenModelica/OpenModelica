# Project: Code Generator for FMU Import to OpenModelica 1.7.0
# Author: Wuzhu Chen, TU-Clausthal

AR = ar -ru
CC   = @CC@
RES  =
OBJS  = xmlparser.o stack.o moGenerator.o $(RES)
LINKOBJS  = $(OBJS)
INCS =
CXXINCS =  -I"../include/"
BIN  = ../../../build/bin/fmigenerator
LIB  = ../../../build/lib/omc/libfmuWrapper.a
CXXFLAGS = $(CXXINCS)
CFLAGS = @CFLAGS@ -Wall -pedantic -std=c99
CPPFLAGS = -I"../../../build/include/omc/c" @CPPFLAGS@
LDFLAGS = @LDFLAGS@ -lexpat
RM = rm -f

.PHONY: all all-before all-after clean clean-custom

all: all-before $(BIN) all-after $(LIB)

$(LIB): fmuWrapper.o
	$(AR) $@ $<

fmuModelica.h: fmuModelica.in
	sed 's/"/\\"/g' $< | sed 's/^/"/' | sed 's/$$/\\n"/' > $@.tmp
	mv $@.tmp $@

fmuModelica.unix.h: fmuModelica.unix.in
	sed 's/"/\\"/g' $< | sed 's/^/"/' | sed 's/$$/\\n"/' > $@.tmp
	mv $@.tmp $@


moGenerator.o: fmuModelica.h fmuModelica.unix.h

xmlparser.o: xmlparser.c xmlparser.h stack.h

clean: clean-custom
	${RM} $(OBJS) $(BIN) fmuWrapper.o

$(BIN): $(OBJS)
	$(CC) -Wall -o $@ $(CPPFLAGS) $(LINKOBJS) $(LDFLAGS)

Makefile: Makefile.in
	(cd ../../../ ; ./config.status)

